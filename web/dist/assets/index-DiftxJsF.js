(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function e(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(a){if(a.ep)return;a.ep=!0;const o=e(a);fetch(a.href,o)}})();const Ct=0,nn=1,an=2,_a=6e5,at=16,ve=12,ce=32,on=2,sn=`Write a short story about a traveler:

The weary traveler had been walking for`;class ga{seed;vocab;constructor(r=32,e=42){this.seed=e,this.vocab=[" the"," a"," an"," is"," was"," are"," were"," be"," been"," being"," have"," has"," had"," do"," does"," did"," will"," would"," could"," should"," may"," might"," must"," shall"," can"," need"," dare"," ought"," used"," to"," of"," in"].slice(0,r)}hashContext(r){let e=this.seed;for(const n of r)e=(e*31+n.charCodeAt(0)&4294967295)>>>0;return e}async getTokenDistribution(r){const e=this.hashContext(r),n=[];for(let s=0;s<this.vocab.length;s++){const i=((e*(s+1)^e>>>16)&4294967295)>>>0,c=1/(s+1),l=i%1e3/1e4,d=c+l;n.push(d)}const a=n.reduce((s,i)=>s+i,0),o=this.vocab.map((s,i)=>({token:s,prob:n[i]/a}));return o.sort((s,i)=>i.prob-s.prob),o}}const ln=1,dn={erro_evt:{name:"erro_evt",structName:"glue_msg_error",className:"GlueMsgError",fields:[{type:"str",name:"message",isNullable:!1}]},load_req:{name:"load_req",structName:"glue_msg_load_req",className:"GlueMsgLoadReq",fields:[{type:"arr_str",name:"model_paths",isNullable:!1},{type:"bool",name:"n_ctx_auto",isNullable:!1},{type:"bool",name:"use_mmap",isNullable:!1},{type:"bool",name:"use_mlock",isNullable:!1},{type:"int",name:"n_gpu_layers",isNullable:!1},{type:"int",name:"seed",isNullable:!1},{type:"int",name:"n_ctx",isNullable:!1},{type:"int",name:"n_threads",isNullable:!1},{type:"bool",name:"embeddings",isNullable:!0},{type:"bool",name:"offload_kqv",isNullable:!0},{type:"int",name:"n_batch",isNullable:!0},{type:"int",name:"n_seq_max",isNullable:!0},{type:"str",name:"pooling_type",isNullable:!0},{type:"str",name:"rope_scaling_type",isNullable:!0},{type:"float",name:"rope_freq_base",isNullable:!0},{type:"float",name:"rope_freq_scale",isNullable:!0},{type:"float",name:"yarn_ext_factor",isNullable:!0},{type:"float",name:"yarn_attn_factor",isNullable:!0},{type:"float",name:"yarn_beta_fast",isNullable:!0},{type:"float",name:"yarn_beta_slow",isNullable:!0},{type:"int",name:"yarn_orig_ctx",isNullable:!0},{type:"str",name:"cache_type_k",isNullable:!0},{type:"str",name:"cache_type_v",isNullable:!0},{type:"bool",name:"flash_attn",isNullable:!0},{type:"bool",name:"swa_full",isNullable:!0}]},load_res:{name:"load_res",structName:"glue_msg_load_res",className:"GlueMsgLoadRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"int",name:"n_ctx",isNullable:!1},{type:"int",name:"n_batch",isNullable:!1},{type:"int",name:"n_ubatch",isNullable:!1},{type:"int",name:"n_vocab",isNullable:!1},{type:"int",name:"n_ctx_train",isNullable:!1},{type:"int",name:"n_embd",isNullable:!1},{type:"int",name:"n_layer",isNullable:!1},{type:"arr_str",name:"metadata_key",isNullable:!1},{type:"arr_str",name:"metadata_val",isNullable:!1},{type:"int",name:"token_bos",isNullable:!1},{type:"int",name:"token_eos",isNullable:!1},{type:"int",name:"token_eot",isNullable:!1},{type:"arr_int",name:"list_tokens_eog",isNullable:!1},{type:"bool",name:"add_bos_token",isNullable:!1},{type:"bool",name:"add_eos_token",isNullable:!1},{type:"bool",name:"has_encoder",isNullable:!1},{type:"int",name:"token_decoder_start",isNullable:!1}]},opti_req:{name:"opti_req",structName:"glue_msg_set_options_req",className:"GlueMsgSetOptionsReq",fields:[{type:"bool",name:"embeddings",isNullable:!1}]},opti_res:{name:"opti_res",structName:"glue_msg_set_options_res",className:"GlueMsgSetOptionsRes",fields:[{type:"bool",name:"success",isNullable:!1}]},sint_req:{name:"sint_req",structName:"glue_msg_sampling_init_req",className:"GlueMsgSamplingInitReq",fields:[{type:"int",name:"mirostat",isNullable:!0},{type:"float",name:"mirostat_tau",isNullable:!0},{type:"float",name:"mirostat_eta",isNullable:!0},{type:"float",name:"temp",isNullable:!0},{type:"float",name:"top_p",isNullable:!0},{type:"int",name:"top_k",isNullable:!0},{type:"int",name:"penalty_last_n",isNullable:!0},{type:"float",name:"penalty_repeat",isNullable:!0},{type:"float",name:"penalty_freq",isNullable:!0},{type:"float",name:"penalty_present",isNullable:!0},{type:"float",name:"dynatemp_range",isNullable:!0},{type:"float",name:"dynatemp_exponent",isNullable:!0},{type:"arr_str",name:"samplers_sequence",isNullable:!0},{type:"str",name:"grammar",isNullable:!0},{type:"int",name:"n_prev",isNullable:!0},{type:"int",name:"n_probs",isNullable:!0},{type:"float",name:"min_p",isNullable:!0},{type:"float",name:"typical_p",isNullable:!0},{type:"float",name:"typ_p",isNullable:!0},{type:"arr_int",name:"logit_bias_toks",isNullable:!0},{type:"arr_float",name:"logit_bias_vals",isNullable:!0},{type:"arr_int",name:"tokens",isNullable:!0}]},sint_res:{name:"sint_res",structName:"glue_msg_sampling_init_res",className:"GlueMsgSamplingInitRes",fields:[{type:"bool",name:"success",isNullable:!1}]},gvoc_req:{name:"gvoc_req",structName:"glue_msg_get_vocab_req",className:"GlueMsgGetVocabReq",fields:[]},gvoc_res:{name:"gvoc_res",structName:"glue_msg_get_vocab_res",className:"GlueMsgGetVocabRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"arr_raw",name:"vocab",isNullable:!1}]},lkup_req:{name:"lkup_req",structName:"glue_msg_lookup_token_req",className:"GlueMsgLookupTokenReq",fields:[{type:"str",name:"piece",isNullable:!1}]},lkup_res:{name:"lkup_res",structName:"glue_msg_lookup_token_res",className:"GlueMsgLookupTokenRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"int",name:"token",isNullable:!1}]},tokn_req:{name:"tokn_req",structName:"glue_msg_tokenize_req",className:"GlueMsgTokenizeReq",fields:[{type:"str",name:"text",isNullable:!1},{type:"bool",name:"special",isNullable:!1}]},tokn_res:{name:"tokn_res",structName:"glue_msg_tokenize_res",className:"GlueMsgTokenizeRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"arr_int",name:"tokens",isNullable:!1}]},dtkn_req:{name:"dtkn_req",structName:"glue_msg_detokenize_req",className:"GlueMsgDetokenizeReq",fields:[{type:"arr_int",name:"tokens",isNullable:!1}]},dtkn_res:{name:"dtkn_res",structName:"glue_msg_detokenize_res",className:"GlueMsgDetokenizeRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"raw",name:"buffer",isNullable:!1}]},deco_req:{name:"deco_req",structName:"glue_msg_decode_req",className:"GlueMsgDecodeReq",fields:[{type:"arr_int",name:"tokens",isNullable:!1},{type:"bool",name:"skip_logits",isNullable:!1}]},deco_res:{name:"deco_res",structName:"glue_msg_decode_res",className:"GlueMsgDecodeRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"str",name:"message",isNullable:!1},{type:"int",name:"n_past",isNullable:!1}]},enco_req:{name:"enco_req",structName:"glue_msg_encode_req",className:"GlueMsgEncodeReq",fields:[{type:"arr_int",name:"tokens",isNullable:!1}]},enco_res:{name:"enco_res",structName:"glue_msg_encode_res",className:"GlueMsgEncodeRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"str",name:"message",isNullable:!1},{type:"int",name:"n_past",isNullable:!1}]},ssam_req:{name:"ssam_req",structName:"glue_msg_sampling_sample_req",className:"GlueMsgSamplingSampleReq",fields:[]},ssam_res:{name:"ssam_res",structName:"glue_msg_sampling_sample_res",className:"GlueMsgSamplingSampleRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"raw",name:"piece",isNullable:!1},{type:"int",name:"token",isNullable:!1}]},sacc_req:{name:"sacc_req",structName:"glue_msg_sampling_accept_req",className:"GlueMsgSamplingAcceptReq",fields:[{type:"arr_int",name:"tokens",isNullable:!1}]},sacc_res:{name:"sacc_res",structName:"glue_msg_sampling_accept_res",className:"GlueMsgSamplingAcceptRes",fields:[{type:"bool",name:"success",isNullable:!1}]},glog_req:{name:"glog_req",structName:"glue_msg_get_logits_req",className:"GlueMsgGetLogitsReq",fields:[{type:"int",name:"top_k",isNullable:!1}]},glog_res:{name:"glog_res",structName:"glue_msg_get_logits_res",className:"GlueMsgGetLogitsRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"arr_int",name:"tokens",isNullable:!1},{type:"arr_float",name:"probs",isNullable:!1}]},gemb_req:{name:"gemb_req",structName:"glue_msg_get_embeddings_req",className:"GlueMsgGetEmbeddingsReq",fields:[{type:"arr_int",name:"tokens",isNullable:!1}]},gemb_res:{name:"gemb_res",structName:"glue_msg_get_embeddings_res",className:"GlueMsgGetEmbeddingsRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"str",name:"message",isNullable:!1},{type:"arr_float",name:"embeddings",isNullable:!1}]},kvcr_req:{name:"kvcr_req",structName:"glue_msg_get_kv_remove_req",className:"GlueMsgGetKvRemoveReq",fields:[{type:"int",name:"n_keep",isNullable:!1},{type:"int",name:"n_discard",isNullable:!1}]},kvcr_res:{name:"kvcr_res",structName:"glue_msg_get_kv_remove_res",className:"GlueMsgGetKvRemoveRes",fields:[{type:"int",name:"n_past",isNullable:!1},{type:"bool",name:"success",isNullable:!1}]},kvcc_req:{name:"kvcc_req",structName:"glue_msg_get_kv_clear_req",className:"GlueMsgGetKvClearReq",fields:[]},kvcc_res:{name:"kvcc_res",structName:"glue_msg_get_kv_clear_res",className:"GlueMsgGetKvClearRes",fields:[{type:"int",name:"n_past",isNullable:!1},{type:"bool",name:"success",isNullable:!1}]},sesa_req:{name:"sesa_req",structName:"glue_msg_session_save_req",className:"GlueMsgSessionSaveReq",fields:[{type:"str",name:"session_path",isNullable:!1}]},sesa_res:{name:"sesa_res",structName:"glue_msg_session_save_res",className:"GlueMsgSessionSaveRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"arr_int",name:"tokens",isNullable:!1}]},sesl_req:{name:"sesl_req",structName:"glue_msg_session_load_req",className:"GlueMsgSessionLoadReq",fields:[{type:"str",name:"session_path",isNullable:!1},{type:"arr_int",name:"tokens",isNullable:!1}]},sesl_res:{name:"sesl_res",structName:"glue_msg_session_load_res",className:"GlueMsgSessionLoadRes",fields:[{type:"bool",name:"success",isNullable:!1}]},stat_req:{name:"stat_req",structName:"glue_msg_status_req",className:"GlueMsgStatusReq",fields:[]},stat_res:{name:"stat_res",structName:"glue_msg_status_res",className:"GlueMsgStatusRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"arr_int",name:"tokens",isNullable:!1}]},tben_req:{name:"tben_req",structName:"glue_msg_test_benchmark_req",className:"GlueMsgTestBenchmarkReq",fields:[{type:"str",name:"type",isNullable:!1},{type:"int",name:"n_samples",isNullable:!1}]},tben_res:{name:"tben_res",structName:"glue_msg_test_benchmark_res",className:"GlueMsgTestBenchmarkRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"str",name:"message",isNullable:!1},{type:"int",name:"t_ms",isNullable:!1}]},tper_req:{name:"tper_req",structName:"glue_msg_test_perplexity_req",className:"GlueMsgTestPerplexityReq",fields:[{type:"arr_int",name:"tokens",isNullable:!1}]},tper_res:{name:"tper_res",structName:"glue_msg_test_perplexity_res",className:"GlueMsgTestPerplexityRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"str",name:"message",isNullable:!1},{type:"float",name:"ppl",isNullable:!1},{type:"float",name:"nll",isNullable:!1},{type:"float",name:"cross_entropy",isNullable:!1},{type:"int",name:"n_tokens",isNullable:!1},{type:"int",name:"t_ms",isNullable:!1}]},cfmt_req:{name:"cfmt_req",structName:"glue_msg_chat_format_req",className:"GlueMsgChatFormatReq",fields:[{type:"str",name:"tmpl",isNullable:!0},{type:"bool",name:"add_ass",isNullable:!0},{type:"arr_str",name:"roles",isNullable:!1},{type:"arr_str",name:"contents",isNullable:!1}]},cfmt_res:{name:"cfmt_res",structName:"glue_msg_chat_format_res",className:"GlueMsgChatFormatRes",fields:[{type:"bool",name:"success",isNullable:!1},{type:"str",name:"message",isNullable:!1},{type:"str",name:"formatted_chat",isNullable:!1}]}},Ne=new Uint8Array([71,76,85,69]),Kt=0,wa=1,ya=2,va=3,Sa=4,ba=5,Ea=6,ka=7,Fa=8,Ma=9,xa=10,cn={str:Sa,int:ya,float:va,bool:wa,raw:ba,arr_str:Ma,arr_int:ka,arr_float:Fa,arr_bool:Ea,arr_raw:xa,null:Kt};function Aa(t){let r=0;const e=new DataView(t.buffer),n=()=>{const g=e.getUint32(r,!0);return r+=4,g},a=()=>{const g=e.getInt32(r,!0);return r+=4,g},o=()=>{const g=e.getFloat32(r,!0);return r+=4,g},s=()=>n()!==0,i=g=>{const k=g??n(),S=new TextDecoder().decode(t.slice(r,r+k));return r+=k,S},c=()=>{const g=n(),k=t.slice(r,r+g);return r+=g,k},l=g=>{const k=n(),S=new Array(k);for(let m=0;m<k;m++)S[m]=g();return S},d=()=>null,p=g=>{switch(g.type){case"str":return i();case"int":return a();case"float":return o();case"bool":return s();case"raw":return c();case"arr_str":return l(i);case"arr_int":return l(a);case"arr_float":return l(o);case"arr_bool":return l(s);case"arr_raw":return l(c);case"null":return d()}},f=t[0]===Ne[0]&&t[1]===Ne[1]&&t[2]===Ne[2]&&t[3]===Ne[3];if(r+=4,!f)throw new Error("Invalid magic number");if(n()!==ln)throw new Error("Invalid version number");const h=i(8),M=dn[h];if(!M)throw new Error(`Unknown message name: ${h}`);const E={_name:h};for(const g of M.fields){const k=n();if(k===Kt){if(!g.isNullable)throw new Error(`${h}: Expect field ${g.name} to be non-nullable`);E[g.name]=null;continue}if(k!==cn[g.type])throw new Error(`${h}: Expect field ${g.name} to have type ${g.type}`);E[g.name]=p(g)}return E}function Ta(t){const r=dn[t._name];if(!r)throw new Error(`Unknown message name: ${t._name}`);const e=[],n=u=>{const h=new ArrayBuffer(4);new DataView(h).setUint32(0,u,!0),e.push(new Uint8Array(h))},a=u=>{const h=new ArrayBuffer(4);new DataView(h).setInt32(0,u,!0),e.push(new Uint8Array(h))},o=u=>{const h=new ArrayBuffer(4);new DataView(h).setFloat32(0,u,!0),e.push(new Uint8Array(h))},s=u=>{n(u?1:0)},i=u=>{const h=new TextEncoder().encode(u);n(h.byteLength),e.push(h)},c=u=>{n(u.byteLength),e.push(u)},l=(u,h)=>{n(u.length);for(const M of u)h(M)};e.push(Ne),n(ln);{const u=new TextEncoder().encode(t._name);e.push(u)}for(const u of r.fields){const h=t[u.name];if(!u.isNullable&&h==null)throw new Error(`${t._name}: Expect field ${u.name} to be non-nullable`);if(h==null){n(Kt);continue}switch(n(cn[u.type]),u.type){case"str":i(h);break;case"int":a(h);break;case"float":o(h);break;case"bool":s(h);break;case"raw":c(h);break;case"arr_str":l(h,i);break;case"arr_int":l(h,a);break;case"arr_float":l(h,o);break;case"arr_bool":l(h,s);break;case"arr_raw":l(h,c);break}}const d=e.reduce((u,h)=>u+h.byteLength,0),p=new Uint8Array(d);let f=0;for(const u of e)p.set(u,f),f+=u.byteLength;return p}const Pa=t=>{const r=t.reduce((n,a)=>n+a.length,0),e=new Uint8Array(r);e.set(t[0],0);for(let n=1;n<t.length;n++)e.set(t[n],t[n-1].length);return e},Ra=new TextDecoder,_t=t=>Ra.decode(t),ir=/-(\d{5})-of-(\d{5})\.gguf(?:\?.*)?$/,lr=t=>{const r=t.match(ir);return r?{baseURL:t.replace(ir,""),current:parseInt(r[1]),total:parseInt(r[2])}:{baseURL:t,current:1,total:1}},Na=t=>{t.every(e=>!!e.name)&&t.length>1&&t.sort((n,a)=>{const o=lr(n.name),s=lr(a.name);return o.current-s.current})},dr=t=>new URL(t,document.baseURI).href,gt=t=>t.reduce((r,e)=>r+e,0),un=t=>!!t?.startsWith,Ia=()=>(async t=>{try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(t)}catch{return!1}})(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11])),Ca=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,8,1,6,0,6,64,25,11,11])),Da=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])),La=async()=>{if(!await Ca())throw new Error("WebAssembly runtime does not support exception handling");if(!await Da())throw new Error("WebAssembly runtime does not support SIMD")},za=/^.*\.gguf(?:\?.*)?$/,fn=t=>za.test(t),hn=()=>!!navigator.userAgent.match(/Version\/([0-9\._]+).*Mobile.*Safari.*/),Zt=t=>{const r=URL.createObjectURL(un(t)?new Blob([t],{type:"text/javascript"}):t);return new Worker(r,{type:"module"})},Ba=t=>(...r)=>{let e=[],n;return e.push(new Promise(a=>{n=a})),t(...r,(a,o)=>{n([a,o]),e.push(new Promise(s=>{n=s}))}),(async function*(){let a;for(let o=0,s=!1;!s;o++)[a,s]=await e[o],delete e[o],a!==void 0&&(yield a)})()},Oa="b7179-4abef75",Ua=`// Start the main llama.cpp
let wllamaMalloc;
let wllamaStart;
let wllamaAction;
let wllamaExit;
let wllamaDebug;

let Module = null;

//////////////////////////////////////////////////////////////
// UTILS
//////////////////////////////////////////////////////////////

// send message back to main thread
const msg = (data, transfer) => postMessage(data, transfer);

// Convert CPP log into JS log
const cppLogToJSLog = (line) => {
  const matched = line.match(/@@(DEBUG|INFO|WARN|ERROR)@@(.*)/);
  return !!matched
    ? {
        level: (matched[1] === 'INFO' ? 'debug' : matched[1]).toLowerCase(),
        text: matched[2],
      }
    : { level: 'log', text: line };
};

// Get module config that forwards stdout/err to main thread
const getWModuleConfig = (_argMainScriptBlob) => {
  var pathConfig = RUN_OPTIONS.pathConfig;
  var pthreadPoolSize = RUN_OPTIONS.nbThread;
  var argMainScriptBlob = _argMainScriptBlob;

  if (!pathConfig['wllama.wasm']) {
    throw new Error('"wllama.wasm" is missing in pathConfig');
  }
  return {
    noInitialRun: true,
    print: function (text) {
      if (arguments.length > 1)
        text = Array.prototype.slice.call(arguments).join(' ');
      msg({ verb: 'console.log', args: [text] });
    },
    printErr: function (text) {
      if (arguments.length > 1)
        text = Array.prototype.slice.call(arguments).join(' ');
      const logLine = cppLogToJSLog(text);
      msg({ verb: 'console.' + logLine.level, args: [logLine.text] });
    },
    locateFile: function (filename, basePath) {
      const p = pathConfig[filename];
      const truncate = (str) =>
        str.length > 128 ? \`\${str.substr(0, 128)}...\` : str;
      if (filename.match(/wllama\\.worker\\.js/)) {
        msg({
          verb: 'console.error',
          args: [
            '"wllama.worker.js" is removed from v2.2.1. Hint: make sure to clear browser\\'s cache.',
          ],
        });
      } else {
        msg({
          verb: 'console.debug',
          args: [\`Loading "\${filename}" from "\${truncate(p)}"\`],
        });
        return p;
      }
    },
    mainScriptUrlOrBlob: argMainScriptBlob,
    pthreadPoolSize,
    wasmMemory: pthreadPoolSize > 1 ? getWasmMemory() : null,
    onAbort: function (text) {
      msg({ verb: 'signal.abort', args: [text] });
    },
  };
};

// Get the memory to be used by wasm. (Only used in multi-thread mode)
// Because we have a weird OOM issue on iOS, we need to try some values
// See: https://github.com/emscripten-core/emscripten/issues/19144
//      https://github.com/godotengine/godot/issues/70621
const getWasmMemory = () => {
  let minBytes = 128 * 1024 * 1024;
  let maxBytes = 4096 * 1024 * 1024;
  let stepBytes = 128 * 1024 * 1024;
  while (maxBytes > minBytes) {
    try {
      const wasmMemory = new WebAssembly.Memory({
        initial: minBytes / 65536,
        maximum: maxBytes / 65536,
        shared: true,
      });
      return wasmMemory;
    } catch (e) {
      maxBytes -= stepBytes;
      continue; // retry
    }
  }
  throw new Error('Cannot allocate WebAssembly.Memory');
};

//////////////////////////////////////////////////////////////
// MEMFS PATCH
//////////////////////////////////////////////////////////////

/**
 * By default, emscripten uses memfs. The way it works is by
 * allocating new Uint8Array in javascript heap. This is not good
 * because it requires files to be copied to wasm heap each time
 * a file is read.
 *
 * HeapFS is an alternative, which resolves this problem by
 * allocating space for file directly inside wasm heap. This
 * allows us to mmap without doing any copy.
 *
 * For llama.cpp, this is great because we use MAP_SHARED
 *
 * Ref: https://github.com/ngxson/wllama/pull/39
 * Ref: https://github.com/emscripten-core/emscripten/blob/main/src/library_memfs.js
 *
 * Note 29/05/2024 @ngxson
 * Due to ftell() being limited to MAX_LONG, we cannot load files bigger than 2^31 bytes (or 2GB)
 * Ref: https://github.com/emscripten-core/emscripten/blob/main/system/lib/libc/musl/src/stdio/ftell.c
 */

const fsNameToFile = {}; // map Name => File
const fsIdToFile = {}; // map ID => File
let currFileId = 0;

// Patch and redirect memfs calls to wllama
const patchMEMFS = () => {
  const m = Module;
  // save functions
  m.MEMFS.stream_ops._read = m.MEMFS.stream_ops.read;
  m.MEMFS.stream_ops._write = m.MEMFS.stream_ops.write;
  m.MEMFS.stream_ops._llseek = m.MEMFS.stream_ops.llseek;
  m.MEMFS.stream_ops._allocate = m.MEMFS.stream_ops.allocate;
  m.MEMFS.stream_ops._mmap = m.MEMFS.stream_ops.mmap;
  m.MEMFS.stream_ops._msync = m.MEMFS.stream_ops.msync;

  const patchStream = (stream) => {
    const name = stream.node.name;
    if (fsNameToFile[name]) {
      const f = fsNameToFile[name];
      stream.node.contents = m.HEAPU8.subarray(f.ptr, f.ptr + f.size);
      stream.node.usedBytes = f.size;
    }
  };

  // replace "read" functions
  m.MEMFS.stream_ops.read = function (
    stream,
    buffer,
    offset,
    length,
    position
  ) {
    patchStream(stream);
    return m.MEMFS.stream_ops._read(stream, buffer, offset, length, position);
  };
  m.MEMFS.ops_table.file.stream.read = m.MEMFS.stream_ops.read;

  // replace "llseek" functions
  m.MEMFS.stream_ops.llseek = function (stream, offset, whence) {
    patchStream(stream);
    return m.MEMFS.stream_ops._llseek(stream, offset, whence);
  };
  m.MEMFS.ops_table.file.stream.llseek = m.MEMFS.stream_ops.llseek;

  // replace "mmap" functions
  m.MEMFS.stream_ops.mmap = function (stream, length, position, prot, flags) {
    patchStream(stream);
    const name = stream.node.name;
    if (fsNameToFile[name]) {
      const f = fsNameToFile[name];
      return {
        ptr: f.ptr + position,
        allocated: false,
      };
    } else {
      return m.MEMFS.stream_ops._mmap(stream, length, position, prot, flags);
    }
  };
  m.MEMFS.ops_table.file.stream.mmap = m.MEMFS.stream_ops.mmap;

  // mount FS
  m.FS.mkdir('/models');
  m.FS.mount(m.MEMFS, { root: '.' }, '/models');
};

// Allocate a new file in wllama heapfs, returns file ID
const heapfsAlloc = (name, size) => {
  if (size < 1) {
    throw new Error('File size must be bigger than 0');
  }
  const m = Module;
  const ptr = m.mmapAlloc(size);
  const file = {
    ptr: ptr,
    size: size,
    id: currFileId++,
  };
  fsIdToFile[file.id] = file;
  fsNameToFile[name] = file;
  return file.id;
};

// Add new file to wllama heapfs, return number of written bytes
const heapfsWrite = (id, buffer, offset) => {
  const m = Module;
  if (fsIdToFile[id]) {
    const { ptr, size } = fsIdToFile[id];
    const afterWriteByte = offset + buffer.byteLength;
    if (afterWriteByte > size) {
      throw new Error(
        \`File ID \${id} write out of bound, afterWriteByte = \${afterWriteByte} while size = \${size}\`
      );
    }
    m.HEAPU8.set(buffer, ptr + offset);
    return buffer.byteLength;
  } else {
    throw new Error(\`File ID \${id} not found in heapfs\`);
  }
};

//////////////////////////////////////////////////////////////
// MAIN CODE
//////////////////////////////////////////////////////////////

const callWrapper = (name, ret, args) => {
  const fn = Module.cwrap(name, ret, args);
  return async (action, req) => {
    let result;
    try {
      if (args.length === 2) {
        result = await fn(action, req);
      } else {
        result = fn();
      }
    } catch (ex) {
      console.error(ex);
      throw ex;
    }
    return result;
  };
};

onmessage = async (e) => {
  if (!e.data) return;
  const { verb, args, callbackId } = e.data;

  if (!callbackId) {
    msg({ verb: 'console.error', args: ['callbackId is required', e.data] });
    return;
  }

  if (verb === 'module.init') {
    const argMainScriptBlob = args[0];
    try {
      Module = getWModuleConfig(argMainScriptBlob);
      Module.onRuntimeInitialized = () => {
        // async call once module is ready
        // init FS
        patchMEMFS();
        // init cwrap
        const pointer = 'number';
        // TODO: note sure why emscripten cannot bind if there is only 1 argument
        wllamaMalloc = callWrapper('wllama_malloc', pointer, [
          'number',
          pointer,
        ]);
        wllamaStart = callWrapper('wllama_start', 'string', []);
        wllamaAction = callWrapper('wllama_action', pointer, [
          'string',
          pointer,
        ]);
        wllamaExit = callWrapper('wllama_exit', 'string', []);
        wllamaDebug = callWrapper('wllama_debug', 'string', []);
        msg({ callbackId, result: null });
      };
      wModuleInit();
    } catch (err) {
      msg({ callbackId, err });
    }
    return;
  }

  if (verb === 'fs.alloc') {
    const argFilename = args[0];
    const argSize = args[1];
    try {
      // create blank file
      const emptyBuffer = new ArrayBuffer(0);
      Module['FS_createDataFile'](
        '/models',
        argFilename,
        emptyBuffer,
        true,
        true,
        true
      );
      // alloc data on heap
      const fileId = heapfsAlloc(argFilename, argSize);
      msg({ callbackId, result: { fileId } });
    } catch (err) {
      msg({ callbackId, err });
    }
    return;
  }

  if (verb === 'fs.write') {
    const argFileId = args[0];
    const argBuffer = args[1];
    const argOffset = args[2];
    try {
      const writtenBytes = heapfsWrite(argFileId, argBuffer, argOffset);
      msg({ callbackId, result: { writtenBytes } });
    } catch (err) {
      msg({ callbackId, err });
    }
    return;
  }

  if (verb === 'wllama.start') {
    try {
      const result = await wllamaStart();
      msg({ callbackId, result });
    } catch (err) {
      msg({ callbackId, err });
    }
    return;
  }

  if (verb === 'wllama.action') {
    const argAction = args[0];
    const argEncodedMsg = args[1];
    try {
      const inputPtr = await wllamaMalloc(argEncodedMsg.byteLength, 0);
      // copy data to wasm heap
      const inputBuffer = new Uint8Array(
        Module.HEAPU8.buffer,
        inputPtr,
        argEncodedMsg.byteLength
      );
      inputBuffer.set(argEncodedMsg, 0);
      const outputPtr = await wllamaAction(argAction, inputPtr);
      // length of output buffer is written at the first 4 bytes of input buffer
      const outputLen = new Uint32Array(Module.HEAPU8.buffer, inputPtr, 1)[0];
      // copy the output buffer to JS heap
      const outputBuffer = new Uint8Array(outputLen);
      const outputSrcView = new Uint8Array(
        Module.HEAPU8.buffer,
        outputPtr,
        outputLen
      );
      outputBuffer.set(outputSrcView, 0); // copy it
      msg({ callbackId, result: outputBuffer }, [outputBuffer.buffer]);
    } catch (err) {
      msg({ callbackId, err });
    }
    return;
  }

  if (verb === 'wllama.exit') {
    try {
      const result = await wllamaExit();
      msg({ callbackId, result });
    } catch (err) {
      msg({ callbackId, err });
    }
    return;
  }

  if (verb === 'wllama.debug') {
    try {
      const result = await wllamaDebug();
      msg({ callbackId, result });
    } catch (err) {
      msg({ callbackId, err });
    }
    return;
  }
};
`,mn=`let accessHandle;
let abortController = new AbortController();

async function openFile(filename) {
  const opfsRoot = await navigator.storage.getDirectory();
  const cacheDir = await opfsRoot.getDirectoryHandle('cache', { create: true });
  const fileHandler = await cacheDir.getFileHandle(filename, { create: true });
  accessHandle = await fileHandler.createSyncAccessHandle();
  accessHandle.truncate(0); // clear file content
}

async function writeFile(buf) {
  accessHandle.write(buf);
}

async function closeFile() {
  accessHandle.flush();
  accessHandle.close();
}

async function writeTextFile(filename, str) {
  await openFile(filename);
  await writeFile(new TextEncoder().encode(str));
  await closeFile();
}

const throttled = (func, delay) => {
  let lastRun = 0;
  return (...args) => {
    const now = Date.now();
    if (now - lastRun > delay) {
      lastRun = now;
      func.apply(null, args);
    }
  };
};

const assertNonNull = (val) => {
  if (val === null || val === undefined) {
    throw new Error('OPFS Worker: Assertion failed');
  }
};

// respond to main thread
const resOK = () => postMessage({ ok: true });
const resProgress = (loaded, total) =>
  postMessage({ progress: { loaded, total } });
const resErr = (err) => postMessage({ err });

onmessage = async (e) => {
  try {
    if (!e.data) return;

    /**
     * @param {Object} e.data
     *
     * Fine-control FS actions:
     * - { action: 'open', filename: 'string' }
     * - { action: 'write', buf: ArrayBuffer }
     * - { action: 'close' }
     *
     * Simple write API:
     * - { action: 'write-simple', filename: 'string', buf: ArrayBuffer }
     *
     * Download API:
     * - { action: 'download', url: 'string', filename: 'string', options: Object, metadataFileName: 'string' }
     * - { action: 'download-abort' }
     */
    const { action, filename, buf, url, options, metadataFileName } = e.data;

    if (action === 'open') {
      assertNonNull(filename);
      await openFile(filename);
      return resOK();
    } else if (action === 'write') {
      assertNonNull(buf);
      await writeFile(buf);
      return resOK();
    } else if (action === 'close') {
      await closeFile();
      return resOK();
    } else if (action === 'write-simple') {
      assertNonNull(filename);
      assertNonNull(buf);
      await openFile(filename);
      await writeFile(buf);
      await closeFile();
      return resOK();
    } else if (action === 'download') {
      assertNonNull(url);
      assertNonNull(filename);
      assertNonNull(metadataFileName);
      assertNonNull(options);
      assertNonNull(options.aborted);
      abortController = new AbortController();
      if (options.aborted) abortController.abort();
      const response = await fetch(url, {
        ...options,
        signal: abortController.signal,
      });
      const contentLength = response.headers.get('content-length');
      const etag = (response.headers.get('etag') || '').replace(
        /[^A-Za-z0-9]/g,
        ''
      );
      const total = parseInt(contentLength, 10);
      const reader = response.body.getReader();
      await openFile(filename);
      let loaded = 0;
      const throttledProgress = throttled(resProgress, 100);
      while (true) {
        const { done, value } = await reader.read();
        if (done) break;
        loaded += value.byteLength;
        await writeFile(value);
        throttledProgress(loaded, total);
      }
      resProgress(total, total); // 100% done
      await closeFile();
      // make sure this is in-sync with CacheEntryMetadata
      await writeTextFile(
        metadataFileName,
        JSON.stringify({
          originalURL: url,
          originalSize: total,
          etag,
        })
      );
      return resOK();
    } else if (action === 'download-abort') {
      if (abortController) {
        abortController.abort();
      }
      return;
    }

    throw new Error('OPFS Worker: Invalid action', e.data);
  } catch (err) {
    return resErr(err);
  }
};
`,Ha='var Module=typeof Module!="undefined"?Module:{};var ENVIRONMENT_IS_WEB=typeof window=="object";var ENVIRONMENT_IS_WORKER=typeof WorkerGlobalScope!="undefined";var ENVIRONMENT_IS_NODE=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"&&process.type!="renderer";var ENVIRONMENT_IS_PTHREAD=ENVIRONMENT_IS_WORKER&&self.name?.startsWith("em-pthread");if(ENVIRONMENT_IS_NODE){var worker_threads=require("worker_threads");global.Worker=worker_threads.Worker;ENVIRONMENT_IS_WORKER=!worker_threads.isMainThread;ENVIRONMENT_IS_PTHREAD=ENVIRONMENT_IS_WORKER&&worker_threads["workerData"]=="em-pthread"}var moduleOverrides=Object.assign({},Module);var arguments_=[];var thisProgram="./this.program";var quit_=(status,toThrow)=>{throw toThrow};var _scriptName=typeof document!="undefined"?document.currentScript?.src:undefined;if(ENVIRONMENT_IS_NODE){_scriptName=__filename}else if(ENVIRONMENT_IS_WORKER){_scriptName=self.location.href}var scriptDirectory="";function locateFile(path){if(Module["locateFile"]){return Module["locateFile"](path,scriptDirectory)}return scriptDirectory+path}var readAsync,readBinary;if(ENVIRONMENT_IS_NODE){var fs=require("fs");var nodePath=require("path");scriptDirectory=__dirname+"/";readBinary=filename=>{filename=isFileURI(filename)?new URL(filename):filename;var ret=fs.readFileSync(filename);return ret};readAsync=async(filename,binary=true)=>{filename=isFileURI(filename)?new URL(filename):filename;var ret=fs.readFileSync(filename,binary?undefined:"utf8");return ret};if(!Module["thisProgram"]&&process.argv.length>1){thisProgram=process.argv[1].replace(/\\\\/g,"/")}arguments_=process.argv.slice(2);if(typeof module!="undefined"){module["exports"]=Module}quit_=(status,toThrow)=>{process.exitCode=status;throw toThrow}}else if(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER){if(ENVIRONMENT_IS_WORKER){scriptDirectory=self.location.href}else if(typeof document!="undefined"&&document.currentScript){scriptDirectory=document.currentScript.src}if(scriptDirectory.startsWith("blob:")){scriptDirectory=""}else{scriptDirectory=scriptDirectory.slice(0,scriptDirectory.replace(/[?#].*/,"").lastIndexOf("/")+1)}if(!ENVIRONMENT_IS_NODE){if(ENVIRONMENT_IS_WORKER){readBinary=url=>{var xhr=new XMLHttpRequest;xhr.open("GET",url,false);xhr.responseType="arraybuffer";xhr.send(null);return new Uint8Array(xhr.response)}}readAsync=async url=>{if(isFileURI(url)){return new Promise((resolve,reject)=>{var xhr=new XMLHttpRequest;xhr.open("GET",url,true);xhr.responseType="arraybuffer";xhr.onload=()=>{if(xhr.status==200||xhr.status==0&&xhr.response){resolve(xhr.response);return}reject(xhr.status)};xhr.onerror=reject;xhr.send(null)})}var response=await fetch(url,{credentials:"same-origin"});if(response.ok){return response.arrayBuffer()}throw new Error(response.status+" : "+response.url)}}}else{}var defaultPrint=console.log.bind(console);var defaultPrintErr=console.error.bind(console);if(ENVIRONMENT_IS_NODE){defaultPrint=(...args)=>fs.writeSync(1,args.join(" ")+"\\n");defaultPrintErr=(...args)=>fs.writeSync(2,args.join(" ")+"\\n")}var out=Module["print"]||defaultPrint;var err=Module["printErr"]||defaultPrintErr;Object.assign(Module,moduleOverrides);moduleOverrides=null;if(Module["arguments"])arguments_=Module["arguments"];if(Module["thisProgram"])thisProgram=Module["thisProgram"];var wasmBinary=Module["wasmBinary"];var wasmMemory;var wasmModule;var ABORT=false;var EXITSTATUS;var HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAP64,HEAPU64,HEAPF64;var runtimeInitialized=false;var isFileURI=filename=>filename.startsWith("file://");function GROWABLE_HEAP_I8(){if(wasmMemory.buffer!=HEAP8.buffer){updateMemoryViews()}return HEAP8}function GROWABLE_HEAP_U8(){if(wasmMemory.buffer!=HEAP8.buffer){updateMemoryViews()}return HEAPU8}function GROWABLE_HEAP_I16(){if(wasmMemory.buffer!=HEAP8.buffer){updateMemoryViews()}return HEAP16}function GROWABLE_HEAP_I32(){if(wasmMemory.buffer!=HEAP8.buffer){updateMemoryViews()}return HEAP32}function GROWABLE_HEAP_U32(){if(wasmMemory.buffer!=HEAP8.buffer){updateMemoryViews()}return HEAPU32}function GROWABLE_HEAP_F32(){if(wasmMemory.buffer!=HEAP8.buffer){updateMemoryViews()}return HEAPF32}function GROWABLE_HEAP_F64(){if(wasmMemory.buffer!=HEAP8.buffer){updateMemoryViews()}return HEAPF64}if(ENVIRONMENT_IS_PTHREAD){var wasmModuleReceived;if(ENVIRONMENT_IS_NODE){var parentPort=worker_threads["parentPort"];parentPort.on("message",msg=>onmessage({data:msg}));Object.assign(globalThis,{self:global,postMessage:msg=>parentPort.postMessage(msg)})}var initializedJS=false;function threadPrintErr(...args){var text=args.join(" ");if(ENVIRONMENT_IS_NODE){fs.writeSync(2,text+"\\n");return}console.error(text)}if(!Module["printErr"])err=threadPrintErr;function threadAlert(...args){var text=args.join(" ");postMessage({cmd:"alert",text,threadId:_pthread_self()})}self.alert=threadAlert;self.onunhandledrejection=e=>{throw e.reason||e};function handleMessage(e){try{var msgData=e["data"];var cmd=msgData.cmd;if(cmd==="load"){let messageQueue=[];self.onmessage=e=>messageQueue.push(e);self.startWorker=instance=>{postMessage({cmd:"loaded"});for(let msg of messageQueue){handleMessage(msg)}self.onmessage=handleMessage};for(const handler of msgData.handlers){if(!Module[handler]||Module[handler].proxy){Module[handler]=(...args)=>{postMessage({cmd:"callHandler",handler,args})};if(handler=="print")out=Module[handler];if(handler=="printErr")err=Module[handler]}}wasmMemory=msgData.wasmMemory;updateMemoryViews();wasmModuleReceived(msgData.wasmModule)}else if(cmd==="run"){establishStackSpace(msgData.pthread_ptr);__emscripten_thread_init(msgData.pthread_ptr,0,0,1,0,0);PThread.receiveObjectTransfer(msgData);PThread.threadInitTLS();__emscripten_thread_mailbox_await(msgData.pthread_ptr);if(!initializedJS){initializedJS=true}try{invokeEntryPoint(msgData.start_routine,msgData.arg)}catch(ex){if(ex!="unwind"){throw ex}}}else if(msgData.target==="setimmediate"){}else if(cmd==="checkMailbox"){if(initializedJS){checkMailbox()}}else if(cmd){err(`worker: received unknown command ${cmd}`);err(msgData)}}catch(ex){__emscripten_thread_crashed();throw ex}}self.onmessage=handleMessage}function updateMemoryViews(){var b=wasmMemory.buffer;Module["HEAP8"]=HEAP8=new Int8Array(b);Module["HEAP16"]=HEAP16=new Int16Array(b);Module["HEAPU8"]=HEAPU8=new Uint8Array(b);Module["HEAPU16"]=HEAPU16=new Uint16Array(b);Module["HEAP32"]=HEAP32=new Int32Array(b);Module["HEAPU32"]=HEAPU32=new Uint32Array(b);Module["HEAPF32"]=HEAPF32=new Float32Array(b);Module["HEAPF64"]=HEAPF64=new Float64Array(b);Module["HEAP64"]=HEAP64=new BigInt64Array(b);Module["HEAPU64"]=HEAPU64=new BigUint64Array(b)}if(!ENVIRONMENT_IS_PTHREAD){if(Module["wasmMemory"]){wasmMemory=Module["wasmMemory"]}else{var INITIAL_MEMORY=Module["INITIAL_MEMORY"]||134217728;wasmMemory=new WebAssembly.Memory({initial:INITIAL_MEMORY/65536,maximum:65536,shared:true})}updateMemoryViews()}function preRun(){if(Module["preRun"]){if(typeof Module["preRun"]=="function")Module["preRun"]=[Module["preRun"]];while(Module["preRun"].length){addOnPreRun(Module["preRun"].shift())}}callRuntimeCallbacks(onPreRuns)}function initRuntime(){runtimeInitialized=true;if(ENVIRONMENT_IS_PTHREAD)return startWorker(Module);if(!Module["noFSInit"]&&!FS.initialized)FS.init();TTY.init();wasmExports["I"]();FS.ignorePermissions=false}function preMain(){}function postRun(){if(ENVIRONMENT_IS_PTHREAD)return;if(Module["postRun"]){if(typeof Module["postRun"]=="function")Module["postRun"]=[Module["postRun"]];while(Module["postRun"].length){addOnPostRun(Module["postRun"].shift())}}callRuntimeCallbacks(onPostRuns)}var runDependencies=0;var dependenciesFulfilled=null;function getUniqueRunDependency(id){return id}function addRunDependency(id){runDependencies++;Module["monitorRunDependencies"]?.(runDependencies)}function removeRunDependency(id){runDependencies--;Module["monitorRunDependencies"]?.(runDependencies);if(runDependencies==0){if(dependenciesFulfilled){var callback=dependenciesFulfilled;dependenciesFulfilled=null;callback()}}}function abort(what){Module["onAbort"]?.(what);what="Aborted("+what+")";err(what);ABORT=true;what+=". Build with -sASSERTIONS for more info.";if(runtimeInitialized){___trap()}var e=new WebAssembly.RuntimeError(what);throw e}var wasmBinaryFile;function findWasmBinary(){return locateFile("wllama.wasm")}function getBinarySync(file){if(file==wasmBinaryFile&&wasmBinary){return new Uint8Array(wasmBinary)}if(readBinary){return readBinary(file)}throw"both async and sync fetching of the wasm failed"}async function getWasmBinary(binaryFile){if(!wasmBinary){try{var response=await readAsync(binaryFile);return new Uint8Array(response)}catch{}}return getBinarySync(binaryFile)}async function instantiateArrayBuffer(binaryFile,imports){try{var binary=await getWasmBinary(binaryFile);var instance=await WebAssembly.instantiate(binary,imports);return instance}catch(reason){err(`failed to asynchronously prepare wasm: ${reason}`);abort(reason)}}async function instantiateAsync(binary,binaryFile,imports){if(!binary&&typeof WebAssembly.instantiateStreaming=="function"&&!isFileURI(binaryFile)&&!ENVIRONMENT_IS_NODE){try{var response=fetch(binaryFile,{credentials:"same-origin"});var instantiationResult=await WebAssembly.instantiateStreaming(response,imports);return instantiationResult}catch(reason){err(`wasm streaming compile failed: ${reason}`);err("falling back to ArrayBuffer instantiation")}}return instantiateArrayBuffer(binaryFile,imports)}function getWasmImports(){assignWasmImports();return{a:wasmImports}}async function createWasm(){function receiveInstance(instance,module){wasmExports=instance.exports;wasmExports=applySignatureConversions(wasmExports);registerTLSInit(wasmExports["P"]);wasmTable=wasmExports["S"];wasmModule=module;removeRunDependency("wasm-instantiate");return wasmExports}addRunDependency("wasm-instantiate");function receiveInstantiationResult(result){return receiveInstance(result["instance"],result["module"])}var info=getWasmImports();if(Module["instantiateWasm"]){return new Promise((resolve,reject)=>{Module["instantiateWasm"](info,(mod,inst)=>{receiveInstance(mod,inst);resolve(mod.exports)})})}if(ENVIRONMENT_IS_PTHREAD){return new Promise(resolve=>{wasmModuleReceived=module=>{var instance=new WebAssembly.Instance(module,getWasmImports());resolve(receiveInstance(instance,module))}})}wasmBinaryFile??=findWasmBinary();var result=await instantiateAsync(wasmBinary,wasmBinaryFile,info);var exports=receiveInstantiationResult(result);return exports}class ExitStatus{name="ExitStatus";constructor(status){this.message=`Program terminated with exit(${status})`;this.status=status}}Module["ExitStatus"]=ExitStatus;var terminateWorker=worker=>{worker.terminate();worker.onmessage=e=>{}};Module["terminateWorker"]=terminateWorker;var cleanupThread=pthread_ptr=>{var worker=PThread.pthreads[pthread_ptr];PThread.returnWorkerToPool(worker)};Module["cleanupThread"]=cleanupThread;var callRuntimeCallbacks=callbacks=>{while(callbacks.length>0){callbacks.shift()(Module)}};Module["callRuntimeCallbacks"]=callRuntimeCallbacks;var onPreRuns=[];Module["onPreRuns"]=onPreRuns;var addOnPreRun=cb=>onPreRuns.unshift(cb);Module["addOnPreRun"]=addOnPreRun;var spawnThread=threadParams=>{var worker=PThread.getNewWorker();if(!worker){return 6}PThread.runningWorkers.push(worker);PThread.pthreads[threadParams.pthread_ptr]=worker;worker.pthread_ptr=threadParams.pthread_ptr;var msg={cmd:"run",start_routine:threadParams.startRoutine,arg:threadParams.arg,pthread_ptr:threadParams.pthread_ptr};if(ENVIRONMENT_IS_NODE){worker.unref()}worker.postMessage(msg,threadParams.transferList);return 0};Module["spawnThread"]=spawnThread;var runtimeKeepaliveCounter=0;Module["runtimeKeepaliveCounter"]=runtimeKeepaliveCounter;var keepRuntimeAlive=()=>noExitRuntime||runtimeKeepaliveCounter>0;Module["keepRuntimeAlive"]=keepRuntimeAlive;var stackSave=()=>_emscripten_stack_get_current();Module["stackSave"]=stackSave;var stackRestore=val=>__emscripten_stack_restore(val);Module["stackRestore"]=stackRestore;var stackAlloc=sz=>__emscripten_stack_alloc(sz);Module["stackAlloc"]=stackAlloc;var INT53_MAX=9007199254740992;Module["INT53_MAX"]=INT53_MAX;var INT53_MIN=-9007199254740992;Module["INT53_MIN"]=INT53_MIN;var bigintToI53Checked=num=>num<INT53_MIN||num>INT53_MAX?NaN:Number(num);Module["bigintToI53Checked"]=bigintToI53Checked;var proxyToMainThread=(funcIndex,emAsmAddr,sync,...callArgs)=>{var serializedNumCallArgs=callArgs.length*2;var sp=stackSave();var args=stackAlloc(serializedNumCallArgs*8);var b=args>>>3;for(var i=0;i<callArgs.length;i++){var arg=callArgs[i];if(typeof arg=="bigint"){HEAP64[b+2*i]=1n;HEAP64[b+2*i+1]=arg}else{HEAP64[b+2*i]=0n;GROWABLE_HEAP_F64()[b+2*i+1>>>0]=arg}}var rtn=__emscripten_run_on_main_thread_js(funcIndex,emAsmAddr,serializedNumCallArgs,args,sync);stackRestore(sp);return rtn};Module["proxyToMainThread"]=proxyToMainThread;function _proc_exit(code){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(0,0,1,code);EXITSTATUS=code;if(!keepRuntimeAlive()){PThread.terminateAllThreads();Module["onExit"]?.(code);ABORT=true}quit_(code,new ExitStatus(code))}Module["_proc_exit"]=_proc_exit;var handleException=e=>{if(e instanceof ExitStatus||e=="unwind"){return EXITSTATUS}quit_(1,e)};Module["handleException"]=handleException;function exitOnMainThread(returnCode){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(1,0,0,returnCode);_exit(returnCode)}Module["exitOnMainThread"]=exitOnMainThread;var exitJS=(status,implicit)=>{EXITSTATUS=status;if(ENVIRONMENT_IS_PTHREAD){exitOnMainThread(status);throw"unwind"}_proc_exit(status)};Module["exitJS"]=exitJS;var _exit=exitJS;Module["_exit"]=_exit;var PThread={unusedWorkers:[],runningWorkers:[],tlsInitFunctions:[],pthreads:{},init(){if(!ENVIRONMENT_IS_PTHREAD){PThread.initMainThread()}},initMainThread(){var pthreadPoolSize=Module["pthreadPoolSize"];while(pthreadPoolSize--){PThread.allocateUnusedWorker()}addOnPreRun(()=>{addRunDependency("loading-workers");PThread.loadWasmModuleToAllWorkers(()=>removeRunDependency("loading-workers"))})},terminateAllThreads:()=>{for(var worker of PThread.runningWorkers){terminateWorker(worker)}for(var worker of PThread.unusedWorkers){terminateWorker(worker)}PThread.unusedWorkers=[];PThread.runningWorkers=[];PThread.pthreads={}},returnWorkerToPool:worker=>{var pthread_ptr=worker.pthread_ptr;delete PThread.pthreads[pthread_ptr];PThread.unusedWorkers.push(worker);PThread.runningWorkers.splice(PThread.runningWorkers.indexOf(worker),1);worker.pthread_ptr=0;__emscripten_thread_free_data(pthread_ptr)},receiveObjectTransfer(data){},threadInitTLS(){PThread.tlsInitFunctions.forEach(f=>f())},loadWasmModuleToWorker:worker=>new Promise(onFinishedLoading=>{worker.onmessage=e=>{var d=e["data"];var cmd=d.cmd;if(d.targetThread&&d.targetThread!=_pthread_self()){var targetWorker=PThread.pthreads[d.targetThread];if(targetWorker){targetWorker.postMessage(d,d.transferList)}else{err(`Internal error! Worker sent a message "${cmd}" to target pthread ${d.targetThread}, but that thread no longer exists!`)}return}if(cmd==="checkMailbox"){checkMailbox()}else if(cmd==="spawnThread"){spawnThread(d)}else if(cmd==="cleanupThread"){cleanupThread(d.thread)}else if(cmd==="loaded"){worker.loaded=true;if(ENVIRONMENT_IS_NODE&&!worker.pthread_ptr){worker.unref()}onFinishedLoading(worker)}else if(cmd==="alert"){alert(`Thread ${d.threadId}: ${d.text}`)}else if(d.target==="setimmediate"){worker.postMessage(d)}else if(cmd==="callHandler"){Module[d.handler](...d.args)}else if(cmd){err(`worker sent an unknown command ${cmd}`)}};worker.onerror=e=>{var message="worker sent an error!";err(`${message} ${e.filename}:${e.lineno}: ${e.message}`);throw e};if(ENVIRONMENT_IS_NODE){worker.on("message",data=>worker.onmessage({data}));worker.on("error",e=>worker.onerror(e))}var handlers=[];var knownHandlers=["onExit","onAbort","print","printErr"];for(var handler of knownHandlers){if(Module.propertyIsEnumerable(handler)){handlers.push(handler)}}worker.postMessage({cmd:"load",handlers,wasmMemory,wasmModule})}),loadWasmModuleToAllWorkers(onMaybeReady){if(ENVIRONMENT_IS_PTHREAD){return onMaybeReady()}let pthreadPoolReady=Promise.all(PThread.unusedWorkers.map(PThread.loadWasmModuleToWorker));pthreadPoolReady.then(onMaybeReady)},allocateUnusedWorker(){var worker;var workerOptions={workerData:"em-pthread",name:"em-pthread"};var pthreadMainJs=_scriptName;if(Module["mainScriptUrlOrBlob"]){pthreadMainJs=Module["mainScriptUrlOrBlob"];if(typeof pthreadMainJs!="string"){pthreadMainJs=URL.createObjectURL(pthreadMainJs)}}worker=new Worker(pthreadMainJs,workerOptions);PThread.unusedWorkers.push(worker)},getNewWorker(){if(PThread.unusedWorkers.length==0){PThread.allocateUnusedWorker();PThread.loadWasmModuleToWorker(PThread.unusedWorkers[0])}return PThread.unusedWorkers.pop()}};Module["PThread"]=PThread;var onPostRuns=[];Module["onPostRuns"]=onPostRuns;var addOnPostRun=cb=>onPostRuns.unshift(cb);Module["addOnPostRun"]=addOnPostRun;var establishStackSpace=pthread_ptr=>{updateMemoryViews();var stackHigh=GROWABLE_HEAP_U32()[pthread_ptr+52>>>2>>>0];var stackSize=GROWABLE_HEAP_U32()[pthread_ptr+56>>>2>>>0];var stackLow=stackHigh-stackSize;_emscripten_stack_set_limits(stackHigh,stackLow);stackRestore(stackHigh)};Module["establishStackSpace"]=establishStackSpace;function getValue(ptr,type="i8"){if(type.endsWith("*"))type="*";switch(type){case"i1":return GROWABLE_HEAP_I8()[ptr>>>0];case"i8":return GROWABLE_HEAP_I8()[ptr>>>0];case"i16":return GROWABLE_HEAP_I16()[ptr>>>1>>>0];case"i32":return GROWABLE_HEAP_I32()[ptr>>>2>>>0];case"i64":return HEAP64[ptr>>>3];case"float":return GROWABLE_HEAP_F32()[ptr>>>2>>>0];case"double":return GROWABLE_HEAP_F64()[ptr>>>3>>>0];case"*":return GROWABLE_HEAP_U32()[ptr>>>2>>>0];default:abort(`invalid type for getValue: ${type}`)}}Module["getValue"]=getValue;var wasmTableMirror=[];Module["wasmTableMirror"]=wasmTableMirror;var wasmTable;Module["wasmTable"]=wasmTable;var getWasmTableEntry=funcPtr=>{var func=wasmTableMirror[funcPtr];if(!func){if(funcPtr>=wasmTableMirror.length)wasmTableMirror.length=funcPtr+1;wasmTableMirror[funcPtr]=func=wasmTable.get(funcPtr)}return func};Module["getWasmTableEntry"]=getWasmTableEntry;var invokeEntryPoint=(ptr,arg)=>{runtimeKeepaliveCounter=0;noExitRuntime=0;var result=getWasmTableEntry(ptr)(arg);function finish(result){if(keepRuntimeAlive()){EXITSTATUS=result}else{__emscripten_thread_exit(result)}}finish(result)};Module["invokeEntryPoint"]=invokeEntryPoint;var noExitRuntime=Module["noExitRuntime"]||true;Module["noExitRuntime"]=noExitRuntime;var registerTLSInit=tlsInitFunc=>PThread.tlsInitFunctions.push(tlsInitFunc);Module["registerTLSInit"]=registerTLSInit;function setValue(ptr,value,type="i8"){if(type.endsWith("*"))type="*";switch(type){case"i1":GROWABLE_HEAP_I8()[ptr>>>0]=value;break;case"i8":GROWABLE_HEAP_I8()[ptr>>>0]=value;break;case"i16":GROWABLE_HEAP_I16()[ptr>>>1>>>0]=value;break;case"i32":GROWABLE_HEAP_I32()[ptr>>>2>>>0]=value;break;case"i64":HEAP64[ptr>>>3]=BigInt(value);break;case"float":GROWABLE_HEAP_F32()[ptr>>>2>>>0]=value;break;case"double":GROWABLE_HEAP_F64()[ptr>>>3>>>0]=value;break;case"*":GROWABLE_HEAP_U32()[ptr>>>2>>>0]=value;break;default:abort(`invalid type for setValue: ${type}`)}}Module["setValue"]=setValue;function pthreadCreateProxied(pthread_ptr,attr,startRoutine,arg){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(2,0,1,pthread_ptr,attr,startRoutine,arg);return ___pthread_create_js(pthread_ptr,attr,startRoutine,arg)}Module["pthreadCreateProxied"]=pthreadCreateProxied;var _emscripten_has_threading_support=()=>typeof SharedArrayBuffer!="undefined";Module["_emscripten_has_threading_support"]=_emscripten_has_threading_support;function ___pthread_create_js(pthread_ptr,attr,startRoutine,arg){pthread_ptr>>>=0;attr>>>=0;startRoutine>>>=0;arg>>>=0;if(!_emscripten_has_threading_support()){return 6}var transferList=[];var error=0;if(ENVIRONMENT_IS_PTHREAD&&(transferList.length===0||error)){return pthreadCreateProxied(pthread_ptr,attr,startRoutine,arg)}if(error)return error;var threadParams={startRoutine,pthread_ptr,arg,transferList};if(ENVIRONMENT_IS_PTHREAD){threadParams.cmd="spawnThread";postMessage(threadParams,transferList);return 0}return spawnThread(threadParams)}Module["___pthread_create_js"]=___pthread_create_js;var syscallGetVarargI=()=>{var ret=GROWABLE_HEAP_I32()[+SYSCALLS.varargs>>>2>>>0];SYSCALLS.varargs+=4;return ret};Module["syscallGetVarargI"]=syscallGetVarargI;var syscallGetVarargP=syscallGetVarargI;Module["syscallGetVarargP"]=syscallGetVarargP;var PATH={isAbs:path=>path.charAt(0)==="/",splitPath:filename=>{var splitPathRe=/^(\\/?|)([\\s\\S]*?)((?:\\.{1,2}|[^\\/]+?|)(\\.[^.\\/]*|))(?:[\\/]*)$/;return splitPathRe.exec(filename).slice(1)},normalizeArray:(parts,allowAboveRoot)=>{var up=0;for(var i=parts.length-1;i>=0;i--){var last=parts[i];if(last==="."){parts.splice(i,1)}else if(last===".."){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot){for(;up;up--){parts.unshift("..")}}return parts},normalize:path=>{var isAbsolute=PATH.isAbs(path),trailingSlash=path.slice(-1)==="/";path=PATH.normalizeArray(path.split("/").filter(p=>!!p),!isAbsolute).join("/");if(!path&&!isAbsolute){path="."}if(path&&trailingSlash){path+="/"}return(isAbsolute?"/":"")+path},dirname:path=>{var result=PATH.splitPath(path),root=result[0],dir=result[1];if(!root&&!dir){return"."}if(dir){dir=dir.slice(0,-1)}return root+dir},basename:path=>path&&path.match(/([^\\/]+|\\/)\\/*$/)[1],join:(...paths)=>PATH.normalize(paths.join("/")),join2:(l,r)=>PATH.normalize(l+"/"+r)};Module["PATH"]=PATH;var initRandomFill=()=>{if(ENVIRONMENT_IS_NODE){var nodeCrypto=require("crypto");return view=>nodeCrypto.randomFillSync(view)}return view=>view.set(crypto.getRandomValues(new Uint8Array(view.byteLength)))};Module["initRandomFill"]=initRandomFill;var randomFill=view=>{(randomFill=initRandomFill())(view)};Module["randomFill"]=randomFill;var PATH_FS={resolve:(...args)=>{var resolvedPath="",resolvedAbsolute=false;for(var i=args.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?args[i]:FS.cwd();if(typeof path!="string"){throw new TypeError("Arguments to path.resolve must be strings")}else if(!path){return""}resolvedPath=path+"/"+resolvedPath;resolvedAbsolute=PATH.isAbs(path)}resolvedPath=PATH.normalizeArray(resolvedPath.split("/").filter(p=>!!p),!resolvedAbsolute).join("/");return(resolvedAbsolute?"/":"")+resolvedPath||"."},relative:(from,to)=>{from=PATH_FS.resolve(from).slice(1);to=PATH_FS.resolve(to).slice(1);function trim(arr){var start=0;for(;start<arr.length;start++){if(arr[start]!=="")break}var end=arr.length-1;for(;end>=0;end--){if(arr[end]!=="")break}if(start>end)return[];return arr.slice(start,end-start+1)}var fromParts=trim(from.split("/"));var toParts=trim(to.split("/"));var length=Math.min(fromParts.length,toParts.length);var samePartsLength=length;for(var i=0;i<length;i++){if(fromParts[i]!==toParts[i]){samePartsLength=i;break}}var outputParts=[];for(var i=samePartsLength;i<fromParts.length;i++){outputParts.push("..")}outputParts=outputParts.concat(toParts.slice(samePartsLength));return outputParts.join("/")}};Module["PATH_FS"]=PATH_FS;var UTF8Decoder=typeof TextDecoder!="undefined"?new TextDecoder:undefined;Module["UTF8Decoder"]=UTF8Decoder;var UTF8ArrayToString=(heapOrArray,idx=0,maxBytesToRead=NaN)=>{idx>>>=0;var endIdx=idx+maxBytesToRead;var endPtr=idx;while(heapOrArray[endPtr]&&!(endPtr>=endIdx))++endPtr;if(endPtr-idx>16&&heapOrArray.buffer&&UTF8Decoder){return UTF8Decoder.decode(heapOrArray.buffer instanceof ArrayBuffer?heapOrArray.subarray(idx,endPtr):heapOrArray.slice(idx,endPtr))}var str="";while(idx<endPtr){var u0=heapOrArray[idx++];if(!(u0&128)){str+=String.fromCharCode(u0);continue}var u1=heapOrArray[idx++]&63;if((u0&224)==192){str+=String.fromCharCode((u0&31)<<6|u1);continue}var u2=heapOrArray[idx++]&63;if((u0&240)==224){u0=(u0&15)<<12|u1<<6|u2}else{u0=(u0&7)<<18|u1<<12|u2<<6|heapOrArray[idx++]&63}if(u0<65536){str+=String.fromCharCode(u0)}else{var ch=u0-65536;str+=String.fromCharCode(55296|ch>>10,56320|ch&1023)}}return str};Module["UTF8ArrayToString"]=UTF8ArrayToString;var FS_stdin_getChar_buffer=[];Module["FS_stdin_getChar_buffer"]=FS_stdin_getChar_buffer;var lengthBytesUTF8=str=>{var len=0;for(var i=0;i<str.length;++i){var c=str.charCodeAt(i);if(c<=127){len++}else if(c<=2047){len+=2}else if(c>=55296&&c<=57343){len+=4;++i}else{len+=3}}return len};Module["lengthBytesUTF8"]=lengthBytesUTF8;var stringToUTF8Array=(str,heap,outIdx,maxBytesToWrite)=>{outIdx>>>=0;if(!(maxBytesToWrite>0))return 0;var startIdx=outIdx;var endIdx=outIdx+maxBytesToWrite-1;for(var i=0;i<str.length;++i){var u=str.charCodeAt(i);if(u>=55296&&u<=57343){var u1=str.charCodeAt(++i);u=65536+((u&1023)<<10)|u1&1023}if(u<=127){if(outIdx>=endIdx)break;heap[outIdx++>>>0]=u}else if(u<=2047){if(outIdx+1>=endIdx)break;heap[outIdx++>>>0]=192|u>>6;heap[outIdx++>>>0]=128|u&63}else if(u<=65535){if(outIdx+2>=endIdx)break;heap[outIdx++>>>0]=224|u>>12;heap[outIdx++>>>0]=128|u>>6&63;heap[outIdx++>>>0]=128|u&63}else{if(outIdx+3>=endIdx)break;heap[outIdx++>>>0]=240|u>>18;heap[outIdx++>>>0]=128|u>>12&63;heap[outIdx++>>>0]=128|u>>6&63;heap[outIdx++>>>0]=128|u&63}}heap[outIdx>>>0]=0;return outIdx-startIdx};Module["stringToUTF8Array"]=stringToUTF8Array;var intArrayFromString=(stringy,dontAddNull,length)=>{var len=length>0?length:lengthBytesUTF8(stringy)+1;var u8array=new Array(len);var numBytesWritten=stringToUTF8Array(stringy,u8array,0,u8array.length);if(dontAddNull)u8array.length=numBytesWritten;return u8array};Module["intArrayFromString"]=intArrayFromString;var FS_stdin_getChar=()=>{if(!FS_stdin_getChar_buffer.length){var result=null;if(ENVIRONMENT_IS_NODE){var BUFSIZE=256;var buf=Buffer.alloc(BUFSIZE);var bytesRead=0;var fd=process.stdin.fd;try{bytesRead=fs.readSync(fd,buf,0,BUFSIZE)}catch(e){if(e.toString().includes("EOF"))bytesRead=0;else throw e}if(bytesRead>0){result=buf.slice(0,bytesRead).toString("utf-8")}}else if(typeof window!="undefined"&&typeof window.prompt=="function"){result=window.prompt("Input: ");if(result!==null){result+="\\n"}}else{}if(!result){return null}FS_stdin_getChar_buffer=intArrayFromString(result,true)}return FS_stdin_getChar_buffer.shift()};Module["FS_stdin_getChar"]=FS_stdin_getChar;var TTY={ttys:[],init(){},shutdown(){},register(dev,ops){TTY.ttys[dev]={input:[],output:[],ops};FS.registerDevice(dev,TTY.stream_ops)},stream_ops:{open(stream){var tty=TTY.ttys[stream.node.rdev];if(!tty){throw new FS.ErrnoError(43)}stream.tty=tty;stream.seekable=false},close(stream){stream.tty.ops.fsync(stream.tty)},fsync(stream){stream.tty.ops.fsync(stream.tty)},read(stream,buffer,offset,length,pos){if(!stream.tty||!stream.tty.ops.get_char){throw new FS.ErrnoError(60)}var bytesRead=0;for(var i=0;i<length;i++){var result;try{result=stream.tty.ops.get_char(stream.tty)}catch(e){throw new FS.ErrnoError(29)}if(result===undefined&&bytesRead===0){throw new FS.ErrnoError(6)}if(result===null||result===undefined)break;bytesRead++;buffer[offset+i]=result}if(bytesRead){stream.node.atime=Date.now()}return bytesRead},write(stream,buffer,offset,length,pos){if(!stream.tty||!stream.tty.ops.put_char){throw new FS.ErrnoError(60)}try{for(var i=0;i<length;i++){stream.tty.ops.put_char(stream.tty,buffer[offset+i])}}catch(e){throw new FS.ErrnoError(29)}if(length){stream.node.mtime=stream.node.ctime=Date.now()}return i}},default_tty_ops:{get_char(tty){return FS_stdin_getChar()},put_char(tty,val){if(val===null||val===10){out(UTF8ArrayToString(tty.output));tty.output=[]}else{if(val!=0)tty.output.push(val)}},fsync(tty){if(tty.output?.length>0){out(UTF8ArrayToString(tty.output));tty.output=[]}},ioctl_tcgets(tty){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(tty,optional_actions,data){return 0},ioctl_tiocgwinsz(tty){return[24,80]}},default_tty1_ops:{put_char(tty,val){if(val===null||val===10){err(UTF8ArrayToString(tty.output));tty.output=[]}else{if(val!=0)tty.output.push(val)}},fsync(tty){if(tty.output?.length>0){err(UTF8ArrayToString(tty.output));tty.output=[]}}}};Module["TTY"]=TTY;var zeroMemory=(address,size)=>{GROWABLE_HEAP_U8().fill(0,address,address+size)};Module["zeroMemory"]=zeroMemory;var alignMemory=(size,alignment)=>Math.ceil(size/alignment)*alignment;Module["alignMemory"]=alignMemory;var mmapAlloc=size=>{size=alignMemory(size,65536);var ptr=_emscripten_builtin_memalign(65536,size);if(ptr)zeroMemory(ptr,size);return ptr};Module["mmapAlloc"]=mmapAlloc;var MEMFS={ops_table:null,mount(mount){return MEMFS.createNode(null,"/",16895,0)},createNode(parent,name,mode,dev){if(FS.isBlkdev(mode)||FS.isFIFO(mode)){throw new FS.ErrnoError(63)}MEMFS.ops_table||={dir:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr,lookup:MEMFS.node_ops.lookup,mknod:MEMFS.node_ops.mknod,rename:MEMFS.node_ops.rename,unlink:MEMFS.node_ops.unlink,rmdir:MEMFS.node_ops.rmdir,readdir:MEMFS.node_ops.readdir,symlink:MEMFS.node_ops.symlink},stream:{llseek:MEMFS.stream_ops.llseek}},file:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr},stream:{llseek:MEMFS.stream_ops.llseek,read:MEMFS.stream_ops.read,write:MEMFS.stream_ops.write,allocate:MEMFS.stream_ops.allocate,mmap:MEMFS.stream_ops.mmap,msync:MEMFS.stream_ops.msync}},link:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr,readlink:MEMFS.node_ops.readlink},stream:{}},chrdev:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr},stream:FS.chrdev_stream_ops}};var node=FS.createNode(parent,name,mode,dev);if(FS.isDir(node.mode)){node.node_ops=MEMFS.ops_table.dir.node;node.stream_ops=MEMFS.ops_table.dir.stream;node.contents={}}else if(FS.isFile(node.mode)){node.node_ops=MEMFS.ops_table.file.node;node.stream_ops=MEMFS.ops_table.file.stream;node.usedBytes=0;node.contents=null}else if(FS.isLink(node.mode)){node.node_ops=MEMFS.ops_table.link.node;node.stream_ops=MEMFS.ops_table.link.stream}else if(FS.isChrdev(node.mode)){node.node_ops=MEMFS.ops_table.chrdev.node;node.stream_ops=MEMFS.ops_table.chrdev.stream}node.atime=node.mtime=node.ctime=Date.now();if(parent){parent.contents[name]=node;parent.atime=parent.mtime=parent.ctime=node.atime}return node},getFileDataAsTypedArray(node){if(!node.contents)return new Uint8Array(0);if(node.contents.subarray)return node.contents.subarray(0,node.usedBytes);return new Uint8Array(node.contents)},expandFileStorage(node,newCapacity){var prevCapacity=node.contents?node.contents.length:0;if(prevCapacity>=newCapacity)return;var CAPACITY_DOUBLING_MAX=1024*1024;newCapacity=Math.max(newCapacity,prevCapacity*(prevCapacity<CAPACITY_DOUBLING_MAX?2:1.125)>>>0);if(prevCapacity!=0)newCapacity=Math.max(newCapacity,256);var oldContents=node.contents;node.contents=new Uint8Array(newCapacity);if(node.usedBytes>0)node.contents.set(oldContents.subarray(0,node.usedBytes),0)},resizeFileStorage(node,newSize){if(node.usedBytes==newSize)return;if(newSize==0){node.contents=null;node.usedBytes=0}else{var oldContents=node.contents;node.contents=new Uint8Array(newSize);if(oldContents){node.contents.set(oldContents.subarray(0,Math.min(newSize,node.usedBytes)))}node.usedBytes=newSize}},node_ops:{getattr(node){var attr={};attr.dev=FS.isChrdev(node.mode)?node.id:1;attr.ino=node.id;attr.mode=node.mode;attr.nlink=1;attr.uid=0;attr.gid=0;attr.rdev=node.rdev;if(FS.isDir(node.mode)){attr.size=4096}else if(FS.isFile(node.mode)){attr.size=node.usedBytes}else if(FS.isLink(node.mode)){attr.size=node.link.length}else{attr.size=0}attr.atime=new Date(node.atime);attr.mtime=new Date(node.mtime);attr.ctime=new Date(node.ctime);attr.blksize=4096;attr.blocks=Math.ceil(attr.size/attr.blksize);return attr},setattr(node,attr){for(const key of["mode","atime","mtime","ctime"]){if(attr[key]!=null){node[key]=attr[key]}}if(attr.size!==undefined){MEMFS.resizeFileStorage(node,attr.size)}},lookup(parent,name){throw MEMFS.doesNotExistError},mknod(parent,name,mode,dev){return MEMFS.createNode(parent,name,mode,dev)},rename(old_node,new_dir,new_name){var new_node;try{new_node=FS.lookupNode(new_dir,new_name)}catch(e){}if(new_node){if(FS.isDir(old_node.mode)){for(var i in new_node.contents){throw new FS.ErrnoError(55)}}FS.hashRemoveNode(new_node)}delete old_node.parent.contents[old_node.name];new_dir.contents[new_name]=old_node;old_node.name=new_name;new_dir.ctime=new_dir.mtime=old_node.parent.ctime=old_node.parent.mtime=Date.now()},unlink(parent,name){delete parent.contents[name];parent.ctime=parent.mtime=Date.now()},rmdir(parent,name){var node=FS.lookupNode(parent,name);for(var i in node.contents){throw new FS.ErrnoError(55)}delete parent.contents[name];parent.ctime=parent.mtime=Date.now()},readdir(node){return[".","..",...Object.keys(node.contents)]},symlink(parent,newname,oldpath){var node=MEMFS.createNode(parent,newname,511|40960,0);node.link=oldpath;return node},readlink(node){if(!FS.isLink(node.mode)){throw new FS.ErrnoError(28)}return node.link}},stream_ops:{read(stream,buffer,offset,length,position){var contents=stream.node.contents;if(position>=stream.node.usedBytes)return 0;var size=Math.min(stream.node.usedBytes-position,length);if(size>8&&contents.subarray){buffer.set(contents.subarray(position,position+size),offset)}else{for(var i=0;i<size;i++)buffer[offset+i]=contents[position+i]}return size},write(stream,buffer,offset,length,position,canOwn){if(buffer.buffer===GROWABLE_HEAP_I8().buffer){canOwn=false}if(!length)return 0;var node=stream.node;node.mtime=node.ctime=Date.now();if(buffer.subarray&&(!node.contents||node.contents.subarray)){if(canOwn){node.contents=buffer.subarray(offset,offset+length);node.usedBytes=length;return length}else if(node.usedBytes===0&&position===0){node.contents=buffer.slice(offset,offset+length);node.usedBytes=length;return length}else if(position+length<=node.usedBytes){node.contents.set(buffer.subarray(offset,offset+length),position);return length}}MEMFS.expandFileStorage(node,position+length);if(node.contents.subarray&&buffer.subarray){node.contents.set(buffer.subarray(offset,offset+length),position)}else{for(var i=0;i<length;i++){node.contents[position+i]=buffer[offset+i]}}node.usedBytes=Math.max(node.usedBytes,position+length);return length},llseek(stream,offset,whence){var position=offset;if(whence===1){position+=stream.position}else if(whence===2){if(FS.isFile(stream.node.mode)){position+=stream.node.usedBytes}}if(position<0){throw new FS.ErrnoError(28)}return position},allocate(stream,offset,length){MEMFS.expandFileStorage(stream.node,offset+length);stream.node.usedBytes=Math.max(stream.node.usedBytes,offset+length)},mmap(stream,length,position,prot,flags){if(!FS.isFile(stream.node.mode)){throw new FS.ErrnoError(43)}var ptr;var allocated;var contents=stream.node.contents;if(!(flags&2)&&contents&&contents.buffer===GROWABLE_HEAP_I8().buffer){allocated=false;ptr=contents.byteOffset}else{allocated=true;ptr=mmapAlloc(length);if(!ptr){throw new FS.ErrnoError(48)}if(contents){if(position>0||position+length<contents.length){if(contents.subarray){contents=contents.subarray(position,position+length)}else{contents=Array.prototype.slice.call(contents,position,position+length)}}GROWABLE_HEAP_I8().set(contents,ptr>>>0)}}return{ptr,allocated}},msync(stream,buffer,offset,length,mmapFlags){MEMFS.stream_ops.write(stream,buffer,0,length,offset,false);return 0}}};Module["MEMFS"]=MEMFS;var asyncLoad=async url=>{var arrayBuffer=await readAsync(url);return new Uint8Array(arrayBuffer)};Module["asyncLoad"]=asyncLoad;var FS_createDataFile=(parent,name,fileData,canRead,canWrite,canOwn)=>{FS.createDataFile(parent,name,fileData,canRead,canWrite,canOwn)};Module["FS_createDataFile"]=FS_createDataFile;var preloadPlugins=Module["preloadPlugins"]||[];Module["preloadPlugins"]=preloadPlugins;var FS_handledByPreloadPlugin=(byteArray,fullname,finish,onerror)=>{if(typeof Browser!="undefined")Browser.init();var handled=false;preloadPlugins.forEach(plugin=>{if(handled)return;if(plugin["canHandle"](fullname)){plugin["handle"](byteArray,fullname,finish,onerror);handled=true}});return handled};Module["FS_handledByPreloadPlugin"]=FS_handledByPreloadPlugin;var FS_createPreloadedFile=(parent,name,url,canRead,canWrite,onload,onerror,dontCreateFile,canOwn,preFinish)=>{var fullname=name?PATH_FS.resolve(PATH.join2(parent,name)):parent;var dep=getUniqueRunDependency(`cp ${fullname}`);function processData(byteArray){function finish(byteArray){preFinish?.();if(!dontCreateFile){FS_createDataFile(parent,name,byteArray,canRead,canWrite,canOwn)}onload?.();removeRunDependency(dep)}if(FS_handledByPreloadPlugin(byteArray,fullname,finish,()=>{onerror?.();removeRunDependency(dep)})){return}finish(byteArray)}addRunDependency(dep);if(typeof url=="string"){asyncLoad(url).then(processData,onerror)}else{processData(url)}};Module["FS_createPreloadedFile"]=FS_createPreloadedFile;var FS_modeStringToFlags=str=>{var flagModes={r:0,"r+":2,w:512|64|1,"w+":512|64|2,a:1024|64|1,"a+":1024|64|2};var flags=flagModes[str];if(typeof flags=="undefined"){throw new Error(`Unknown file open mode: ${str}`)}return flags};Module["FS_modeStringToFlags"]=FS_modeStringToFlags;var FS_getMode=(canRead,canWrite)=>{var mode=0;if(canRead)mode|=292|73;if(canWrite)mode|=146;return mode};Module["FS_getMode"]=FS_getMode;var FS={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:false,ignorePermissions:true,ErrnoError:class{name="ErrnoError";constructor(errno){this.errno=errno}},filesystems:null,syncFSRequests:0,readFiles:{},FSStream:class{shared={};get object(){return this.node}set object(val){this.node=val}get isRead(){return(this.flags&2097155)!==1}get isWrite(){return(this.flags&2097155)!==0}get isAppend(){return this.flags&1024}get flags(){return this.shared.flags}set flags(val){this.shared.flags=val}get position(){return this.shared.position}set position(val){this.shared.position=val}},FSNode:class{node_ops={};stream_ops={};readMode=292|73;writeMode=146;mounted=null;constructor(parent,name,mode,rdev){if(!parent){parent=this}this.parent=parent;this.mount=parent.mount;this.id=FS.nextInode++;this.name=name;this.mode=mode;this.rdev=rdev;this.atime=this.mtime=this.ctime=Date.now()}get read(){return(this.mode&this.readMode)===this.readMode}set read(val){val?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(val){val?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return FS.isDir(this.mode)}get isDevice(){return FS.isChrdev(this.mode)}},lookupPath(path,opts={}){if(!path){throw new FS.ErrnoError(44)}opts.follow_mount??=true;if(!PATH.isAbs(path)){path=FS.cwd()+"/"+path}linkloop:for(var nlinks=0;nlinks<40;nlinks++){var parts=path.split("/").filter(p=>!!p);var current=FS.root;var current_path="/";for(var i=0;i<parts.length;i++){var islast=i===parts.length-1;if(islast&&opts.parent){break}if(parts[i]==="."){continue}if(parts[i]===".."){current_path=PATH.dirname(current_path);current=current.parent;continue}current_path=PATH.join2(current_path,parts[i]);try{current=FS.lookupNode(current,parts[i])}catch(e){if(e?.errno===44&&islast&&opts.noent_okay){return{path:current_path}}throw e}if(FS.isMountpoint(current)&&(!islast||opts.follow_mount)){current=current.mounted.root}if(FS.isLink(current.mode)&&(!islast||opts.follow)){if(!current.node_ops.readlink){throw new FS.ErrnoError(52)}var link=current.node_ops.readlink(current);if(!PATH.isAbs(link)){link=PATH.dirname(current_path)+"/"+link}path=link+"/"+parts.slice(i+1).join("/");continue linkloop}}return{path:current_path,node:current}}throw new FS.ErrnoError(32)},getPath(node){var path;while(true){if(FS.isRoot(node)){var mount=node.mount.mountpoint;if(!path)return mount;return mount[mount.length-1]!=="/"?`${mount}/${path}`:mount+path}path=path?`${node.name}/${path}`:node.name;node=node.parent}},hashName(parentid,name){var hash=0;for(var i=0;i<name.length;i++){hash=(hash<<5)-hash+name.charCodeAt(i)|0}return(parentid+hash>>>0)%FS.nameTable.length},hashAddNode(node){var hash=FS.hashName(node.parent.id,node.name);node.name_next=FS.nameTable[hash];FS.nameTable[hash]=node},hashRemoveNode(node){var hash=FS.hashName(node.parent.id,node.name);if(FS.nameTable[hash]===node){FS.nameTable[hash]=node.name_next}else{var current=FS.nameTable[hash];while(current){if(current.name_next===node){current.name_next=node.name_next;break}current=current.name_next}}},lookupNode(parent,name){var errCode=FS.mayLookup(parent);if(errCode){throw new FS.ErrnoError(errCode)}var hash=FS.hashName(parent.id,name);for(var node=FS.nameTable[hash];node;node=node.name_next){var nodeName=node.name;if(node.parent.id===parent.id&&nodeName===name){return node}}return FS.lookup(parent,name)},createNode(parent,name,mode,rdev){var node=new FS.FSNode(parent,name,mode,rdev);FS.hashAddNode(node);return node},destroyNode(node){FS.hashRemoveNode(node)},isRoot(node){return node===node.parent},isMountpoint(node){return!!node.mounted},isFile(mode){return(mode&61440)===32768},isDir(mode){return(mode&61440)===16384},isLink(mode){return(mode&61440)===40960},isChrdev(mode){return(mode&61440)===8192},isBlkdev(mode){return(mode&61440)===24576},isFIFO(mode){return(mode&61440)===4096},isSocket(mode){return(mode&49152)===49152},flagsToPermissionString(flag){var perms=["r","w","rw"][flag&3];if(flag&512){perms+="w"}return perms},nodePermissions(node,perms){if(FS.ignorePermissions){return 0}if(perms.includes("r")&&!(node.mode&292)){return 2}else if(perms.includes("w")&&!(node.mode&146)){return 2}else if(perms.includes("x")&&!(node.mode&73)){return 2}return 0},mayLookup(dir){if(!FS.isDir(dir.mode))return 54;var errCode=FS.nodePermissions(dir,"x");if(errCode)return errCode;if(!dir.node_ops.lookup)return 2;return 0},mayCreate(dir,name){if(!FS.isDir(dir.mode)){return 54}try{var node=FS.lookupNode(dir,name);return 20}catch(e){}return FS.nodePermissions(dir,"wx")},mayDelete(dir,name,isdir){var node;try{node=FS.lookupNode(dir,name)}catch(e){return e.errno}var errCode=FS.nodePermissions(dir,"wx");if(errCode){return errCode}if(isdir){if(!FS.isDir(node.mode)){return 54}if(FS.isRoot(node)||FS.getPath(node)===FS.cwd()){return 10}}else{if(FS.isDir(node.mode)){return 31}}return 0},mayOpen(node,flags){if(!node){return 44}if(FS.isLink(node.mode)){return 32}else if(FS.isDir(node.mode)){if(FS.flagsToPermissionString(flags)!=="r"||flags&(512|64)){return 31}}return FS.nodePermissions(node,FS.flagsToPermissionString(flags))},checkOpExists(op,err){if(!op){throw new FS.ErrnoError(err)}return op},MAX_OPEN_FDS:4096,nextfd(){for(var fd=0;fd<=FS.MAX_OPEN_FDS;fd++){if(!FS.streams[fd]){return fd}}throw new FS.ErrnoError(33)},getStreamChecked(fd){var stream=FS.getStream(fd);if(!stream){throw new FS.ErrnoError(8)}return stream},getStream:fd=>FS.streams[fd],createStream(stream,fd=-1){stream=Object.assign(new FS.FSStream,stream);if(fd==-1){fd=FS.nextfd()}stream.fd=fd;FS.streams[fd]=stream;return stream},closeStream(fd){FS.streams[fd]=null},dupStream(origStream,fd=-1){var stream=FS.createStream(origStream,fd);stream.stream_ops?.dup?.(stream);return stream},doSetAttr(stream,node,attr){var setattr=stream?.stream_ops.setattr;var arg=setattr?stream:node;setattr??=node.node_ops.setattr;FS.checkOpExists(setattr,63);setattr(arg,attr)},chrdev_stream_ops:{open(stream){var device=FS.getDevice(stream.node.rdev);stream.stream_ops=device.stream_ops;stream.stream_ops.open?.(stream)},llseek(){throw new FS.ErrnoError(70)}},major:dev=>dev>>8,minor:dev=>dev&255,makedev:(ma,mi)=>ma<<8|mi,registerDevice(dev,ops){FS.devices[dev]={stream_ops:ops}},getDevice:dev=>FS.devices[dev],getMounts(mount){var mounts=[];var check=[mount];while(check.length){var m=check.pop();mounts.push(m);check.push(...m.mounts)}return mounts},syncfs(populate,callback){if(typeof populate=="function"){callback=populate;populate=false}FS.syncFSRequests++;if(FS.syncFSRequests>1){err(`warning: ${FS.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`)}var mounts=FS.getMounts(FS.root.mount);var completed=0;function doCallback(errCode){FS.syncFSRequests--;return callback(errCode)}function done(errCode){if(errCode){if(!done.errored){done.errored=true;return doCallback(errCode)}return}if(++completed>=mounts.length){doCallback(null)}}mounts.forEach(mount=>{if(!mount.type.syncfs){return done(null)}mount.type.syncfs(mount,populate,done)})},mount(type,opts,mountpoint){var root=mountpoint==="/";var pseudo=!mountpoint;var node;if(root&&FS.root){throw new FS.ErrnoError(10)}else if(!root&&!pseudo){var lookup=FS.lookupPath(mountpoint,{follow_mount:false});mountpoint=lookup.path;node=lookup.node;if(FS.isMountpoint(node)){throw new FS.ErrnoError(10)}if(!FS.isDir(node.mode)){throw new FS.ErrnoError(54)}}var mount={type,opts,mountpoint,mounts:[]};var mountRoot=type.mount(mount);mountRoot.mount=mount;mount.root=mountRoot;if(root){FS.root=mountRoot}else if(node){node.mounted=mount;if(node.mount){node.mount.mounts.push(mount)}}return mountRoot},unmount(mountpoint){var lookup=FS.lookupPath(mountpoint,{follow_mount:false});if(!FS.isMountpoint(lookup.node)){throw new FS.ErrnoError(28)}var node=lookup.node;var mount=node.mounted;var mounts=FS.getMounts(mount);Object.keys(FS.nameTable).forEach(hash=>{var current=FS.nameTable[hash];while(current){var next=current.name_next;if(mounts.includes(current.mount)){FS.destroyNode(current)}current=next}});node.mounted=null;var idx=node.mount.mounts.indexOf(mount);node.mount.mounts.splice(idx,1)},lookup(parent,name){return parent.node_ops.lookup(parent,name)},mknod(path,mode,dev){var lookup=FS.lookupPath(path,{parent:true});var parent=lookup.node;var name=PATH.basename(path);if(!name){throw new FS.ErrnoError(28)}if(name==="."||name===".."){throw new FS.ErrnoError(20)}var errCode=FS.mayCreate(parent,name);if(errCode){throw new FS.ErrnoError(errCode)}if(!parent.node_ops.mknod){throw new FS.ErrnoError(63)}return parent.node_ops.mknod(parent,name,mode,dev)},statfs(path){return FS.statfsNode(FS.lookupPath(path,{follow:true}).node)},statfsStream(stream){return FS.statfsNode(stream.node)},statfsNode(node){var rtn={bsize:4096,frsize:4096,blocks:1e6,bfree:5e5,bavail:5e5,files:FS.nextInode,ffree:FS.nextInode-1,fsid:42,flags:2,namelen:255};if(node.node_ops.statfs){Object.assign(rtn,node.node_ops.statfs(node.mount.opts.root))}return rtn},create(path,mode=438){mode&=4095;mode|=32768;return FS.mknod(path,mode,0)},mkdir(path,mode=511){mode&=511|512;mode|=16384;return FS.mknod(path,mode,0)},mkdirTree(path,mode){var dirs=path.split("/");var d="";for(var i=0;i<dirs.length;++i){if(!dirs[i])continue;d+="/"+dirs[i];try{FS.mkdir(d,mode)}catch(e){if(e.errno!=20)throw e}}},mkdev(path,mode,dev){if(typeof dev=="undefined"){dev=mode;mode=438}mode|=8192;return FS.mknod(path,mode,dev)},symlink(oldpath,newpath){if(!PATH_FS.resolve(oldpath)){throw new FS.ErrnoError(44)}var lookup=FS.lookupPath(newpath,{parent:true});var parent=lookup.node;if(!parent){throw new FS.ErrnoError(44)}var newname=PATH.basename(newpath);var errCode=FS.mayCreate(parent,newname);if(errCode){throw new FS.ErrnoError(errCode)}if(!parent.node_ops.symlink){throw new FS.ErrnoError(63)}return parent.node_ops.symlink(parent,newname,oldpath)},rename(old_path,new_path){var old_dirname=PATH.dirname(old_path);var new_dirname=PATH.dirname(new_path);var old_name=PATH.basename(old_path);var new_name=PATH.basename(new_path);var lookup,old_dir,new_dir;lookup=FS.lookupPath(old_path,{parent:true});old_dir=lookup.node;lookup=FS.lookupPath(new_path,{parent:true});new_dir=lookup.node;if(!old_dir||!new_dir)throw new FS.ErrnoError(44);if(old_dir.mount!==new_dir.mount){throw new FS.ErrnoError(75)}var old_node=FS.lookupNode(old_dir,old_name);var relative=PATH_FS.relative(old_path,new_dirname);if(relative.charAt(0)!=="."){throw new FS.ErrnoError(28)}relative=PATH_FS.relative(new_path,old_dirname);if(relative.charAt(0)!=="."){throw new FS.ErrnoError(55)}var new_node;try{new_node=FS.lookupNode(new_dir,new_name)}catch(e){}if(old_node===new_node){return}var isdir=FS.isDir(old_node.mode);var errCode=FS.mayDelete(old_dir,old_name,isdir);if(errCode){throw new FS.ErrnoError(errCode)}errCode=new_node?FS.mayDelete(new_dir,new_name,isdir):FS.mayCreate(new_dir,new_name);if(errCode){throw new FS.ErrnoError(errCode)}if(!old_dir.node_ops.rename){throw new FS.ErrnoError(63)}if(FS.isMountpoint(old_node)||new_node&&FS.isMountpoint(new_node)){throw new FS.ErrnoError(10)}if(new_dir!==old_dir){errCode=FS.nodePermissions(old_dir,"w");if(errCode){throw new FS.ErrnoError(errCode)}}FS.hashRemoveNode(old_node);try{old_dir.node_ops.rename(old_node,new_dir,new_name);old_node.parent=new_dir}catch(e){throw e}finally{FS.hashAddNode(old_node)}},rmdir(path){var lookup=FS.lookupPath(path,{parent:true});var parent=lookup.node;var name=PATH.basename(path);var node=FS.lookupNode(parent,name);var errCode=FS.mayDelete(parent,name,true);if(errCode){throw new FS.ErrnoError(errCode)}if(!parent.node_ops.rmdir){throw new FS.ErrnoError(63)}if(FS.isMountpoint(node)){throw new FS.ErrnoError(10)}parent.node_ops.rmdir(parent,name);FS.destroyNode(node)},readdir(path){var lookup=FS.lookupPath(path,{follow:true});var node=lookup.node;var readdir=FS.checkOpExists(node.node_ops.readdir,54);return readdir(node)},unlink(path){var lookup=FS.lookupPath(path,{parent:true});var parent=lookup.node;if(!parent){throw new FS.ErrnoError(44)}var name=PATH.basename(path);var node=FS.lookupNode(parent,name);var errCode=FS.mayDelete(parent,name,false);if(errCode){throw new FS.ErrnoError(errCode)}if(!parent.node_ops.unlink){throw new FS.ErrnoError(63)}if(FS.isMountpoint(node)){throw new FS.ErrnoError(10)}parent.node_ops.unlink(parent,name);FS.destroyNode(node)},readlink(path){var lookup=FS.lookupPath(path);var link=lookup.node;if(!link){throw new FS.ErrnoError(44)}if(!link.node_ops.readlink){throw new FS.ErrnoError(28)}return link.node_ops.readlink(link)},stat(path,dontFollow){var lookup=FS.lookupPath(path,{follow:!dontFollow});var node=lookup.node;var getattr=FS.checkOpExists(node.node_ops.getattr,63);return getattr(node)},fstat(fd){var stream=FS.getStreamChecked(fd);var node=stream.node;var getattr=stream.stream_ops.getattr;var arg=getattr?stream:node;getattr??=node.node_ops.getattr;FS.checkOpExists(getattr,63);return getattr(arg)},lstat(path){return FS.stat(path,true)},doChmod(stream,node,mode,dontFollow){FS.doSetAttr(stream,node,{mode:mode&4095|node.mode&~4095,ctime:Date.now(),dontFollow})},chmod(path,mode,dontFollow){var node;if(typeof path=="string"){var lookup=FS.lookupPath(path,{follow:!dontFollow});node=lookup.node}else{node=path}FS.doChmod(null,node,mode,dontFollow)},lchmod(path,mode){FS.chmod(path,mode,true)},fchmod(fd,mode){var stream=FS.getStreamChecked(fd);FS.doChmod(stream,stream.node,mode,false)},doChown(stream,node,dontFollow){FS.doSetAttr(stream,node,{timestamp:Date.now(),dontFollow})},chown(path,uid,gid,dontFollow){var node;if(typeof path=="string"){var lookup=FS.lookupPath(path,{follow:!dontFollow});node=lookup.node}else{node=path}FS.doChown(null,node,dontFollow)},lchown(path,uid,gid){FS.chown(path,uid,gid,true)},fchown(fd,uid,gid){var stream=FS.getStreamChecked(fd);FS.doChown(stream,stream.node,false)},doTruncate(stream,node,len){if(FS.isDir(node.mode)){throw new FS.ErrnoError(31)}if(!FS.isFile(node.mode)){throw new FS.ErrnoError(28)}var errCode=FS.nodePermissions(node,"w");if(errCode){throw new FS.ErrnoError(errCode)}FS.doSetAttr(stream,node,{size:len,timestamp:Date.now()})},truncate(path,len){if(len<0){throw new FS.ErrnoError(28)}var node;if(typeof path=="string"){var lookup=FS.lookupPath(path,{follow:true});node=lookup.node}else{node=path}FS.doTruncate(null,node,len)},ftruncate(fd,len){var stream=FS.getStreamChecked(fd);if(len<0||(stream.flags&2097155)===0){throw new FS.ErrnoError(28)}FS.doTruncate(stream,stream.node,len)},utime(path,atime,mtime){var lookup=FS.lookupPath(path,{follow:true});var node=lookup.node;var setattr=FS.checkOpExists(node.node_ops.setattr,63);setattr(node,{atime,mtime})},open(path,flags,mode=438){if(path===""){throw new FS.ErrnoError(44)}flags=typeof flags=="string"?FS_modeStringToFlags(flags):flags;if(flags&64){mode=mode&4095|32768}else{mode=0}var node;var isDirPath;if(typeof path=="object"){node=path}else{isDirPath=path.endsWith("/");var lookup=FS.lookupPath(path,{follow:!(flags&131072),noent_okay:true});node=lookup.node;path=lookup.path}var created=false;if(flags&64){if(node){if(flags&128){throw new FS.ErrnoError(20)}}else if(isDirPath){throw new FS.ErrnoError(31)}else{node=FS.mknod(path,mode|511,0);created=true}}if(!node){throw new FS.ErrnoError(44)}if(FS.isChrdev(node.mode)){flags&=~512}if(flags&65536&&!FS.isDir(node.mode)){throw new FS.ErrnoError(54)}if(!created){var errCode=FS.mayOpen(node,flags);if(errCode){throw new FS.ErrnoError(errCode)}}if(flags&512&&!created){FS.truncate(node,0)}flags&=~(128|512|131072);var stream=FS.createStream({node,path:FS.getPath(node),flags,seekable:true,position:0,stream_ops:node.stream_ops,ungotten:[],error:false});if(stream.stream_ops.open){stream.stream_ops.open(stream)}if(created){FS.chmod(node,mode&511)}if(Module["logReadFiles"]&&!(flags&1)){if(!(path in FS.readFiles)){FS.readFiles[path]=1}}return stream},close(stream){if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if(stream.getdents)stream.getdents=null;try{if(stream.stream_ops.close){stream.stream_ops.close(stream)}}catch(e){throw e}finally{FS.closeStream(stream.fd)}stream.fd=null},isClosed(stream){return stream.fd===null},llseek(stream,offset,whence){if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if(!stream.seekable||!stream.stream_ops.llseek){throw new FS.ErrnoError(70)}if(whence!=0&&whence!=1&&whence!=2){throw new FS.ErrnoError(28)}stream.position=stream.stream_ops.llseek(stream,offset,whence);stream.ungotten=[];return stream.position},read(stream,buffer,offset,length,position){if(length<0||position<0){throw new FS.ErrnoError(28)}if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if((stream.flags&2097155)===1){throw new FS.ErrnoError(8)}if(FS.isDir(stream.node.mode)){throw new FS.ErrnoError(31)}if(!stream.stream_ops.read){throw new FS.ErrnoError(28)}var seeking=typeof position!="undefined";if(!seeking){position=stream.position}else if(!stream.seekable){throw new FS.ErrnoError(70)}var bytesRead=stream.stream_ops.read(stream,buffer,offset,length,position);if(!seeking)stream.position+=bytesRead;return bytesRead},write(stream,buffer,offset,length,position,canOwn){if(length<0||position<0){throw new FS.ErrnoError(28)}if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if((stream.flags&2097155)===0){throw new FS.ErrnoError(8)}if(FS.isDir(stream.node.mode)){throw new FS.ErrnoError(31)}if(!stream.stream_ops.write){throw new FS.ErrnoError(28)}if(stream.seekable&&stream.flags&1024){FS.llseek(stream,0,2)}var seeking=typeof position!="undefined";if(!seeking){position=stream.position}else if(!stream.seekable){throw new FS.ErrnoError(70)}var bytesWritten=stream.stream_ops.write(stream,buffer,offset,length,position,canOwn);if(!seeking)stream.position+=bytesWritten;return bytesWritten},allocate(stream,offset,length){if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if(offset<0||length<=0){throw new FS.ErrnoError(28)}if((stream.flags&2097155)===0){throw new FS.ErrnoError(8)}if(!FS.isFile(stream.node.mode)&&!FS.isDir(stream.node.mode)){throw new FS.ErrnoError(43)}if(!stream.stream_ops.allocate){throw new FS.ErrnoError(138)}stream.stream_ops.allocate(stream,offset,length)},mmap(stream,length,position,prot,flags){if((prot&2)!==0&&(flags&2)===0&&(stream.flags&2097155)!==2){throw new FS.ErrnoError(2)}if((stream.flags&2097155)===1){throw new FS.ErrnoError(2)}if(!stream.stream_ops.mmap){throw new FS.ErrnoError(43)}if(!length){throw new FS.ErrnoError(28)}return stream.stream_ops.mmap(stream,length,position,prot,flags)},msync(stream,buffer,offset,length,mmapFlags){if(!stream.stream_ops.msync){return 0}return stream.stream_ops.msync(stream,buffer,offset,length,mmapFlags)},ioctl(stream,cmd,arg){if(!stream.stream_ops.ioctl){throw new FS.ErrnoError(59)}return stream.stream_ops.ioctl(stream,cmd,arg)},readFile(path,opts={}){opts.flags=opts.flags||0;opts.encoding=opts.encoding||"binary";if(opts.encoding!=="utf8"&&opts.encoding!=="binary"){throw new Error(`Invalid encoding type "${opts.encoding}"`)}var ret;var stream=FS.open(path,opts.flags);var stat=FS.stat(path);var length=stat.size;var buf=new Uint8Array(length);FS.read(stream,buf,0,length,0);if(opts.encoding==="utf8"){ret=UTF8ArrayToString(buf)}else if(opts.encoding==="binary"){ret=buf}FS.close(stream);return ret},writeFile(path,data,opts={}){opts.flags=opts.flags||577;var stream=FS.open(path,opts.flags,opts.mode);if(typeof data=="string"){var buf=new Uint8Array(lengthBytesUTF8(data)+1);var actualNumBytes=stringToUTF8Array(data,buf,0,buf.length);FS.write(stream,buf,0,actualNumBytes,undefined,opts.canOwn)}else if(ArrayBuffer.isView(data)){FS.write(stream,data,0,data.byteLength,undefined,opts.canOwn)}else{throw new Error("Unsupported data type")}FS.close(stream)},cwd:()=>FS.currentPath,chdir(path){var lookup=FS.lookupPath(path,{follow:true});if(lookup.node===null){throw new FS.ErrnoError(44)}if(!FS.isDir(lookup.node.mode)){throw new FS.ErrnoError(54)}var errCode=FS.nodePermissions(lookup.node,"x");if(errCode){throw new FS.ErrnoError(errCode)}FS.currentPath=lookup.path},createDefaultDirectories(){FS.mkdir("/tmp");FS.mkdir("/home");FS.mkdir("/home/web_user")},createDefaultDevices(){FS.mkdir("/dev");FS.registerDevice(FS.makedev(1,3),{read:()=>0,write:(stream,buffer,offset,length,pos)=>length,llseek:()=>0});FS.mkdev("/dev/null",FS.makedev(1,3));TTY.register(FS.makedev(5,0),TTY.default_tty_ops);TTY.register(FS.makedev(6,0),TTY.default_tty1_ops);FS.mkdev("/dev/tty",FS.makedev(5,0));FS.mkdev("/dev/tty1",FS.makedev(6,0));var randomBuffer=new Uint8Array(1024),randomLeft=0;var randomByte=()=>{if(randomLeft===0){randomFill(randomBuffer);randomLeft=randomBuffer.byteLength}return randomBuffer[--randomLeft]};FS.createDevice("/dev","random",randomByte);FS.createDevice("/dev","urandom",randomByte);FS.mkdir("/dev/shm");FS.mkdir("/dev/shm/tmp")},createSpecialDirectories(){FS.mkdir("/proc");var proc_self=FS.mkdir("/proc/self");FS.mkdir("/proc/self/fd");FS.mount({mount(){var node=FS.createNode(proc_self,"fd",16895,73);node.stream_ops={llseek:MEMFS.stream_ops.llseek};node.node_ops={lookup(parent,name){var fd=+name;var stream=FS.getStreamChecked(fd);var ret={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>stream.path},id:fd+1};ret.parent=ret;return ret},readdir(){return Array.from(FS.streams.entries()).filter(([k,v])=>v).map(([k,v])=>k.toString())}};return node}},{},"/proc/self/fd")},createStandardStreams(input,output,error){if(input){FS.createDevice("/dev","stdin",input)}else{FS.symlink("/dev/tty","/dev/stdin")}if(output){FS.createDevice("/dev","stdout",null,output)}else{FS.symlink("/dev/tty","/dev/stdout")}if(error){FS.createDevice("/dev","stderr",null,error)}else{FS.symlink("/dev/tty1","/dev/stderr")}var stdin=FS.open("/dev/stdin",0);var stdout=FS.open("/dev/stdout",1);var stderr=FS.open("/dev/stderr",1)},staticInit(){FS.nameTable=new Array(4096);FS.mount(MEMFS,{},"/");FS.createDefaultDirectories();FS.createDefaultDevices();FS.createSpecialDirectories();FS.filesystems={MEMFS}},init(input,output,error){FS.initialized=true;input??=Module["stdin"];output??=Module["stdout"];error??=Module["stderr"];FS.createStandardStreams(input,output,error)},quit(){FS.initialized=false;for(var i=0;i<FS.streams.length;i++){var stream=FS.streams[i];if(!stream){continue}FS.close(stream)}},findObject(path,dontResolveLastLink){var ret=FS.analyzePath(path,dontResolveLastLink);if(!ret.exists){return null}return ret.object},analyzePath(path,dontResolveLastLink){try{var lookup=FS.lookupPath(path,{follow:!dontResolveLastLink});path=lookup.path}catch(e){}var ret={isRoot:false,exists:false,error:0,name:null,path:null,object:null,parentExists:false,parentPath:null,parentObject:null};try{var lookup=FS.lookupPath(path,{parent:true});ret.parentExists=true;ret.parentPath=lookup.path;ret.parentObject=lookup.node;ret.name=PATH.basename(path);lookup=FS.lookupPath(path,{follow:!dontResolveLastLink});ret.exists=true;ret.path=lookup.path;ret.object=lookup.node;ret.name=lookup.node.name;ret.isRoot=lookup.path==="/"}catch(e){ret.error=e.errno}return ret},createPath(parent,path,canRead,canWrite){parent=typeof parent=="string"?parent:FS.getPath(parent);var parts=path.split("/").reverse();while(parts.length){var part=parts.pop();if(!part)continue;var current=PATH.join2(parent,part);try{FS.mkdir(current)}catch(e){}parent=current}return current},createFile(parent,name,properties,canRead,canWrite){var path=PATH.join2(typeof parent=="string"?parent:FS.getPath(parent),name);var mode=FS_getMode(canRead,canWrite);return FS.create(path,mode)},createDataFile(parent,name,data,canRead,canWrite,canOwn){var path=name;if(parent){parent=typeof parent=="string"?parent:FS.getPath(parent);path=name?PATH.join2(parent,name):parent}var mode=FS_getMode(canRead,canWrite);var node=FS.create(path,mode);if(data){if(typeof data=="string"){var arr=new Array(data.length);for(var i=0,len=data.length;i<len;++i)arr[i]=data.charCodeAt(i);data=arr}FS.chmod(node,mode|146);var stream=FS.open(node,577);FS.write(stream,data,0,data.length,0,canOwn);FS.close(stream);FS.chmod(node,mode)}},createDevice(parent,name,input,output){var path=PATH.join2(typeof parent=="string"?parent:FS.getPath(parent),name);var mode=FS_getMode(!!input,!!output);FS.createDevice.major??=64;var dev=FS.makedev(FS.createDevice.major++,0);FS.registerDevice(dev,{open(stream){stream.seekable=false},close(stream){if(output?.buffer?.length){output(10)}},read(stream,buffer,offset,length,pos){var bytesRead=0;for(var i=0;i<length;i++){var result;try{result=input()}catch(e){throw new FS.ErrnoError(29)}if(result===undefined&&bytesRead===0){throw new FS.ErrnoError(6)}if(result===null||result===undefined)break;bytesRead++;buffer[offset+i]=result}if(bytesRead){stream.node.atime=Date.now()}return bytesRead},write(stream,buffer,offset,length,pos){for(var i=0;i<length;i++){try{output(buffer[offset+i])}catch(e){throw new FS.ErrnoError(29)}}if(length){stream.node.mtime=stream.node.ctime=Date.now()}return i}});return FS.mkdev(path,mode,dev)},forceLoadFile(obj){if(obj.isDevice||obj.isFolder||obj.link||obj.contents)return true;if(typeof XMLHttpRequest!="undefined"){throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.")}else{try{obj.contents=readBinary(obj.url);obj.usedBytes=obj.contents.length}catch(e){throw new FS.ErrnoError(29)}}},createLazyFile(parent,name,url,canRead,canWrite){class LazyUint8Array{lengthKnown=false;chunks=[];get(idx){if(idx>this.length-1||idx<0){return undefined}var chunkOffset=idx%this.chunkSize;var chunkNum=idx/this.chunkSize|0;return this.getter(chunkNum)[chunkOffset]}setDataGetter(getter){this.getter=getter}cacheLength(){var xhr=new XMLHttpRequest;xhr.open("HEAD",url,false);xhr.send(null);if(!(xhr.status>=200&&xhr.status<300||xhr.status===304))throw new Error("Couldn\'t load "+url+". Status: "+xhr.status);var datalength=Number(xhr.getResponseHeader("Content-length"));var header;var hasByteServing=(header=xhr.getResponseHeader("Accept-Ranges"))&&header==="bytes";var usesGzip=(header=xhr.getResponseHeader("Content-Encoding"))&&header==="gzip";var chunkSize=1024*1024;if(!hasByteServing)chunkSize=datalength;var doXHR=(from,to)=>{if(from>to)throw new Error("invalid range ("+from+", "+to+") or no bytes requested!");if(to>datalength-1)throw new Error("only "+datalength+" bytes available! programmer error!");var xhr=new XMLHttpRequest;xhr.open("GET",url,false);if(datalength!==chunkSize)xhr.setRequestHeader("Range","bytes="+from+"-"+to);xhr.responseType="arraybuffer";if(xhr.overrideMimeType){xhr.overrideMimeType("text/plain; charset=x-user-defined")}xhr.send(null);if(!(xhr.status>=200&&xhr.status<300||xhr.status===304))throw new Error("Couldn\'t load "+url+". Status: "+xhr.status);if(xhr.response!==undefined){return new Uint8Array(xhr.response||[])}return intArrayFromString(xhr.responseText||"",true)};var lazyArray=this;lazyArray.setDataGetter(chunkNum=>{var start=chunkNum*chunkSize;var end=(chunkNum+1)*chunkSize-1;end=Math.min(end,datalength-1);if(typeof lazyArray.chunks[chunkNum]=="undefined"){lazyArray.chunks[chunkNum]=doXHR(start,end)}if(typeof lazyArray.chunks[chunkNum]=="undefined")throw new Error("doXHR failed!");return lazyArray.chunks[chunkNum]});if(usesGzip||!datalength){chunkSize=datalength=1;datalength=this.getter(0).length;chunkSize=datalength;out("LazyFiles on gzip forces download of the whole file when length is accessed")}this._length=datalength;this._chunkSize=chunkSize;this.lengthKnown=true}get length(){if(!this.lengthKnown){this.cacheLength()}return this._length}get chunkSize(){if(!this.lengthKnown){this.cacheLength()}return this._chunkSize}}if(typeof XMLHttpRequest!="undefined"){if(!ENVIRONMENT_IS_WORKER)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var lazyArray=new LazyUint8Array;var properties={isDevice:false,contents:lazyArray}}else{var properties={isDevice:false,url}}var node=FS.createFile(parent,name,properties,canRead,canWrite);if(properties.contents){node.contents=properties.contents}else if(properties.url){node.contents=null;node.url=properties.url}Object.defineProperties(node,{usedBytes:{get:function(){return this.contents.length}}});var stream_ops={};var keys=Object.keys(node.stream_ops);keys.forEach(key=>{var fn=node.stream_ops[key];stream_ops[key]=(...args)=>{FS.forceLoadFile(node);return fn(...args)}});function writeChunks(stream,buffer,offset,length,position){var contents=stream.node.contents;if(position>=contents.length)return 0;var size=Math.min(contents.length-position,length);if(contents.slice){for(var i=0;i<size;i++){buffer[offset+i]=contents[position+i]}}else{for(var i=0;i<size;i++){buffer[offset+i]=contents.get(position+i)}}return size}stream_ops.read=(stream,buffer,offset,length,position)=>{FS.forceLoadFile(node);return writeChunks(stream,buffer,offset,length,position)};stream_ops.mmap=(stream,length,position,prot,flags)=>{FS.forceLoadFile(node);var ptr=mmapAlloc(length);if(!ptr){throw new FS.ErrnoError(48)}writeChunks(stream,GROWABLE_HEAP_I8(),ptr,length,position);return{ptr,allocated:true}};node.stream_ops=stream_ops;return node}};Module["FS"]=FS;var UTF8ToString=(ptr,maxBytesToRead)=>{ptr>>>=0;return ptr?UTF8ArrayToString(GROWABLE_HEAP_U8(),ptr,maxBytesToRead):""};Module["UTF8ToString"]=UTF8ToString;var SYSCALLS={DEFAULT_POLLMASK:5,calculateAt(dirfd,path,allowEmpty){if(PATH.isAbs(path)){return path}var dir;if(dirfd===-100){dir=FS.cwd()}else{var dirstream=SYSCALLS.getStreamFromFD(dirfd);dir=dirstream.path}if(path.length==0){if(!allowEmpty){throw new FS.ErrnoError(44)}return dir}return dir+"/"+path},writeStat(buf,stat){GROWABLE_HEAP_I32()[buf>>>2>>>0]=stat.dev;GROWABLE_HEAP_I32()[buf+4>>>2>>>0]=stat.mode;GROWABLE_HEAP_U32()[buf+8>>>2>>>0]=stat.nlink;GROWABLE_HEAP_I32()[buf+12>>>2>>>0]=stat.uid;GROWABLE_HEAP_I32()[buf+16>>>2>>>0]=stat.gid;GROWABLE_HEAP_I32()[buf+20>>>2>>>0]=stat.rdev;HEAP64[buf+24>>>3]=BigInt(stat.size);GROWABLE_HEAP_I32()[buf+32>>>2>>>0]=4096;GROWABLE_HEAP_I32()[buf+36>>>2>>>0]=stat.blocks;var atime=stat.atime.getTime();var mtime=stat.mtime.getTime();var ctime=stat.ctime.getTime();HEAP64[buf+40>>>3]=BigInt(Math.floor(atime/1e3));GROWABLE_HEAP_U32()[buf+48>>>2>>>0]=atime%1e3*1e3*1e3;HEAP64[buf+56>>>3]=BigInt(Math.floor(mtime/1e3));GROWABLE_HEAP_U32()[buf+64>>>2>>>0]=mtime%1e3*1e3*1e3;HEAP64[buf+72>>>3]=BigInt(Math.floor(ctime/1e3));GROWABLE_HEAP_U32()[buf+80>>>2>>>0]=ctime%1e3*1e3*1e3;HEAP64[buf+88>>>3]=BigInt(stat.ino);return 0},writeStatFs(buf,stats){GROWABLE_HEAP_I32()[buf+4>>>2>>>0]=stats.bsize;GROWABLE_HEAP_I32()[buf+40>>>2>>>0]=stats.bsize;GROWABLE_HEAP_I32()[buf+8>>>2>>>0]=stats.blocks;GROWABLE_HEAP_I32()[buf+12>>>2>>>0]=stats.bfree;GROWABLE_HEAP_I32()[buf+16>>>2>>>0]=stats.bavail;GROWABLE_HEAP_I32()[buf+20>>>2>>>0]=stats.files;GROWABLE_HEAP_I32()[buf+24>>>2>>>0]=stats.ffree;GROWABLE_HEAP_I32()[buf+28>>>2>>>0]=stats.fsid;GROWABLE_HEAP_I32()[buf+44>>>2>>>0]=stats.flags;GROWABLE_HEAP_I32()[buf+36>>>2>>>0]=stats.namelen},doMsync(addr,stream,len,flags,offset){if(!FS.isFile(stream.node.mode)){throw new FS.ErrnoError(43)}if(flags&2){return 0}var buffer=GROWABLE_HEAP_U8().slice(addr,addr+len);FS.msync(stream,buffer,offset,len,flags)},getStreamFromFD(fd){var stream=FS.getStreamChecked(fd);return stream},varargs:undefined,getStr(ptr){var ret=UTF8ToString(ptr);return ret}};Module["SYSCALLS"]=SYSCALLS;function ___syscall_fcntl64(fd,cmd,varargs){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(3,0,1,fd,cmd,varargs);varargs>>>=0;SYSCALLS.varargs=varargs;try{var stream=SYSCALLS.getStreamFromFD(fd);switch(cmd){case 0:{var arg=syscallGetVarargI();if(arg<0){return-28}while(FS.streams[arg]){arg++}var newStream;newStream=FS.dupStream(stream,arg);return newStream.fd}case 1:case 2:return 0;case 3:return stream.flags;case 4:{var arg=syscallGetVarargI();stream.flags|=arg;return 0}case 12:{var arg=syscallGetVarargP();var offset=0;GROWABLE_HEAP_I16()[arg+offset>>>1>>>0]=2;return 0}case 13:case 14:return 0}return-28}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["___syscall_fcntl64"]=___syscall_fcntl64;function ___syscall_ioctl(fd,op,varargs){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(4,0,1,fd,op,varargs);varargs>>>=0;SYSCALLS.varargs=varargs;try{var stream=SYSCALLS.getStreamFromFD(fd);switch(op){case 21509:{if(!stream.tty)return-59;return 0}case 21505:{if(!stream.tty)return-59;if(stream.tty.ops.ioctl_tcgets){var termios=stream.tty.ops.ioctl_tcgets(stream);var argp=syscallGetVarargP();GROWABLE_HEAP_I32()[argp>>>2>>>0]=termios.c_iflag||0;GROWABLE_HEAP_I32()[argp+4>>>2>>>0]=termios.c_oflag||0;GROWABLE_HEAP_I32()[argp+8>>>2>>>0]=termios.c_cflag||0;GROWABLE_HEAP_I32()[argp+12>>>2>>>0]=termios.c_lflag||0;for(var i=0;i<32;i++){GROWABLE_HEAP_I8()[argp+i+17>>>0]=termios.c_cc[i]||0}return 0}return 0}case 21510:case 21511:case 21512:{if(!stream.tty)return-59;return 0}case 21506:case 21507:case 21508:{if(!stream.tty)return-59;if(stream.tty.ops.ioctl_tcsets){var argp=syscallGetVarargP();var c_iflag=GROWABLE_HEAP_I32()[argp>>>2>>>0];var c_oflag=GROWABLE_HEAP_I32()[argp+4>>>2>>>0];var c_cflag=GROWABLE_HEAP_I32()[argp+8>>>2>>>0];var c_lflag=GROWABLE_HEAP_I32()[argp+12>>>2>>>0];var c_cc=[];for(var i=0;i<32;i++){c_cc.push(GROWABLE_HEAP_I8()[argp+i+17>>>0])}return stream.tty.ops.ioctl_tcsets(stream.tty,op,{c_iflag,c_oflag,c_cflag,c_lflag,c_cc})}return 0}case 21519:{if(!stream.tty)return-59;var argp=syscallGetVarargP();GROWABLE_HEAP_I32()[argp>>>2>>>0]=0;return 0}case 21520:{if(!stream.tty)return-59;return-28}case 21531:{var argp=syscallGetVarargP();return FS.ioctl(stream,op,argp)}case 21523:{if(!stream.tty)return-59;if(stream.tty.ops.ioctl_tiocgwinsz){var winsize=stream.tty.ops.ioctl_tiocgwinsz(stream.tty);var argp=syscallGetVarargP();GROWABLE_HEAP_I16()[argp>>>1>>>0]=winsize[0];GROWABLE_HEAP_I16()[argp+2>>>1>>>0]=winsize[1]}return 0}case 21524:{if(!stream.tty)return-59;return 0}case 21515:{if(!stream.tty)return-59;return 0}default:return-28}}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["___syscall_ioctl"]=___syscall_ioctl;function ___syscall_openat(dirfd,path,flags,varargs){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(5,0,1,dirfd,path,flags,varargs);path>>>=0;varargs>>>=0;SYSCALLS.varargs=varargs;try{path=SYSCALLS.getStr(path);path=SYSCALLS.calculateAt(dirfd,path);var mode=varargs?syscallGetVarargI():0;return FS.open(path,flags,mode).fd}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["___syscall_openat"]=___syscall_openat;var __abort_js=()=>abort("");Module["__abort_js"]=__abort_js;function __emscripten_init_main_thread_js(tb){tb>>>=0;__emscripten_thread_init(tb,!ENVIRONMENT_IS_WORKER,1,!ENVIRONMENT_IS_WEB,65536,false);PThread.threadInitTLS()}Module["__emscripten_init_main_thread_js"]=__emscripten_init_main_thread_js;var maybeExit=()=>{if(!keepRuntimeAlive()){try{if(ENVIRONMENT_IS_PTHREAD)__emscripten_thread_exit(EXITSTATUS);else _exit(EXITSTATUS)}catch(e){handleException(e)}}};Module["maybeExit"]=maybeExit;var callUserCallback=func=>{if(ABORT){return}try{func();maybeExit()}catch(e){handleException(e)}};Module["callUserCallback"]=callUserCallback;function __emscripten_thread_mailbox_await(pthread_ptr){pthread_ptr>>>=0;if(typeof Atomics.waitAsync==="function"){var wait=Atomics.waitAsync(GROWABLE_HEAP_I32(),pthread_ptr>>>2,pthread_ptr);wait.value.then(checkMailbox);var waitingAsync=pthread_ptr+128;Atomics.store(GROWABLE_HEAP_I32(),waitingAsync>>>2,1)}}Module["__emscripten_thread_mailbox_await"]=__emscripten_thread_mailbox_await;var checkMailbox=()=>{var pthread_ptr=_pthread_self();if(pthread_ptr){__emscripten_thread_mailbox_await(pthread_ptr);callUserCallback(__emscripten_check_mailbox)}};Module["checkMailbox"]=checkMailbox;function __emscripten_notify_mailbox_postmessage(targetThread,currThreadId){targetThread>>>=0;currThreadId>>>=0;if(targetThread==currThreadId){setTimeout(checkMailbox)}else if(ENVIRONMENT_IS_PTHREAD){postMessage({targetThread,cmd:"checkMailbox"})}else{var worker=PThread.pthreads[targetThread];if(!worker){return}worker.postMessage({cmd:"checkMailbox"})}}Module["__emscripten_notify_mailbox_postmessage"]=__emscripten_notify_mailbox_postmessage;var proxiedJSCallArgs=[];Module["proxiedJSCallArgs"]=proxiedJSCallArgs;function __emscripten_receive_on_main_thread_js(funcIndex,emAsmAddr,callingThread,numCallArgs,args){emAsmAddr>>>=0;callingThread>>>=0;args>>>=0;numCallArgs/=2;proxiedJSCallArgs.length=numCallArgs;var b=args>>>3;for(var i=0;i<numCallArgs;i++){if(HEAP64[b+2*i]){proxiedJSCallArgs[i]=HEAP64[b+2*i+1]}else{proxiedJSCallArgs[i]=GROWABLE_HEAP_F64()[b+2*i+1>>>0]}}var func=proxiedFunctionTable[funcIndex];PThread.currentProxiedOperationCallerThread=callingThread;var rtn=func(...proxiedJSCallArgs);PThread.currentProxiedOperationCallerThread=0;return rtn}Module["__emscripten_receive_on_main_thread_js"]=__emscripten_receive_on_main_thread_js;var __emscripten_runtime_keepalive_clear=()=>{noExitRuntime=false;runtimeKeepaliveCounter=0};Module["__emscripten_runtime_keepalive_clear"]=__emscripten_runtime_keepalive_clear;function __emscripten_thread_cleanup(thread){thread>>>=0;if(!ENVIRONMENT_IS_PTHREAD)cleanupThread(thread);else postMessage({cmd:"cleanupThread",thread})}Module["__emscripten_thread_cleanup"]=__emscripten_thread_cleanup;function __emscripten_thread_set_strongref(thread){thread>>>=0;if(ENVIRONMENT_IS_NODE){PThread.pthreads[thread].ref()}}Module["__emscripten_thread_set_strongref"]=__emscripten_thread_set_strongref;function __mmap_js(len,prot,flags,fd,offset,allocated,addr){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(6,0,1,len,prot,flags,fd,offset,allocated,addr);len>>>=0;offset=bigintToI53Checked(offset);allocated>>>=0;addr>>>=0;try{if(isNaN(offset))return 61;var stream=SYSCALLS.getStreamFromFD(fd);var res=FS.mmap(stream,len,offset,prot,flags);var ptr=res.ptr;GROWABLE_HEAP_I32()[allocated>>>2>>>0]=res.allocated;GROWABLE_HEAP_U32()[addr>>>2>>>0]=ptr;return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["__mmap_js"]=__mmap_js;function __munmap_js(addr,len,prot,flags,fd,offset){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(7,0,1,addr,len,prot,flags,fd,offset);addr>>>=0;len>>>=0;offset=bigintToI53Checked(offset);try{var stream=SYSCALLS.getStreamFromFD(fd);if(prot&2){SYSCALLS.doMsync(addr,stream,len,flags,offset)}}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["__munmap_js"]=__munmap_js;var timers={};Module["timers"]=timers;var _emscripten_get_now=()=>performance.timeOrigin+performance.now();Module["_emscripten_get_now"]=_emscripten_get_now;function __setitimer_js(which,timeout_ms){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(8,0,1,which,timeout_ms);if(timers[which]){clearTimeout(timers[which].id);delete timers[which]}if(!timeout_ms)return 0;var id=setTimeout(()=>{delete timers[which];callUserCallback(()=>__emscripten_timeout(which,_emscripten_get_now()))},timeout_ms);timers[which]={id,timeout_ms};return 0}Module["__setitimer_js"]=__setitimer_js;var stringToUTF8=(str,outPtr,maxBytesToWrite)=>stringToUTF8Array(str,GROWABLE_HEAP_U8(),outPtr,maxBytesToWrite);Module["stringToUTF8"]=stringToUTF8;var __tzset_js=function(timezone,daylight,std_name,dst_name){timezone>>>=0;daylight>>>=0;std_name>>>=0;dst_name>>>=0;var currentYear=(new Date).getFullYear();var winter=new Date(currentYear,0,1);var summer=new Date(currentYear,6,1);var winterOffset=winter.getTimezoneOffset();var summerOffset=summer.getTimezoneOffset();var stdTimezoneOffset=Math.max(winterOffset,summerOffset);GROWABLE_HEAP_U32()[timezone>>>2>>>0]=stdTimezoneOffset*60;GROWABLE_HEAP_I32()[daylight>>>2>>>0]=Number(winterOffset!=summerOffset);var extractZone=timezoneOffset=>{var sign=timezoneOffset>=0?"-":"+";var absOffset=Math.abs(timezoneOffset);var hours=String(Math.floor(absOffset/60)).padStart(2,"0");var minutes=String(absOffset%60).padStart(2,"0");return`UTC${sign}${hours}${minutes}`};var winterName=extractZone(winterOffset);var summerName=extractZone(summerOffset);if(summerOffset<winterOffset){stringToUTF8(winterName,std_name,17);stringToUTF8(summerName,dst_name,17)}else{stringToUTF8(winterName,dst_name,17);stringToUTF8(summerName,std_name,17)}};Module["__tzset_js"]=__tzset_js;var _emscripten_date_now=()=>Date.now();Module["_emscripten_date_now"]=_emscripten_date_now;var nowIsMonotonic=1;Module["nowIsMonotonic"]=nowIsMonotonic;var checkWasiClock=clock_id=>clock_id>=0&&clock_id<=3;Module["checkWasiClock"]=checkWasiClock;function _clock_time_get(clk_id,ignored_precision,ptime){ignored_precision=bigintToI53Checked(ignored_precision);ptime>>>=0;if(!checkWasiClock(clk_id)){return 28}var now;if(clk_id===0){now=_emscripten_date_now()}else if(nowIsMonotonic){now=_emscripten_get_now()}else{return 52}var nsec=Math.round(now*1e3*1e3);HEAP64[ptime>>>3]=BigInt(nsec);return 0}Module["_clock_time_get"]=_clock_time_get;var warnOnce=text=>{warnOnce.shown||={};if(!warnOnce.shown[text]){warnOnce.shown[text]=1;if(ENVIRONMENT_IS_NODE)text="warning: "+text;err(text)}};Module["warnOnce"]=warnOnce;var _emscripten_check_blocking_allowed=()=>{};Module["_emscripten_check_blocking_allowed"]=_emscripten_check_blocking_allowed;var runtimeKeepalivePush=()=>{runtimeKeepaliveCounter+=1};Module["runtimeKeepalivePush"]=runtimeKeepalivePush;var _emscripten_exit_with_live_runtime=()=>{runtimeKeepalivePush();throw"unwind"};Module["_emscripten_exit_with_live_runtime"]=_emscripten_exit_with_live_runtime;var getHeapMax=()=>4294901760;Module["getHeapMax"]=getHeapMax;function _emscripten_get_heap_max(){return getHeapMax()}Module["_emscripten_get_heap_max"]=_emscripten_get_heap_max;var _emscripten_num_logical_cores=()=>ENVIRONMENT_IS_NODE?require("os").cpus().length:navigator["hardwareConcurrency"];Module["_emscripten_num_logical_cores"]=_emscripten_num_logical_cores;var growMemory=size=>{var b=wasmMemory.buffer;var pages=(size-b.byteLength+65535)/65536|0;try{wasmMemory.grow(pages);updateMemoryViews();return 1}catch(e){}};Module["growMemory"]=growMemory;function _emscripten_resize_heap(requestedSize){requestedSize>>>=0;var oldSize=GROWABLE_HEAP_U8().length;if(requestedSize<=oldSize){return false}var maxHeapSize=getHeapMax();if(requestedSize>maxHeapSize){return false}for(var cutDown=1;cutDown<=4;cutDown*=2){var overGrownHeapSize=oldSize*(1+.2/cutDown);overGrownHeapSize=Math.min(overGrownHeapSize,requestedSize+100663296);var newSize=Math.min(maxHeapSize,alignMemory(Math.max(requestedSize,overGrownHeapSize),65536));var replacement=growMemory(newSize);if(replacement){return true}}return false}Module["_emscripten_resize_heap"]=_emscripten_resize_heap;var ENV={};Module["ENV"]=ENV;var getExecutableName=()=>thisProgram||"./this.program";Module["getExecutableName"]=getExecutableName;var getEnvStrings=()=>{if(!getEnvStrings.strings){var lang=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8";var env={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:lang,_:getExecutableName()};for(var x in ENV){if(ENV[x]===undefined)delete env[x];else env[x]=ENV[x]}var strings=[];for(var x in env){strings.push(`${x}=${env[x]}`)}getEnvStrings.strings=strings}return getEnvStrings.strings};Module["getEnvStrings"]=getEnvStrings;var stringToAscii=(str,buffer)=>{for(var i=0;i<str.length;++i){GROWABLE_HEAP_I8()[buffer++>>>0]=str.charCodeAt(i)}GROWABLE_HEAP_I8()[buffer>>>0]=0};Module["stringToAscii"]=stringToAscii;var _environ_get=function(__environ,environ_buf){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(9,0,1,__environ,environ_buf);__environ>>>=0;environ_buf>>>=0;var bufSize=0;getEnvStrings().forEach((string,i)=>{var ptr=environ_buf+bufSize;GROWABLE_HEAP_U32()[__environ+i*4>>>2>>>0]=ptr;stringToAscii(string,ptr);bufSize+=string.length+1});return 0};Module["_environ_get"]=_environ_get;var _environ_sizes_get=function(penviron_count,penviron_buf_size){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(10,0,1,penviron_count,penviron_buf_size);penviron_count>>>=0;penviron_buf_size>>>=0;var strings=getEnvStrings();GROWABLE_HEAP_U32()[penviron_count>>>2>>>0]=strings.length;var bufSize=0;strings.forEach(string=>bufSize+=string.length+1);GROWABLE_HEAP_U32()[penviron_buf_size>>>2>>>0]=bufSize;return 0};Module["_environ_sizes_get"]=_environ_sizes_get;function _fd_close(fd){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(11,0,1,fd);try{var stream=SYSCALLS.getStreamFromFD(fd);FS.close(stream);return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_fd_close"]=_fd_close;var doReadv=(stream,iov,iovcnt,offset)=>{var ret=0;for(var i=0;i<iovcnt;i++){var ptr=GROWABLE_HEAP_U32()[iov>>>2>>>0];var len=GROWABLE_HEAP_U32()[iov+4>>>2>>>0];iov+=8;var curr=FS.read(stream,GROWABLE_HEAP_I8(),ptr,len,offset);if(curr<0)return-1;ret+=curr;if(curr<len)break;if(typeof offset!="undefined"){offset+=curr}}return ret};Module["doReadv"]=doReadv;function _fd_read(fd,iov,iovcnt,pnum){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(12,0,1,fd,iov,iovcnt,pnum);iov>>>=0;iovcnt>>>=0;pnum>>>=0;try{var stream=SYSCALLS.getStreamFromFD(fd);var num=doReadv(stream,iov,iovcnt);GROWABLE_HEAP_U32()[pnum>>>2>>>0]=num;return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_fd_read"]=_fd_read;function _fd_seek(fd,offset,whence,newOffset){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(13,0,1,fd,offset,whence,newOffset);offset=bigintToI53Checked(offset);newOffset>>>=0;try{if(isNaN(offset))return 61;var stream=SYSCALLS.getStreamFromFD(fd);FS.llseek(stream,offset,whence);HEAP64[newOffset>>>3]=BigInt(stream.position);if(stream.getdents&&offset===0&&whence===0)stream.getdents=null;return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_fd_seek"]=_fd_seek;var doWritev=(stream,iov,iovcnt,offset)=>{var ret=0;for(var i=0;i<iovcnt;i++){var ptr=GROWABLE_HEAP_U32()[iov>>>2>>>0];var len=GROWABLE_HEAP_U32()[iov+4>>>2>>>0];iov+=8;var curr=FS.write(stream,GROWABLE_HEAP_I8(),ptr,len,offset);if(curr<0)return-1;ret+=curr;if(curr<len){break}if(typeof offset!="undefined"){offset+=curr}}return ret};Module["doWritev"]=doWritev;function _fd_write(fd,iov,iovcnt,pnum){if(ENVIRONMENT_IS_PTHREAD)return proxyToMainThread(14,0,1,fd,iov,iovcnt,pnum);iov>>>=0;iovcnt>>>=0;pnum>>>=0;try{var stream=SYSCALLS.getStreamFromFD(fd);var num=doWritev(stream,iov,iovcnt);GROWABLE_HEAP_U32()[pnum>>>2>>>0]=num;return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_fd_write"]=_fd_write;function _random_get(buffer,size){buffer>>>=0;size>>>=0;try{randomFill(GROWABLE_HEAP_U8().subarray(buffer>>>0,buffer+size>>>0));return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_random_get"]=_random_get;var getCFunc=ident=>{var func=Module["_"+ident];return func};Module["getCFunc"]=getCFunc;var writeArrayToMemory=(array,buffer)=>{GROWABLE_HEAP_I8().set(array,buffer>>>0)};Module["writeArrayToMemory"]=writeArrayToMemory;var stringToUTF8OnStack=str=>{var size=lengthBytesUTF8(str)+1;var ret=stackAlloc(size);stringToUTF8(str,ret,size);return ret};Module["stringToUTF8OnStack"]=stringToUTF8OnStack;var ccall=(ident,returnType,argTypes,args,opts)=>{var toC={string:str=>{var ret=0;if(str!==null&&str!==undefined&&str!==0){ret=stringToUTF8OnStack(str)}return ret},array:arr=>{var ret=stackAlloc(arr.length);writeArrayToMemory(arr,ret);return ret}};function convertReturnValue(ret){if(returnType==="string"){return UTF8ToString(ret)}if(returnType==="boolean")return Boolean(ret);return ret}var func=getCFunc(ident);var cArgs=[];var stack=0;if(args){for(var i=0;i<args.length;i++){var converter=toC[argTypes[i]];if(converter){if(stack===0)stack=stackSave();cArgs[i]=converter(args[i])}else{cArgs[i]=args[i]}}}var ret=func(...cArgs);function onDone(ret){if(stack!==0)stackRestore(stack);return convertReturnValue(ret)}ret=onDone(ret);return ret};Module["ccall"]=ccall;var cwrap=(ident,returnType,argTypes,opts)=>{var numericArgs=!argTypes||argTypes.every(type=>type==="number"||type==="boolean");var numericRet=returnType!=="string";if(numericRet&&numericArgs&&!opts){return getCFunc(ident)}return(...args)=>ccall(ident,returnType,argTypes,args,opts)};Module["cwrap"]=cwrap;var FS_createPath=FS.createPath;Module["FS_createPath"]=FS_createPath;var FS_unlink=path=>FS.unlink(path);Module["FS_unlink"]=FS_unlink;var FS_createLazyFile=FS.createLazyFile;Module["FS_createLazyFile"]=FS_createLazyFile;var FS_createDevice=FS.createDevice;Module["FS_createDevice"]=FS_createDevice;PThread.init();FS.createPreloadedFile=FS_createPreloadedFile;FS.staticInit();Module["FS_createPath"]=FS.createPath;Module["FS_createDataFile"]=FS.createDataFile;Module["FS_createPreloadedFile"]=FS.createPreloadedFile;Module["FS_unlink"]=FS.unlink;Module["FS_createLazyFile"]=FS.createLazyFile;Module["FS_createDevice"]=FS.createDevice;MEMFS.doesNotExistError=new FS.ErrnoError(44);MEMFS.doesNotExistError.stack="<generic error, no stack>";var proxiedFunctionTable=[_proc_exit,exitOnMainThread,pthreadCreateProxied,___syscall_fcntl64,___syscall_ioctl,___syscall_openat,__mmap_js,__munmap_js,__setitimer_js,_environ_get,_environ_sizes_get,_fd_close,_fd_read,_fd_seek,_fd_write];var wasmImports;function assignWasmImports(){wasmImports={u:___pthread_create_js,c:___syscall_fcntl64,h:___syscall_ioctl,i:___syscall_openat,H:__abort_js,C:__emscripten_init_main_thread_js,q:__emscripten_notify_mailbox_postmessage,v:__emscripten_receive_on_main_thread_js,l:__emscripten_runtime_keepalive_clear,d:__emscripten_thread_cleanup,B:__emscripten_thread_mailbox_await,n:__emscripten_thread_set_strongref,x:__mmap_js,y:__munmap_js,m:__setitimer_js,z:__tzset_js,G:_clock_time_get,e:_emscripten_check_blocking_allowed,w:_emscripten_date_now,j:_emscripten_exit_with_live_runtime,r:_emscripten_get_heap_max,b:_emscripten_get_now,s:_emscripten_num_logical_cores,p:_emscripten_resize_heap,D:_environ_get,E:_environ_sizes_get,t:_exit,f:_fd_close,g:_fd_read,A:_fd_seek,F:_fd_write,a:wasmMemory,k:_proc_exit,o:_random_get}}var wasmExports;createWasm();var ___wasm_call_ctors=()=>(___wasm_call_ctors=wasmExports["I"])();var _wllama_malloc=Module["_wllama_malloc"]=(a0,a1)=>(_wllama_malloc=Module["_wllama_malloc"]=wasmExports["J"])(a0,a1);var _wllama_start=Module["_wllama_start"]=()=>(_wllama_start=Module["_wllama_start"]=wasmExports["K"])();var _wllama_action=Module["_wllama_action"]=(a0,a1)=>(_wllama_action=Module["_wllama_action"]=wasmExports["L"])(a0,a1);var _wllama_exit=Module["_wllama_exit"]=()=>(_wllama_exit=Module["_wllama_exit"]=wasmExports["M"])();var _wllama_debug=Module["_wllama_debug"]=()=>(_wllama_debug=Module["_wllama_debug"]=wasmExports["N"])();var _main=Module["_main"]=(a0,a1)=>(_main=Module["_main"]=wasmExports["O"])(a0,a1);var __emscripten_tls_init=()=>(__emscripten_tls_init=wasmExports["P"])();var _pthread_self=()=>(_pthread_self=wasmExports["Q"])();var _emscripten_builtin_memalign=(a0,a1)=>(_emscripten_builtin_memalign=wasmExports["R"])(a0,a1);var __emscripten_thread_init=(a0,a1,a2,a3,a4,a5)=>(__emscripten_thread_init=wasmExports["T"])(a0,a1,a2,a3,a4,a5);var __emscripten_thread_crashed=()=>(__emscripten_thread_crashed=wasmExports["U"])();var __emscripten_run_on_main_thread_js=(a0,a1,a2,a3,a4)=>(__emscripten_run_on_main_thread_js=wasmExports["V"])(a0,a1,a2,a3,a4);var __emscripten_thread_free_data=a0=>(__emscripten_thread_free_data=wasmExports["W"])(a0);var __emscripten_thread_exit=a0=>(__emscripten_thread_exit=wasmExports["X"])(a0);var __emscripten_timeout=(a0,a1)=>(__emscripten_timeout=wasmExports["Y"])(a0,a1);var __emscripten_check_mailbox=()=>(__emscripten_check_mailbox=wasmExports["Z"])();var ___trap=()=>(___trap=wasmExports["_"])();var _emscripten_stack_set_limits=(a0,a1)=>(_emscripten_stack_set_limits=wasmExports["$"])(a0,a1);var __emscripten_stack_restore=a0=>(__emscripten_stack_restore=wasmExports["aa"])(a0);var __emscripten_stack_alloc=a0=>(__emscripten_stack_alloc=wasmExports["ba"])(a0);var _emscripten_stack_get_current=()=>(_emscripten_stack_get_current=wasmExports["ca"])();function applySignatureConversions(wasmExports){wasmExports=Object.assign({},wasmExports);var makeWrapper_p=f=>()=>f()>>>0;var makeWrapper_ppp=f=>(a0,a1)=>f(a0,a1)>>>0;var makeWrapper_pp=f=>a0=>f(a0)>>>0;wasmExports["Q"]=makeWrapper_p(wasmExports["Q"]);wasmExports["R"]=makeWrapper_ppp(wasmExports["R"]);wasmExports["ba"]=makeWrapper_pp(wasmExports["ba"]);wasmExports["ca"]=makeWrapper_p(wasmExports["ca"]);return wasmExports}Module["addRunDependency"]=addRunDependency;Module["removeRunDependency"]=removeRunDependency;Module["ccall"]=ccall;Module["cwrap"]=cwrap;Module["FS_createPreloadedFile"]=FS_createPreloadedFile;Module["FS_unlink"]=FS_unlink;Module["FS_createPath"]=FS_createPath;Module["FS_createDevice"]=FS_createDevice;Module["FS_createDataFile"]=FS_createDataFile;Module["FS_createLazyFile"]=FS_createLazyFile;function callMain(){var entryFunction=_main;var argc=0;var argv=0;try{var ret=entryFunction(argc,argv);exitJS(ret,true);return ret}catch(e){return handleException(e)}}function run(){if(runDependencies>0){dependenciesFulfilled=run;return}if(ENVIRONMENT_IS_PTHREAD){initRuntime();return}preRun();if(runDependencies>0){dependenciesFulfilled=run;return}function doRun(){Module["calledRun"]=true;if(ABORT)return;initRuntime();preMain();Module["onRuntimeInitialized"]?.();var noInitialRun=Module["noInitialRun"];if(!noInitialRun)callMain();postRun()}if(Module["setStatus"]){Module["setStatus"]("Running...");setTimeout(()=>{setTimeout(()=>Module["setStatus"](""),1);doRun()},1)}else{doRun()}}if(Module["preInit"]){if(typeof Module["preInit"]=="function")Module["preInit"]=[Module["preInit"]];while(Module["preInit"].length>0){Module["preInit"].pop()()}}run();\n',Wa='var Module=typeof Module!="undefined"?Module:{};var ENVIRONMENT_IS_WEB=typeof window=="object";var ENVIRONMENT_IS_WORKER=typeof WorkerGlobalScope!="undefined";var ENVIRONMENT_IS_NODE=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"&&process.type!="renderer";if(ENVIRONMENT_IS_NODE){}var moduleOverrides=Object.assign({},Module);var arguments_=[];var thisProgram="./this.program";var quit_=(status,toThrow)=>{throw toThrow};var scriptDirectory="";function locateFile(path){if(Module["locateFile"]){return Module["locateFile"](path,scriptDirectory)}return scriptDirectory+path}var readAsync,readBinary;if(ENVIRONMENT_IS_NODE){var fs=require("fs");var nodePath=require("path");scriptDirectory=__dirname+"/";readBinary=filename=>{filename=isFileURI(filename)?new URL(filename):filename;var ret=fs.readFileSync(filename);return ret};readAsync=async(filename,binary=true)=>{filename=isFileURI(filename)?new URL(filename):filename;var ret=fs.readFileSync(filename,binary?undefined:"utf8");return ret};if(!Module["thisProgram"]&&process.argv.length>1){thisProgram=process.argv[1].replace(/\\\\/g,"/")}arguments_=process.argv.slice(2);if(typeof module!="undefined"){module["exports"]=Module}quit_=(status,toThrow)=>{process.exitCode=status;throw toThrow}}else if(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER){if(ENVIRONMENT_IS_WORKER){scriptDirectory=self.location.href}else if(typeof document!="undefined"&&document.currentScript){scriptDirectory=document.currentScript.src}if(scriptDirectory.startsWith("blob:")){scriptDirectory=""}else{scriptDirectory=scriptDirectory.slice(0,scriptDirectory.replace(/[?#].*/,"").lastIndexOf("/")+1)}{if(ENVIRONMENT_IS_WORKER){readBinary=url=>{var xhr=new XMLHttpRequest;xhr.open("GET",url,false);xhr.responseType="arraybuffer";xhr.send(null);return new Uint8Array(xhr.response)}}readAsync=async url=>{if(isFileURI(url)){return new Promise((resolve,reject)=>{var xhr=new XMLHttpRequest;xhr.open("GET",url,true);xhr.responseType="arraybuffer";xhr.onload=()=>{if(xhr.status==200||xhr.status==0&&xhr.response){resolve(xhr.response);return}reject(xhr.status)};xhr.onerror=reject;xhr.send(null)})}var response=await fetch(url,{credentials:"same-origin"});if(response.ok){return response.arrayBuffer()}throw new Error(response.status+" : "+response.url)}}}else{}var out=Module["print"]||console.log.bind(console);var err=Module["printErr"]||console.error.bind(console);Object.assign(Module,moduleOverrides);moduleOverrides=null;if(Module["arguments"])arguments_=Module["arguments"];if(Module["thisProgram"])thisProgram=Module["thisProgram"];var wasmBinary=Module["wasmBinary"];var wasmMemory;var ABORT=false;var EXITSTATUS;var HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAP64,HEAPU64,HEAPF64;var runtimeInitialized=false;var isFileURI=filename=>filename.startsWith("file://");function updateMemoryViews(){var b=wasmMemory.buffer;Module["HEAP8"]=HEAP8=new Int8Array(b);Module["HEAP16"]=HEAP16=new Int16Array(b);Module["HEAPU8"]=HEAPU8=new Uint8Array(b);Module["HEAPU16"]=HEAPU16=new Uint16Array(b);Module["HEAP32"]=HEAP32=new Int32Array(b);Module["HEAPU32"]=HEAPU32=new Uint32Array(b);Module["HEAPF32"]=HEAPF32=new Float32Array(b);Module["HEAPF64"]=HEAPF64=new Float64Array(b);Module["HEAP64"]=HEAP64=new BigInt64Array(b);Module["HEAPU64"]=HEAPU64=new BigUint64Array(b)}function preRun(){if(Module["preRun"]){if(typeof Module["preRun"]=="function")Module["preRun"]=[Module["preRun"]];while(Module["preRun"].length){addOnPreRun(Module["preRun"].shift())}}callRuntimeCallbacks(onPreRuns)}function initRuntime(){runtimeInitialized=true;if(!Module["noFSInit"]&&!FS.initialized)FS.init();TTY.init();wasmExports["w"]();FS.ignorePermissions=false}function preMain(){}function postRun(){if(Module["postRun"]){if(typeof Module["postRun"]=="function")Module["postRun"]=[Module["postRun"]];while(Module["postRun"].length){addOnPostRun(Module["postRun"].shift())}}callRuntimeCallbacks(onPostRuns)}var runDependencies=0;var dependenciesFulfilled=null;function getUniqueRunDependency(id){return id}function addRunDependency(id){runDependencies++;Module["monitorRunDependencies"]?.(runDependencies)}function removeRunDependency(id){runDependencies--;Module["monitorRunDependencies"]?.(runDependencies);if(runDependencies==0){if(dependenciesFulfilled){var callback=dependenciesFulfilled;dependenciesFulfilled=null;callback()}}}function abort(what){Module["onAbort"]?.(what);what="Aborted("+what+")";err(what);ABORT=true;what+=". Build with -sASSERTIONS for more info.";if(runtimeInitialized){___trap()}var e=new WebAssembly.RuntimeError(what);throw e}var wasmBinaryFile;function findWasmBinary(){return locateFile("wllama.wasm")}function getBinarySync(file){if(file==wasmBinaryFile&&wasmBinary){return new Uint8Array(wasmBinary)}if(readBinary){return readBinary(file)}throw"both async and sync fetching of the wasm failed"}async function getWasmBinary(binaryFile){if(!wasmBinary){try{var response=await readAsync(binaryFile);return new Uint8Array(response)}catch{}}return getBinarySync(binaryFile)}async function instantiateArrayBuffer(binaryFile,imports){try{var binary=await getWasmBinary(binaryFile);var instance=await WebAssembly.instantiate(binary,imports);return instance}catch(reason){err(`failed to asynchronously prepare wasm: ${reason}`);abort(reason)}}async function instantiateAsync(binary,binaryFile,imports){if(!binary&&typeof WebAssembly.instantiateStreaming=="function"&&!isFileURI(binaryFile)&&!ENVIRONMENT_IS_NODE){try{var response=fetch(binaryFile,{credentials:"same-origin"});var instantiationResult=await WebAssembly.instantiateStreaming(response,imports);return instantiationResult}catch(reason){err(`wasm streaming compile failed: ${reason}`);err("falling back to ArrayBuffer instantiation")}}return instantiateArrayBuffer(binaryFile,imports)}function getWasmImports(){return{a:wasmImports}}async function createWasm(){function receiveInstance(instance,module){wasmExports=instance.exports;wasmExports=applySignatureConversions(wasmExports);wasmMemory=wasmExports["v"];updateMemoryViews();removeRunDependency("wasm-instantiate");return wasmExports}addRunDependency("wasm-instantiate");function receiveInstantiationResult(result){return receiveInstance(result["instance"])}var info=getWasmImports();if(Module["instantiateWasm"]){return new Promise((resolve,reject)=>{Module["instantiateWasm"](info,(mod,inst)=>{receiveInstance(mod,inst);resolve(mod.exports)})})}wasmBinaryFile??=findWasmBinary();var result=await instantiateAsync(wasmBinary,wasmBinaryFile,info);var exports=receiveInstantiationResult(result);return exports}class ExitStatus{name="ExitStatus";constructor(status){this.message=`Program terminated with exit(${status})`;this.status=status}}Module["ExitStatus"]=ExitStatus;var callRuntimeCallbacks=callbacks=>{while(callbacks.length>0){callbacks.shift()(Module)}};Module["callRuntimeCallbacks"]=callRuntimeCallbacks;var onPostRuns=[];Module["onPostRuns"]=onPostRuns;var addOnPostRun=cb=>onPostRuns.unshift(cb);Module["addOnPostRun"]=addOnPostRun;var onPreRuns=[];Module["onPreRuns"]=onPreRuns;var addOnPreRun=cb=>onPreRuns.unshift(cb);Module["addOnPreRun"]=addOnPreRun;function getValue(ptr,type="i8"){if(type.endsWith("*"))type="*";switch(type){case"i1":return HEAP8[ptr>>>0];case"i8":return HEAP8[ptr>>>0];case"i16":return HEAP16[ptr>>>1>>>0];case"i32":return HEAP32[ptr>>>2>>>0];case"i64":return HEAP64[ptr>>>3];case"float":return HEAPF32[ptr>>>2>>>0];case"double":return HEAPF64[ptr>>>3>>>0];case"*":return HEAPU32[ptr>>>2>>>0];default:abort(`invalid type for getValue: ${type}`)}}Module["getValue"]=getValue;var noExitRuntime=Module["noExitRuntime"]||true;Module["noExitRuntime"]=noExitRuntime;function setValue(ptr,value,type="i8"){if(type.endsWith("*"))type="*";switch(type){case"i1":HEAP8[ptr>>>0]=value;break;case"i8":HEAP8[ptr>>>0]=value;break;case"i16":HEAP16[ptr>>>1>>>0]=value;break;case"i32":HEAP32[ptr>>>2>>>0]=value;break;case"i64":HEAP64[ptr>>>3]=BigInt(value);break;case"float":HEAPF32[ptr>>>2>>>0]=value;break;case"double":HEAPF64[ptr>>>3>>>0]=value;break;case"*":HEAPU32[ptr>>>2>>>0]=value;break;default:abort(`invalid type for setValue: ${type}`)}}Module["setValue"]=setValue;var syscallGetVarargI=()=>{var ret=HEAP32[+SYSCALLS.varargs>>>2>>>0];SYSCALLS.varargs+=4;return ret};Module["syscallGetVarargI"]=syscallGetVarargI;var syscallGetVarargP=syscallGetVarargI;Module["syscallGetVarargP"]=syscallGetVarargP;var PATH={isAbs:path=>path.charAt(0)==="/",splitPath:filename=>{var splitPathRe=/^(\\/?|)([\\s\\S]*?)((?:\\.{1,2}|[^\\/]+?|)(\\.[^.\\/]*|))(?:[\\/]*)$/;return splitPathRe.exec(filename).slice(1)},normalizeArray:(parts,allowAboveRoot)=>{var up=0;for(var i=parts.length-1;i>=0;i--){var last=parts[i];if(last==="."){parts.splice(i,1)}else if(last===".."){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot){for(;up;up--){parts.unshift("..")}}return parts},normalize:path=>{var isAbsolute=PATH.isAbs(path),trailingSlash=path.slice(-1)==="/";path=PATH.normalizeArray(path.split("/").filter(p=>!!p),!isAbsolute).join("/");if(!path&&!isAbsolute){path="."}if(path&&trailingSlash){path+="/"}return(isAbsolute?"/":"")+path},dirname:path=>{var result=PATH.splitPath(path),root=result[0],dir=result[1];if(!root&&!dir){return"."}if(dir){dir=dir.slice(0,-1)}return root+dir},basename:path=>path&&path.match(/([^\\/]+|\\/)\\/*$/)[1],join:(...paths)=>PATH.normalize(paths.join("/")),join2:(l,r)=>PATH.normalize(l+"/"+r)};Module["PATH"]=PATH;var initRandomFill=()=>{if(ENVIRONMENT_IS_NODE){var nodeCrypto=require("crypto");return view=>nodeCrypto.randomFillSync(view)}return view=>crypto.getRandomValues(view)};Module["initRandomFill"]=initRandomFill;var randomFill=view=>{(randomFill=initRandomFill())(view)};Module["randomFill"]=randomFill;var PATH_FS={resolve:(...args)=>{var resolvedPath="",resolvedAbsolute=false;for(var i=args.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?args[i]:FS.cwd();if(typeof path!="string"){throw new TypeError("Arguments to path.resolve must be strings")}else if(!path){return""}resolvedPath=path+"/"+resolvedPath;resolvedAbsolute=PATH.isAbs(path)}resolvedPath=PATH.normalizeArray(resolvedPath.split("/").filter(p=>!!p),!resolvedAbsolute).join("/");return(resolvedAbsolute?"/":"")+resolvedPath||"."},relative:(from,to)=>{from=PATH_FS.resolve(from).slice(1);to=PATH_FS.resolve(to).slice(1);function trim(arr){var start=0;for(;start<arr.length;start++){if(arr[start]!=="")break}var end=arr.length-1;for(;end>=0;end--){if(arr[end]!=="")break}if(start>end)return[];return arr.slice(start,end-start+1)}var fromParts=trim(from.split("/"));var toParts=trim(to.split("/"));var length=Math.min(fromParts.length,toParts.length);var samePartsLength=length;for(var i=0;i<length;i++){if(fromParts[i]!==toParts[i]){samePartsLength=i;break}}var outputParts=[];for(var i=samePartsLength;i<fromParts.length;i++){outputParts.push("..")}outputParts=outputParts.concat(toParts.slice(samePartsLength));return outputParts.join("/")}};Module["PATH_FS"]=PATH_FS;var UTF8Decoder=typeof TextDecoder!="undefined"?new TextDecoder:undefined;Module["UTF8Decoder"]=UTF8Decoder;var UTF8ArrayToString=(heapOrArray,idx=0,maxBytesToRead=NaN)=>{idx>>>=0;var endIdx=idx+maxBytesToRead;var endPtr=idx;while(heapOrArray[endPtr]&&!(endPtr>=endIdx))++endPtr;if(endPtr-idx>16&&heapOrArray.buffer&&UTF8Decoder){return UTF8Decoder.decode(heapOrArray.subarray(idx,endPtr))}var str="";while(idx<endPtr){var u0=heapOrArray[idx++];if(!(u0&128)){str+=String.fromCharCode(u0);continue}var u1=heapOrArray[idx++]&63;if((u0&224)==192){str+=String.fromCharCode((u0&31)<<6|u1);continue}var u2=heapOrArray[idx++]&63;if((u0&240)==224){u0=(u0&15)<<12|u1<<6|u2}else{u0=(u0&7)<<18|u1<<12|u2<<6|heapOrArray[idx++]&63}if(u0<65536){str+=String.fromCharCode(u0)}else{var ch=u0-65536;str+=String.fromCharCode(55296|ch>>10,56320|ch&1023)}}return str};Module["UTF8ArrayToString"]=UTF8ArrayToString;var FS_stdin_getChar_buffer=[];Module["FS_stdin_getChar_buffer"]=FS_stdin_getChar_buffer;var lengthBytesUTF8=str=>{var len=0;for(var i=0;i<str.length;++i){var c=str.charCodeAt(i);if(c<=127){len++}else if(c<=2047){len+=2}else if(c>=55296&&c<=57343){len+=4;++i}else{len+=3}}return len};Module["lengthBytesUTF8"]=lengthBytesUTF8;var stringToUTF8Array=(str,heap,outIdx,maxBytesToWrite)=>{outIdx>>>=0;if(!(maxBytesToWrite>0))return 0;var startIdx=outIdx;var endIdx=outIdx+maxBytesToWrite-1;for(var i=0;i<str.length;++i){var u=str.charCodeAt(i);if(u>=55296&&u<=57343){var u1=str.charCodeAt(++i);u=65536+((u&1023)<<10)|u1&1023}if(u<=127){if(outIdx>=endIdx)break;heap[outIdx++>>>0]=u}else if(u<=2047){if(outIdx+1>=endIdx)break;heap[outIdx++>>>0]=192|u>>6;heap[outIdx++>>>0]=128|u&63}else if(u<=65535){if(outIdx+2>=endIdx)break;heap[outIdx++>>>0]=224|u>>12;heap[outIdx++>>>0]=128|u>>6&63;heap[outIdx++>>>0]=128|u&63}else{if(outIdx+3>=endIdx)break;heap[outIdx++>>>0]=240|u>>18;heap[outIdx++>>>0]=128|u>>12&63;heap[outIdx++>>>0]=128|u>>6&63;heap[outIdx++>>>0]=128|u&63}}heap[outIdx>>>0]=0;return outIdx-startIdx};Module["stringToUTF8Array"]=stringToUTF8Array;var intArrayFromString=(stringy,dontAddNull,length)=>{var len=length>0?length:lengthBytesUTF8(stringy)+1;var u8array=new Array(len);var numBytesWritten=stringToUTF8Array(stringy,u8array,0,u8array.length);if(dontAddNull)u8array.length=numBytesWritten;return u8array};Module["intArrayFromString"]=intArrayFromString;var FS_stdin_getChar=()=>{if(!FS_stdin_getChar_buffer.length){var result=null;if(ENVIRONMENT_IS_NODE){var BUFSIZE=256;var buf=Buffer.alloc(BUFSIZE);var bytesRead=0;var fd=process.stdin.fd;try{bytesRead=fs.readSync(fd,buf,0,BUFSIZE)}catch(e){if(e.toString().includes("EOF"))bytesRead=0;else throw e}if(bytesRead>0){result=buf.slice(0,bytesRead).toString("utf-8")}}else if(typeof window!="undefined"&&typeof window.prompt=="function"){result=window.prompt("Input: ");if(result!==null){result+="\\n"}}else{}if(!result){return null}FS_stdin_getChar_buffer=intArrayFromString(result,true)}return FS_stdin_getChar_buffer.shift()};Module["FS_stdin_getChar"]=FS_stdin_getChar;var TTY={ttys:[],init(){},shutdown(){},register(dev,ops){TTY.ttys[dev]={input:[],output:[],ops};FS.registerDevice(dev,TTY.stream_ops)},stream_ops:{open(stream){var tty=TTY.ttys[stream.node.rdev];if(!tty){throw new FS.ErrnoError(43)}stream.tty=tty;stream.seekable=false},close(stream){stream.tty.ops.fsync(stream.tty)},fsync(stream){stream.tty.ops.fsync(stream.tty)},read(stream,buffer,offset,length,pos){if(!stream.tty||!stream.tty.ops.get_char){throw new FS.ErrnoError(60)}var bytesRead=0;for(var i=0;i<length;i++){var result;try{result=stream.tty.ops.get_char(stream.tty)}catch(e){throw new FS.ErrnoError(29)}if(result===undefined&&bytesRead===0){throw new FS.ErrnoError(6)}if(result===null||result===undefined)break;bytesRead++;buffer[offset+i]=result}if(bytesRead){stream.node.atime=Date.now()}return bytesRead},write(stream,buffer,offset,length,pos){if(!stream.tty||!stream.tty.ops.put_char){throw new FS.ErrnoError(60)}try{for(var i=0;i<length;i++){stream.tty.ops.put_char(stream.tty,buffer[offset+i])}}catch(e){throw new FS.ErrnoError(29)}if(length){stream.node.mtime=stream.node.ctime=Date.now()}return i}},default_tty_ops:{get_char(tty){return FS_stdin_getChar()},put_char(tty,val){if(val===null||val===10){out(UTF8ArrayToString(tty.output));tty.output=[]}else{if(val!=0)tty.output.push(val)}},fsync(tty){if(tty.output?.length>0){out(UTF8ArrayToString(tty.output));tty.output=[]}},ioctl_tcgets(tty){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(tty,optional_actions,data){return 0},ioctl_tiocgwinsz(tty){return[24,80]}},default_tty1_ops:{put_char(tty,val){if(val===null||val===10){err(UTF8ArrayToString(tty.output));tty.output=[]}else{if(val!=0)tty.output.push(val)}},fsync(tty){if(tty.output?.length>0){err(UTF8ArrayToString(tty.output));tty.output=[]}}}};Module["TTY"]=TTY;var zeroMemory=(address,size)=>{HEAPU8.fill(0,address,address+size)};Module["zeroMemory"]=zeroMemory;var alignMemory=(size,alignment)=>Math.ceil(size/alignment)*alignment;Module["alignMemory"]=alignMemory;var mmapAlloc=size=>{size=alignMemory(size,65536);var ptr=_emscripten_builtin_memalign(65536,size);if(ptr)zeroMemory(ptr,size);return ptr};Module["mmapAlloc"]=mmapAlloc;var MEMFS={ops_table:null,mount(mount){return MEMFS.createNode(null,"/",16895,0)},createNode(parent,name,mode,dev){if(FS.isBlkdev(mode)||FS.isFIFO(mode)){throw new FS.ErrnoError(63)}MEMFS.ops_table||={dir:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr,lookup:MEMFS.node_ops.lookup,mknod:MEMFS.node_ops.mknod,rename:MEMFS.node_ops.rename,unlink:MEMFS.node_ops.unlink,rmdir:MEMFS.node_ops.rmdir,readdir:MEMFS.node_ops.readdir,symlink:MEMFS.node_ops.symlink},stream:{llseek:MEMFS.stream_ops.llseek}},file:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr},stream:{llseek:MEMFS.stream_ops.llseek,read:MEMFS.stream_ops.read,write:MEMFS.stream_ops.write,allocate:MEMFS.stream_ops.allocate,mmap:MEMFS.stream_ops.mmap,msync:MEMFS.stream_ops.msync}},link:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr,readlink:MEMFS.node_ops.readlink},stream:{}},chrdev:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr},stream:FS.chrdev_stream_ops}};var node=FS.createNode(parent,name,mode,dev);if(FS.isDir(node.mode)){node.node_ops=MEMFS.ops_table.dir.node;node.stream_ops=MEMFS.ops_table.dir.stream;node.contents={}}else if(FS.isFile(node.mode)){node.node_ops=MEMFS.ops_table.file.node;node.stream_ops=MEMFS.ops_table.file.stream;node.usedBytes=0;node.contents=null}else if(FS.isLink(node.mode)){node.node_ops=MEMFS.ops_table.link.node;node.stream_ops=MEMFS.ops_table.link.stream}else if(FS.isChrdev(node.mode)){node.node_ops=MEMFS.ops_table.chrdev.node;node.stream_ops=MEMFS.ops_table.chrdev.stream}node.atime=node.mtime=node.ctime=Date.now();if(parent){parent.contents[name]=node;parent.atime=parent.mtime=parent.ctime=node.atime}return node},getFileDataAsTypedArray(node){if(!node.contents)return new Uint8Array(0);if(node.contents.subarray)return node.contents.subarray(0,node.usedBytes);return new Uint8Array(node.contents)},expandFileStorage(node,newCapacity){var prevCapacity=node.contents?node.contents.length:0;if(prevCapacity>=newCapacity)return;var CAPACITY_DOUBLING_MAX=1024*1024;newCapacity=Math.max(newCapacity,prevCapacity*(prevCapacity<CAPACITY_DOUBLING_MAX?2:1.125)>>>0);if(prevCapacity!=0)newCapacity=Math.max(newCapacity,256);var oldContents=node.contents;node.contents=new Uint8Array(newCapacity);if(node.usedBytes>0)node.contents.set(oldContents.subarray(0,node.usedBytes),0)},resizeFileStorage(node,newSize){if(node.usedBytes==newSize)return;if(newSize==0){node.contents=null;node.usedBytes=0}else{var oldContents=node.contents;node.contents=new Uint8Array(newSize);if(oldContents){node.contents.set(oldContents.subarray(0,Math.min(newSize,node.usedBytes)))}node.usedBytes=newSize}},node_ops:{getattr(node){var attr={};attr.dev=FS.isChrdev(node.mode)?node.id:1;attr.ino=node.id;attr.mode=node.mode;attr.nlink=1;attr.uid=0;attr.gid=0;attr.rdev=node.rdev;if(FS.isDir(node.mode)){attr.size=4096}else if(FS.isFile(node.mode)){attr.size=node.usedBytes}else if(FS.isLink(node.mode)){attr.size=node.link.length}else{attr.size=0}attr.atime=new Date(node.atime);attr.mtime=new Date(node.mtime);attr.ctime=new Date(node.ctime);attr.blksize=4096;attr.blocks=Math.ceil(attr.size/attr.blksize);return attr},setattr(node,attr){for(const key of["mode","atime","mtime","ctime"]){if(attr[key]!=null){node[key]=attr[key]}}if(attr.size!==undefined){MEMFS.resizeFileStorage(node,attr.size)}},lookup(parent,name){throw MEMFS.doesNotExistError},mknod(parent,name,mode,dev){return MEMFS.createNode(parent,name,mode,dev)},rename(old_node,new_dir,new_name){var new_node;try{new_node=FS.lookupNode(new_dir,new_name)}catch(e){}if(new_node){if(FS.isDir(old_node.mode)){for(var i in new_node.contents){throw new FS.ErrnoError(55)}}FS.hashRemoveNode(new_node)}delete old_node.parent.contents[old_node.name];new_dir.contents[new_name]=old_node;old_node.name=new_name;new_dir.ctime=new_dir.mtime=old_node.parent.ctime=old_node.parent.mtime=Date.now()},unlink(parent,name){delete parent.contents[name];parent.ctime=parent.mtime=Date.now()},rmdir(parent,name){var node=FS.lookupNode(parent,name);for(var i in node.contents){throw new FS.ErrnoError(55)}delete parent.contents[name];parent.ctime=parent.mtime=Date.now()},readdir(node){return[".","..",...Object.keys(node.contents)]},symlink(parent,newname,oldpath){var node=MEMFS.createNode(parent,newname,511|40960,0);node.link=oldpath;return node},readlink(node){if(!FS.isLink(node.mode)){throw new FS.ErrnoError(28)}return node.link}},stream_ops:{read(stream,buffer,offset,length,position){var contents=stream.node.contents;if(position>=stream.node.usedBytes)return 0;var size=Math.min(stream.node.usedBytes-position,length);if(size>8&&contents.subarray){buffer.set(contents.subarray(position,position+size),offset)}else{for(var i=0;i<size;i++)buffer[offset+i]=contents[position+i]}return size},write(stream,buffer,offset,length,position,canOwn){if(buffer.buffer===HEAP8.buffer){canOwn=false}if(!length)return 0;var node=stream.node;node.mtime=node.ctime=Date.now();if(buffer.subarray&&(!node.contents||node.contents.subarray)){if(canOwn){node.contents=buffer.subarray(offset,offset+length);node.usedBytes=length;return length}else if(node.usedBytes===0&&position===0){node.contents=buffer.slice(offset,offset+length);node.usedBytes=length;return length}else if(position+length<=node.usedBytes){node.contents.set(buffer.subarray(offset,offset+length),position);return length}}MEMFS.expandFileStorage(node,position+length);if(node.contents.subarray&&buffer.subarray){node.contents.set(buffer.subarray(offset,offset+length),position)}else{for(var i=0;i<length;i++){node.contents[position+i]=buffer[offset+i]}}node.usedBytes=Math.max(node.usedBytes,position+length);return length},llseek(stream,offset,whence){var position=offset;if(whence===1){position+=stream.position}else if(whence===2){if(FS.isFile(stream.node.mode)){position+=stream.node.usedBytes}}if(position<0){throw new FS.ErrnoError(28)}return position},allocate(stream,offset,length){MEMFS.expandFileStorage(stream.node,offset+length);stream.node.usedBytes=Math.max(stream.node.usedBytes,offset+length)},mmap(stream,length,position,prot,flags){if(!FS.isFile(stream.node.mode)){throw new FS.ErrnoError(43)}var ptr;var allocated;var contents=stream.node.contents;if(!(flags&2)&&contents&&contents.buffer===HEAP8.buffer){allocated=false;ptr=contents.byteOffset}else{allocated=true;ptr=mmapAlloc(length);if(!ptr){throw new FS.ErrnoError(48)}if(contents){if(position>0||position+length<contents.length){if(contents.subarray){contents=contents.subarray(position,position+length)}else{contents=Array.prototype.slice.call(contents,position,position+length)}}HEAP8.set(contents,ptr>>>0)}}return{ptr,allocated}},msync(stream,buffer,offset,length,mmapFlags){MEMFS.stream_ops.write(stream,buffer,0,length,offset,false);return 0}}};Module["MEMFS"]=MEMFS;var asyncLoad=async url=>{var arrayBuffer=await readAsync(url);return new Uint8Array(arrayBuffer)};Module["asyncLoad"]=asyncLoad;var FS_createDataFile=(parent,name,fileData,canRead,canWrite,canOwn)=>{FS.createDataFile(parent,name,fileData,canRead,canWrite,canOwn)};Module["FS_createDataFile"]=FS_createDataFile;var preloadPlugins=Module["preloadPlugins"]||[];Module["preloadPlugins"]=preloadPlugins;var FS_handledByPreloadPlugin=(byteArray,fullname,finish,onerror)=>{if(typeof Browser!="undefined")Browser.init();var handled=false;preloadPlugins.forEach(plugin=>{if(handled)return;if(plugin["canHandle"](fullname)){plugin["handle"](byteArray,fullname,finish,onerror);handled=true}});return handled};Module["FS_handledByPreloadPlugin"]=FS_handledByPreloadPlugin;var FS_createPreloadedFile=(parent,name,url,canRead,canWrite,onload,onerror,dontCreateFile,canOwn,preFinish)=>{var fullname=name?PATH_FS.resolve(PATH.join2(parent,name)):parent;var dep=getUniqueRunDependency(`cp ${fullname}`);function processData(byteArray){function finish(byteArray){preFinish?.();if(!dontCreateFile){FS_createDataFile(parent,name,byteArray,canRead,canWrite,canOwn)}onload?.();removeRunDependency(dep)}if(FS_handledByPreloadPlugin(byteArray,fullname,finish,()=>{onerror?.();removeRunDependency(dep)})){return}finish(byteArray)}addRunDependency(dep);if(typeof url=="string"){asyncLoad(url).then(processData,onerror)}else{processData(url)}};Module["FS_createPreloadedFile"]=FS_createPreloadedFile;var FS_modeStringToFlags=str=>{var flagModes={r:0,"r+":2,w:512|64|1,"w+":512|64|2,a:1024|64|1,"a+":1024|64|2};var flags=flagModes[str];if(typeof flags=="undefined"){throw new Error(`Unknown file open mode: ${str}`)}return flags};Module["FS_modeStringToFlags"]=FS_modeStringToFlags;var FS_getMode=(canRead,canWrite)=>{var mode=0;if(canRead)mode|=292|73;if(canWrite)mode|=146;return mode};Module["FS_getMode"]=FS_getMode;var FS={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:false,ignorePermissions:true,ErrnoError:class{name="ErrnoError";constructor(errno){this.errno=errno}},filesystems:null,syncFSRequests:0,readFiles:{},FSStream:class{shared={};get object(){return this.node}set object(val){this.node=val}get isRead(){return(this.flags&2097155)!==1}get isWrite(){return(this.flags&2097155)!==0}get isAppend(){return this.flags&1024}get flags(){return this.shared.flags}set flags(val){this.shared.flags=val}get position(){return this.shared.position}set position(val){this.shared.position=val}},FSNode:class{node_ops={};stream_ops={};readMode=292|73;writeMode=146;mounted=null;constructor(parent,name,mode,rdev){if(!parent){parent=this}this.parent=parent;this.mount=parent.mount;this.id=FS.nextInode++;this.name=name;this.mode=mode;this.rdev=rdev;this.atime=this.mtime=this.ctime=Date.now()}get read(){return(this.mode&this.readMode)===this.readMode}set read(val){val?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(val){val?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return FS.isDir(this.mode)}get isDevice(){return FS.isChrdev(this.mode)}},lookupPath(path,opts={}){if(!path){throw new FS.ErrnoError(44)}opts.follow_mount??=true;if(!PATH.isAbs(path)){path=FS.cwd()+"/"+path}linkloop:for(var nlinks=0;nlinks<40;nlinks++){var parts=path.split("/").filter(p=>!!p);var current=FS.root;var current_path="/";for(var i=0;i<parts.length;i++){var islast=i===parts.length-1;if(islast&&opts.parent){break}if(parts[i]==="."){continue}if(parts[i]===".."){current_path=PATH.dirname(current_path);current=current.parent;continue}current_path=PATH.join2(current_path,parts[i]);try{current=FS.lookupNode(current,parts[i])}catch(e){if(e?.errno===44&&islast&&opts.noent_okay){return{path:current_path}}throw e}if(FS.isMountpoint(current)&&(!islast||opts.follow_mount)){current=current.mounted.root}if(FS.isLink(current.mode)&&(!islast||opts.follow)){if(!current.node_ops.readlink){throw new FS.ErrnoError(52)}var link=current.node_ops.readlink(current);if(!PATH.isAbs(link)){link=PATH.dirname(current_path)+"/"+link}path=link+"/"+parts.slice(i+1).join("/");continue linkloop}}return{path:current_path,node:current}}throw new FS.ErrnoError(32)},getPath(node){var path;while(true){if(FS.isRoot(node)){var mount=node.mount.mountpoint;if(!path)return mount;return mount[mount.length-1]!=="/"?`${mount}/${path}`:mount+path}path=path?`${node.name}/${path}`:node.name;node=node.parent}},hashName(parentid,name){var hash=0;for(var i=0;i<name.length;i++){hash=(hash<<5)-hash+name.charCodeAt(i)|0}return(parentid+hash>>>0)%FS.nameTable.length},hashAddNode(node){var hash=FS.hashName(node.parent.id,node.name);node.name_next=FS.nameTable[hash];FS.nameTable[hash]=node},hashRemoveNode(node){var hash=FS.hashName(node.parent.id,node.name);if(FS.nameTable[hash]===node){FS.nameTable[hash]=node.name_next}else{var current=FS.nameTable[hash];while(current){if(current.name_next===node){current.name_next=node.name_next;break}current=current.name_next}}},lookupNode(parent,name){var errCode=FS.mayLookup(parent);if(errCode){throw new FS.ErrnoError(errCode)}var hash=FS.hashName(parent.id,name);for(var node=FS.nameTable[hash];node;node=node.name_next){var nodeName=node.name;if(node.parent.id===parent.id&&nodeName===name){return node}}return FS.lookup(parent,name)},createNode(parent,name,mode,rdev){var node=new FS.FSNode(parent,name,mode,rdev);FS.hashAddNode(node);return node},destroyNode(node){FS.hashRemoveNode(node)},isRoot(node){return node===node.parent},isMountpoint(node){return!!node.mounted},isFile(mode){return(mode&61440)===32768},isDir(mode){return(mode&61440)===16384},isLink(mode){return(mode&61440)===40960},isChrdev(mode){return(mode&61440)===8192},isBlkdev(mode){return(mode&61440)===24576},isFIFO(mode){return(mode&61440)===4096},isSocket(mode){return(mode&49152)===49152},flagsToPermissionString(flag){var perms=["r","w","rw"][flag&3];if(flag&512){perms+="w"}return perms},nodePermissions(node,perms){if(FS.ignorePermissions){return 0}if(perms.includes("r")&&!(node.mode&292)){return 2}else if(perms.includes("w")&&!(node.mode&146)){return 2}else if(perms.includes("x")&&!(node.mode&73)){return 2}return 0},mayLookup(dir){if(!FS.isDir(dir.mode))return 54;var errCode=FS.nodePermissions(dir,"x");if(errCode)return errCode;if(!dir.node_ops.lookup)return 2;return 0},mayCreate(dir,name){if(!FS.isDir(dir.mode)){return 54}try{var node=FS.lookupNode(dir,name);return 20}catch(e){}return FS.nodePermissions(dir,"wx")},mayDelete(dir,name,isdir){var node;try{node=FS.lookupNode(dir,name)}catch(e){return e.errno}var errCode=FS.nodePermissions(dir,"wx");if(errCode){return errCode}if(isdir){if(!FS.isDir(node.mode)){return 54}if(FS.isRoot(node)||FS.getPath(node)===FS.cwd()){return 10}}else{if(FS.isDir(node.mode)){return 31}}return 0},mayOpen(node,flags){if(!node){return 44}if(FS.isLink(node.mode)){return 32}else if(FS.isDir(node.mode)){if(FS.flagsToPermissionString(flags)!=="r"||flags&(512|64)){return 31}}return FS.nodePermissions(node,FS.flagsToPermissionString(flags))},checkOpExists(op,err){if(!op){throw new FS.ErrnoError(err)}return op},MAX_OPEN_FDS:4096,nextfd(){for(var fd=0;fd<=FS.MAX_OPEN_FDS;fd++){if(!FS.streams[fd]){return fd}}throw new FS.ErrnoError(33)},getStreamChecked(fd){var stream=FS.getStream(fd);if(!stream){throw new FS.ErrnoError(8)}return stream},getStream:fd=>FS.streams[fd],createStream(stream,fd=-1){stream=Object.assign(new FS.FSStream,stream);if(fd==-1){fd=FS.nextfd()}stream.fd=fd;FS.streams[fd]=stream;return stream},closeStream(fd){FS.streams[fd]=null},dupStream(origStream,fd=-1){var stream=FS.createStream(origStream,fd);stream.stream_ops?.dup?.(stream);return stream},doSetAttr(stream,node,attr){var setattr=stream?.stream_ops.setattr;var arg=setattr?stream:node;setattr??=node.node_ops.setattr;FS.checkOpExists(setattr,63);setattr(arg,attr)},chrdev_stream_ops:{open(stream){var device=FS.getDevice(stream.node.rdev);stream.stream_ops=device.stream_ops;stream.stream_ops.open?.(stream)},llseek(){throw new FS.ErrnoError(70)}},major:dev=>dev>>8,minor:dev=>dev&255,makedev:(ma,mi)=>ma<<8|mi,registerDevice(dev,ops){FS.devices[dev]={stream_ops:ops}},getDevice:dev=>FS.devices[dev],getMounts(mount){var mounts=[];var check=[mount];while(check.length){var m=check.pop();mounts.push(m);check.push(...m.mounts)}return mounts},syncfs(populate,callback){if(typeof populate=="function"){callback=populate;populate=false}FS.syncFSRequests++;if(FS.syncFSRequests>1){err(`warning: ${FS.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`)}var mounts=FS.getMounts(FS.root.mount);var completed=0;function doCallback(errCode){FS.syncFSRequests--;return callback(errCode)}function done(errCode){if(errCode){if(!done.errored){done.errored=true;return doCallback(errCode)}return}if(++completed>=mounts.length){doCallback(null)}}mounts.forEach(mount=>{if(!mount.type.syncfs){return done(null)}mount.type.syncfs(mount,populate,done)})},mount(type,opts,mountpoint){var root=mountpoint==="/";var pseudo=!mountpoint;var node;if(root&&FS.root){throw new FS.ErrnoError(10)}else if(!root&&!pseudo){var lookup=FS.lookupPath(mountpoint,{follow_mount:false});mountpoint=lookup.path;node=lookup.node;if(FS.isMountpoint(node)){throw new FS.ErrnoError(10)}if(!FS.isDir(node.mode)){throw new FS.ErrnoError(54)}}var mount={type,opts,mountpoint,mounts:[]};var mountRoot=type.mount(mount);mountRoot.mount=mount;mount.root=mountRoot;if(root){FS.root=mountRoot}else if(node){node.mounted=mount;if(node.mount){node.mount.mounts.push(mount)}}return mountRoot},unmount(mountpoint){var lookup=FS.lookupPath(mountpoint,{follow_mount:false});if(!FS.isMountpoint(lookup.node)){throw new FS.ErrnoError(28)}var node=lookup.node;var mount=node.mounted;var mounts=FS.getMounts(mount);Object.keys(FS.nameTable).forEach(hash=>{var current=FS.nameTable[hash];while(current){var next=current.name_next;if(mounts.includes(current.mount)){FS.destroyNode(current)}current=next}});node.mounted=null;var idx=node.mount.mounts.indexOf(mount);node.mount.mounts.splice(idx,1)},lookup(parent,name){return parent.node_ops.lookup(parent,name)},mknod(path,mode,dev){var lookup=FS.lookupPath(path,{parent:true});var parent=lookup.node;var name=PATH.basename(path);if(!name){throw new FS.ErrnoError(28)}if(name==="."||name===".."){throw new FS.ErrnoError(20)}var errCode=FS.mayCreate(parent,name);if(errCode){throw new FS.ErrnoError(errCode)}if(!parent.node_ops.mknod){throw new FS.ErrnoError(63)}return parent.node_ops.mknod(parent,name,mode,dev)},statfs(path){return FS.statfsNode(FS.lookupPath(path,{follow:true}).node)},statfsStream(stream){return FS.statfsNode(stream.node)},statfsNode(node){var rtn={bsize:4096,frsize:4096,blocks:1e6,bfree:5e5,bavail:5e5,files:FS.nextInode,ffree:FS.nextInode-1,fsid:42,flags:2,namelen:255};if(node.node_ops.statfs){Object.assign(rtn,node.node_ops.statfs(node.mount.opts.root))}return rtn},create(path,mode=438){mode&=4095;mode|=32768;return FS.mknod(path,mode,0)},mkdir(path,mode=511){mode&=511|512;mode|=16384;return FS.mknod(path,mode,0)},mkdirTree(path,mode){var dirs=path.split("/");var d="";for(var i=0;i<dirs.length;++i){if(!dirs[i])continue;d+="/"+dirs[i];try{FS.mkdir(d,mode)}catch(e){if(e.errno!=20)throw e}}},mkdev(path,mode,dev){if(typeof dev=="undefined"){dev=mode;mode=438}mode|=8192;return FS.mknod(path,mode,dev)},symlink(oldpath,newpath){if(!PATH_FS.resolve(oldpath)){throw new FS.ErrnoError(44)}var lookup=FS.lookupPath(newpath,{parent:true});var parent=lookup.node;if(!parent){throw new FS.ErrnoError(44)}var newname=PATH.basename(newpath);var errCode=FS.mayCreate(parent,newname);if(errCode){throw new FS.ErrnoError(errCode)}if(!parent.node_ops.symlink){throw new FS.ErrnoError(63)}return parent.node_ops.symlink(parent,newname,oldpath)},rename(old_path,new_path){var old_dirname=PATH.dirname(old_path);var new_dirname=PATH.dirname(new_path);var old_name=PATH.basename(old_path);var new_name=PATH.basename(new_path);var lookup,old_dir,new_dir;lookup=FS.lookupPath(old_path,{parent:true});old_dir=lookup.node;lookup=FS.lookupPath(new_path,{parent:true});new_dir=lookup.node;if(!old_dir||!new_dir)throw new FS.ErrnoError(44);if(old_dir.mount!==new_dir.mount){throw new FS.ErrnoError(75)}var old_node=FS.lookupNode(old_dir,old_name);var relative=PATH_FS.relative(old_path,new_dirname);if(relative.charAt(0)!=="."){throw new FS.ErrnoError(28)}relative=PATH_FS.relative(new_path,old_dirname);if(relative.charAt(0)!=="."){throw new FS.ErrnoError(55)}var new_node;try{new_node=FS.lookupNode(new_dir,new_name)}catch(e){}if(old_node===new_node){return}var isdir=FS.isDir(old_node.mode);var errCode=FS.mayDelete(old_dir,old_name,isdir);if(errCode){throw new FS.ErrnoError(errCode)}errCode=new_node?FS.mayDelete(new_dir,new_name,isdir):FS.mayCreate(new_dir,new_name);if(errCode){throw new FS.ErrnoError(errCode)}if(!old_dir.node_ops.rename){throw new FS.ErrnoError(63)}if(FS.isMountpoint(old_node)||new_node&&FS.isMountpoint(new_node)){throw new FS.ErrnoError(10)}if(new_dir!==old_dir){errCode=FS.nodePermissions(old_dir,"w");if(errCode){throw new FS.ErrnoError(errCode)}}FS.hashRemoveNode(old_node);try{old_dir.node_ops.rename(old_node,new_dir,new_name);old_node.parent=new_dir}catch(e){throw e}finally{FS.hashAddNode(old_node)}},rmdir(path){var lookup=FS.lookupPath(path,{parent:true});var parent=lookup.node;var name=PATH.basename(path);var node=FS.lookupNode(parent,name);var errCode=FS.mayDelete(parent,name,true);if(errCode){throw new FS.ErrnoError(errCode)}if(!parent.node_ops.rmdir){throw new FS.ErrnoError(63)}if(FS.isMountpoint(node)){throw new FS.ErrnoError(10)}parent.node_ops.rmdir(parent,name);FS.destroyNode(node)},readdir(path){var lookup=FS.lookupPath(path,{follow:true});var node=lookup.node;var readdir=FS.checkOpExists(node.node_ops.readdir,54);return readdir(node)},unlink(path){var lookup=FS.lookupPath(path,{parent:true});var parent=lookup.node;if(!parent){throw new FS.ErrnoError(44)}var name=PATH.basename(path);var node=FS.lookupNode(parent,name);var errCode=FS.mayDelete(parent,name,false);if(errCode){throw new FS.ErrnoError(errCode)}if(!parent.node_ops.unlink){throw new FS.ErrnoError(63)}if(FS.isMountpoint(node)){throw new FS.ErrnoError(10)}parent.node_ops.unlink(parent,name);FS.destroyNode(node)},readlink(path){var lookup=FS.lookupPath(path);var link=lookup.node;if(!link){throw new FS.ErrnoError(44)}if(!link.node_ops.readlink){throw new FS.ErrnoError(28)}return link.node_ops.readlink(link)},stat(path,dontFollow){var lookup=FS.lookupPath(path,{follow:!dontFollow});var node=lookup.node;var getattr=FS.checkOpExists(node.node_ops.getattr,63);return getattr(node)},fstat(fd){var stream=FS.getStreamChecked(fd);var node=stream.node;var getattr=stream.stream_ops.getattr;var arg=getattr?stream:node;getattr??=node.node_ops.getattr;FS.checkOpExists(getattr,63);return getattr(arg)},lstat(path){return FS.stat(path,true)},doChmod(stream,node,mode,dontFollow){FS.doSetAttr(stream,node,{mode:mode&4095|node.mode&~4095,ctime:Date.now(),dontFollow})},chmod(path,mode,dontFollow){var node;if(typeof path=="string"){var lookup=FS.lookupPath(path,{follow:!dontFollow});node=lookup.node}else{node=path}FS.doChmod(null,node,mode,dontFollow)},lchmod(path,mode){FS.chmod(path,mode,true)},fchmod(fd,mode){var stream=FS.getStreamChecked(fd);FS.doChmod(stream,stream.node,mode,false)},doChown(stream,node,dontFollow){FS.doSetAttr(stream,node,{timestamp:Date.now(),dontFollow})},chown(path,uid,gid,dontFollow){var node;if(typeof path=="string"){var lookup=FS.lookupPath(path,{follow:!dontFollow});node=lookup.node}else{node=path}FS.doChown(null,node,dontFollow)},lchown(path,uid,gid){FS.chown(path,uid,gid,true)},fchown(fd,uid,gid){var stream=FS.getStreamChecked(fd);FS.doChown(stream,stream.node,false)},doTruncate(stream,node,len){if(FS.isDir(node.mode)){throw new FS.ErrnoError(31)}if(!FS.isFile(node.mode)){throw new FS.ErrnoError(28)}var errCode=FS.nodePermissions(node,"w");if(errCode){throw new FS.ErrnoError(errCode)}FS.doSetAttr(stream,node,{size:len,timestamp:Date.now()})},truncate(path,len){if(len<0){throw new FS.ErrnoError(28)}var node;if(typeof path=="string"){var lookup=FS.lookupPath(path,{follow:true});node=lookup.node}else{node=path}FS.doTruncate(null,node,len)},ftruncate(fd,len){var stream=FS.getStreamChecked(fd);if(len<0||(stream.flags&2097155)===0){throw new FS.ErrnoError(28)}FS.doTruncate(stream,stream.node,len)},utime(path,atime,mtime){var lookup=FS.lookupPath(path,{follow:true});var node=lookup.node;var setattr=FS.checkOpExists(node.node_ops.setattr,63);setattr(node,{atime,mtime})},open(path,flags,mode=438){if(path===""){throw new FS.ErrnoError(44)}flags=typeof flags=="string"?FS_modeStringToFlags(flags):flags;if(flags&64){mode=mode&4095|32768}else{mode=0}var node;var isDirPath;if(typeof path=="object"){node=path}else{isDirPath=path.endsWith("/");var lookup=FS.lookupPath(path,{follow:!(flags&131072),noent_okay:true});node=lookup.node;path=lookup.path}var created=false;if(flags&64){if(node){if(flags&128){throw new FS.ErrnoError(20)}}else if(isDirPath){throw new FS.ErrnoError(31)}else{node=FS.mknod(path,mode|511,0);created=true}}if(!node){throw new FS.ErrnoError(44)}if(FS.isChrdev(node.mode)){flags&=~512}if(flags&65536&&!FS.isDir(node.mode)){throw new FS.ErrnoError(54)}if(!created){var errCode=FS.mayOpen(node,flags);if(errCode){throw new FS.ErrnoError(errCode)}}if(flags&512&&!created){FS.truncate(node,0)}flags&=~(128|512|131072);var stream=FS.createStream({node,path:FS.getPath(node),flags,seekable:true,position:0,stream_ops:node.stream_ops,ungotten:[],error:false});if(stream.stream_ops.open){stream.stream_ops.open(stream)}if(created){FS.chmod(node,mode&511)}if(Module["logReadFiles"]&&!(flags&1)){if(!(path in FS.readFiles)){FS.readFiles[path]=1}}return stream},close(stream){if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if(stream.getdents)stream.getdents=null;try{if(stream.stream_ops.close){stream.stream_ops.close(stream)}}catch(e){throw e}finally{FS.closeStream(stream.fd)}stream.fd=null},isClosed(stream){return stream.fd===null},llseek(stream,offset,whence){if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if(!stream.seekable||!stream.stream_ops.llseek){throw new FS.ErrnoError(70)}if(whence!=0&&whence!=1&&whence!=2){throw new FS.ErrnoError(28)}stream.position=stream.stream_ops.llseek(stream,offset,whence);stream.ungotten=[];return stream.position},read(stream,buffer,offset,length,position){if(length<0||position<0){throw new FS.ErrnoError(28)}if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if((stream.flags&2097155)===1){throw new FS.ErrnoError(8)}if(FS.isDir(stream.node.mode)){throw new FS.ErrnoError(31)}if(!stream.stream_ops.read){throw new FS.ErrnoError(28)}var seeking=typeof position!="undefined";if(!seeking){position=stream.position}else if(!stream.seekable){throw new FS.ErrnoError(70)}var bytesRead=stream.stream_ops.read(stream,buffer,offset,length,position);if(!seeking)stream.position+=bytesRead;return bytesRead},write(stream,buffer,offset,length,position,canOwn){if(length<0||position<0){throw new FS.ErrnoError(28)}if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if((stream.flags&2097155)===0){throw new FS.ErrnoError(8)}if(FS.isDir(stream.node.mode)){throw new FS.ErrnoError(31)}if(!stream.stream_ops.write){throw new FS.ErrnoError(28)}if(stream.seekable&&stream.flags&1024){FS.llseek(stream,0,2)}var seeking=typeof position!="undefined";if(!seeking){position=stream.position}else if(!stream.seekable){throw new FS.ErrnoError(70)}var bytesWritten=stream.stream_ops.write(stream,buffer,offset,length,position,canOwn);if(!seeking)stream.position+=bytesWritten;return bytesWritten},allocate(stream,offset,length){if(FS.isClosed(stream)){throw new FS.ErrnoError(8)}if(offset<0||length<=0){throw new FS.ErrnoError(28)}if((stream.flags&2097155)===0){throw new FS.ErrnoError(8)}if(!FS.isFile(stream.node.mode)&&!FS.isDir(stream.node.mode)){throw new FS.ErrnoError(43)}if(!stream.stream_ops.allocate){throw new FS.ErrnoError(138)}stream.stream_ops.allocate(stream,offset,length)},mmap(stream,length,position,prot,flags){if((prot&2)!==0&&(flags&2)===0&&(stream.flags&2097155)!==2){throw new FS.ErrnoError(2)}if((stream.flags&2097155)===1){throw new FS.ErrnoError(2)}if(!stream.stream_ops.mmap){throw new FS.ErrnoError(43)}if(!length){throw new FS.ErrnoError(28)}return stream.stream_ops.mmap(stream,length,position,prot,flags)},msync(stream,buffer,offset,length,mmapFlags){if(!stream.stream_ops.msync){return 0}return stream.stream_ops.msync(stream,buffer,offset,length,mmapFlags)},ioctl(stream,cmd,arg){if(!stream.stream_ops.ioctl){throw new FS.ErrnoError(59)}return stream.stream_ops.ioctl(stream,cmd,arg)},readFile(path,opts={}){opts.flags=opts.flags||0;opts.encoding=opts.encoding||"binary";if(opts.encoding!=="utf8"&&opts.encoding!=="binary"){throw new Error(`Invalid encoding type "${opts.encoding}"`)}var ret;var stream=FS.open(path,opts.flags);var stat=FS.stat(path);var length=stat.size;var buf=new Uint8Array(length);FS.read(stream,buf,0,length,0);if(opts.encoding==="utf8"){ret=UTF8ArrayToString(buf)}else if(opts.encoding==="binary"){ret=buf}FS.close(stream);return ret},writeFile(path,data,opts={}){opts.flags=opts.flags||577;var stream=FS.open(path,opts.flags,opts.mode);if(typeof data=="string"){var buf=new Uint8Array(lengthBytesUTF8(data)+1);var actualNumBytes=stringToUTF8Array(data,buf,0,buf.length);FS.write(stream,buf,0,actualNumBytes,undefined,opts.canOwn)}else if(ArrayBuffer.isView(data)){FS.write(stream,data,0,data.byteLength,undefined,opts.canOwn)}else{throw new Error("Unsupported data type")}FS.close(stream)},cwd:()=>FS.currentPath,chdir(path){var lookup=FS.lookupPath(path,{follow:true});if(lookup.node===null){throw new FS.ErrnoError(44)}if(!FS.isDir(lookup.node.mode)){throw new FS.ErrnoError(54)}var errCode=FS.nodePermissions(lookup.node,"x");if(errCode){throw new FS.ErrnoError(errCode)}FS.currentPath=lookup.path},createDefaultDirectories(){FS.mkdir("/tmp");FS.mkdir("/home");FS.mkdir("/home/web_user")},createDefaultDevices(){FS.mkdir("/dev");FS.registerDevice(FS.makedev(1,3),{read:()=>0,write:(stream,buffer,offset,length,pos)=>length,llseek:()=>0});FS.mkdev("/dev/null",FS.makedev(1,3));TTY.register(FS.makedev(5,0),TTY.default_tty_ops);TTY.register(FS.makedev(6,0),TTY.default_tty1_ops);FS.mkdev("/dev/tty",FS.makedev(5,0));FS.mkdev("/dev/tty1",FS.makedev(6,0));var randomBuffer=new Uint8Array(1024),randomLeft=0;var randomByte=()=>{if(randomLeft===0){randomFill(randomBuffer);randomLeft=randomBuffer.byteLength}return randomBuffer[--randomLeft]};FS.createDevice("/dev","random",randomByte);FS.createDevice("/dev","urandom",randomByte);FS.mkdir("/dev/shm");FS.mkdir("/dev/shm/tmp")},createSpecialDirectories(){FS.mkdir("/proc");var proc_self=FS.mkdir("/proc/self");FS.mkdir("/proc/self/fd");FS.mount({mount(){var node=FS.createNode(proc_self,"fd",16895,73);node.stream_ops={llseek:MEMFS.stream_ops.llseek};node.node_ops={lookup(parent,name){var fd=+name;var stream=FS.getStreamChecked(fd);var ret={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>stream.path},id:fd+1};ret.parent=ret;return ret},readdir(){return Array.from(FS.streams.entries()).filter(([k,v])=>v).map(([k,v])=>k.toString())}};return node}},{},"/proc/self/fd")},createStandardStreams(input,output,error){if(input){FS.createDevice("/dev","stdin",input)}else{FS.symlink("/dev/tty","/dev/stdin")}if(output){FS.createDevice("/dev","stdout",null,output)}else{FS.symlink("/dev/tty","/dev/stdout")}if(error){FS.createDevice("/dev","stderr",null,error)}else{FS.symlink("/dev/tty1","/dev/stderr")}var stdin=FS.open("/dev/stdin",0);var stdout=FS.open("/dev/stdout",1);var stderr=FS.open("/dev/stderr",1)},staticInit(){FS.nameTable=new Array(4096);FS.mount(MEMFS,{},"/");FS.createDefaultDirectories();FS.createDefaultDevices();FS.createSpecialDirectories();FS.filesystems={MEMFS}},init(input,output,error){FS.initialized=true;input??=Module["stdin"];output??=Module["stdout"];error??=Module["stderr"];FS.createStandardStreams(input,output,error)},quit(){FS.initialized=false;for(var i=0;i<FS.streams.length;i++){var stream=FS.streams[i];if(!stream){continue}FS.close(stream)}},findObject(path,dontResolveLastLink){var ret=FS.analyzePath(path,dontResolveLastLink);if(!ret.exists){return null}return ret.object},analyzePath(path,dontResolveLastLink){try{var lookup=FS.lookupPath(path,{follow:!dontResolveLastLink});path=lookup.path}catch(e){}var ret={isRoot:false,exists:false,error:0,name:null,path:null,object:null,parentExists:false,parentPath:null,parentObject:null};try{var lookup=FS.lookupPath(path,{parent:true});ret.parentExists=true;ret.parentPath=lookup.path;ret.parentObject=lookup.node;ret.name=PATH.basename(path);lookup=FS.lookupPath(path,{follow:!dontResolveLastLink});ret.exists=true;ret.path=lookup.path;ret.object=lookup.node;ret.name=lookup.node.name;ret.isRoot=lookup.path==="/"}catch(e){ret.error=e.errno}return ret},createPath(parent,path,canRead,canWrite){parent=typeof parent=="string"?parent:FS.getPath(parent);var parts=path.split("/").reverse();while(parts.length){var part=parts.pop();if(!part)continue;var current=PATH.join2(parent,part);try{FS.mkdir(current)}catch(e){}parent=current}return current},createFile(parent,name,properties,canRead,canWrite){var path=PATH.join2(typeof parent=="string"?parent:FS.getPath(parent),name);var mode=FS_getMode(canRead,canWrite);return FS.create(path,mode)},createDataFile(parent,name,data,canRead,canWrite,canOwn){var path=name;if(parent){parent=typeof parent=="string"?parent:FS.getPath(parent);path=name?PATH.join2(parent,name):parent}var mode=FS_getMode(canRead,canWrite);var node=FS.create(path,mode);if(data){if(typeof data=="string"){var arr=new Array(data.length);for(var i=0,len=data.length;i<len;++i)arr[i]=data.charCodeAt(i);data=arr}FS.chmod(node,mode|146);var stream=FS.open(node,577);FS.write(stream,data,0,data.length,0,canOwn);FS.close(stream);FS.chmod(node,mode)}},createDevice(parent,name,input,output){var path=PATH.join2(typeof parent=="string"?parent:FS.getPath(parent),name);var mode=FS_getMode(!!input,!!output);FS.createDevice.major??=64;var dev=FS.makedev(FS.createDevice.major++,0);FS.registerDevice(dev,{open(stream){stream.seekable=false},close(stream){if(output?.buffer?.length){output(10)}},read(stream,buffer,offset,length,pos){var bytesRead=0;for(var i=0;i<length;i++){var result;try{result=input()}catch(e){throw new FS.ErrnoError(29)}if(result===undefined&&bytesRead===0){throw new FS.ErrnoError(6)}if(result===null||result===undefined)break;bytesRead++;buffer[offset+i]=result}if(bytesRead){stream.node.atime=Date.now()}return bytesRead},write(stream,buffer,offset,length,pos){for(var i=0;i<length;i++){try{output(buffer[offset+i])}catch(e){throw new FS.ErrnoError(29)}}if(length){stream.node.mtime=stream.node.ctime=Date.now()}return i}});return FS.mkdev(path,mode,dev)},forceLoadFile(obj){if(obj.isDevice||obj.isFolder||obj.link||obj.contents)return true;if(typeof XMLHttpRequest!="undefined"){throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.")}else{try{obj.contents=readBinary(obj.url);obj.usedBytes=obj.contents.length}catch(e){throw new FS.ErrnoError(29)}}},createLazyFile(parent,name,url,canRead,canWrite){class LazyUint8Array{lengthKnown=false;chunks=[];get(idx){if(idx>this.length-1||idx<0){return undefined}var chunkOffset=idx%this.chunkSize;var chunkNum=idx/this.chunkSize|0;return this.getter(chunkNum)[chunkOffset]}setDataGetter(getter){this.getter=getter}cacheLength(){var xhr=new XMLHttpRequest;xhr.open("HEAD",url,false);xhr.send(null);if(!(xhr.status>=200&&xhr.status<300||xhr.status===304))throw new Error("Couldn\'t load "+url+". Status: "+xhr.status);var datalength=Number(xhr.getResponseHeader("Content-length"));var header;var hasByteServing=(header=xhr.getResponseHeader("Accept-Ranges"))&&header==="bytes";var usesGzip=(header=xhr.getResponseHeader("Content-Encoding"))&&header==="gzip";var chunkSize=1024*1024;if(!hasByteServing)chunkSize=datalength;var doXHR=(from,to)=>{if(from>to)throw new Error("invalid range ("+from+", "+to+") or no bytes requested!");if(to>datalength-1)throw new Error("only "+datalength+" bytes available! programmer error!");var xhr=new XMLHttpRequest;xhr.open("GET",url,false);if(datalength!==chunkSize)xhr.setRequestHeader("Range","bytes="+from+"-"+to);xhr.responseType="arraybuffer";if(xhr.overrideMimeType){xhr.overrideMimeType("text/plain; charset=x-user-defined")}xhr.send(null);if(!(xhr.status>=200&&xhr.status<300||xhr.status===304))throw new Error("Couldn\'t load "+url+". Status: "+xhr.status);if(xhr.response!==undefined){return new Uint8Array(xhr.response||[])}return intArrayFromString(xhr.responseText||"",true)};var lazyArray=this;lazyArray.setDataGetter(chunkNum=>{var start=chunkNum*chunkSize;var end=(chunkNum+1)*chunkSize-1;end=Math.min(end,datalength-1);if(typeof lazyArray.chunks[chunkNum]=="undefined"){lazyArray.chunks[chunkNum]=doXHR(start,end)}if(typeof lazyArray.chunks[chunkNum]=="undefined")throw new Error("doXHR failed!");return lazyArray.chunks[chunkNum]});if(usesGzip||!datalength){chunkSize=datalength=1;datalength=this.getter(0).length;chunkSize=datalength;out("LazyFiles on gzip forces download of the whole file when length is accessed")}this._length=datalength;this._chunkSize=chunkSize;this.lengthKnown=true}get length(){if(!this.lengthKnown){this.cacheLength()}return this._length}get chunkSize(){if(!this.lengthKnown){this.cacheLength()}return this._chunkSize}}if(typeof XMLHttpRequest!="undefined"){if(!ENVIRONMENT_IS_WORKER)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var lazyArray=new LazyUint8Array;var properties={isDevice:false,contents:lazyArray}}else{var properties={isDevice:false,url}}var node=FS.createFile(parent,name,properties,canRead,canWrite);if(properties.contents){node.contents=properties.contents}else if(properties.url){node.contents=null;node.url=properties.url}Object.defineProperties(node,{usedBytes:{get:function(){return this.contents.length}}});var stream_ops={};var keys=Object.keys(node.stream_ops);keys.forEach(key=>{var fn=node.stream_ops[key];stream_ops[key]=(...args)=>{FS.forceLoadFile(node);return fn(...args)}});function writeChunks(stream,buffer,offset,length,position){var contents=stream.node.contents;if(position>=contents.length)return 0;var size=Math.min(contents.length-position,length);if(contents.slice){for(var i=0;i<size;i++){buffer[offset+i]=contents[position+i]}}else{for(var i=0;i<size;i++){buffer[offset+i]=contents.get(position+i)}}return size}stream_ops.read=(stream,buffer,offset,length,position)=>{FS.forceLoadFile(node);return writeChunks(stream,buffer,offset,length,position)};stream_ops.mmap=(stream,length,position,prot,flags)=>{FS.forceLoadFile(node);var ptr=mmapAlloc(length);if(!ptr){throw new FS.ErrnoError(48)}writeChunks(stream,HEAP8,ptr,length,position);return{ptr,allocated:true}};node.stream_ops=stream_ops;return node}};Module["FS"]=FS;var UTF8ToString=(ptr,maxBytesToRead)=>{ptr>>>=0;return ptr?UTF8ArrayToString(HEAPU8,ptr,maxBytesToRead):""};Module["UTF8ToString"]=UTF8ToString;var SYSCALLS={DEFAULT_POLLMASK:5,calculateAt(dirfd,path,allowEmpty){if(PATH.isAbs(path)){return path}var dir;if(dirfd===-100){dir=FS.cwd()}else{var dirstream=SYSCALLS.getStreamFromFD(dirfd);dir=dirstream.path}if(path.length==0){if(!allowEmpty){throw new FS.ErrnoError(44)}return dir}return dir+"/"+path},writeStat(buf,stat){HEAP32[buf>>>2>>>0]=stat.dev;HEAP32[buf+4>>>2>>>0]=stat.mode;HEAPU32[buf+8>>>2>>>0]=stat.nlink;HEAP32[buf+12>>>2>>>0]=stat.uid;HEAP32[buf+16>>>2>>>0]=stat.gid;HEAP32[buf+20>>>2>>>0]=stat.rdev;HEAP64[buf+24>>>3]=BigInt(stat.size);HEAP32[buf+32>>>2>>>0]=4096;HEAP32[buf+36>>>2>>>0]=stat.blocks;var atime=stat.atime.getTime();var mtime=stat.mtime.getTime();var ctime=stat.ctime.getTime();HEAP64[buf+40>>>3]=BigInt(Math.floor(atime/1e3));HEAPU32[buf+48>>>2>>>0]=atime%1e3*1e3*1e3;HEAP64[buf+56>>>3]=BigInt(Math.floor(mtime/1e3));HEAPU32[buf+64>>>2>>>0]=mtime%1e3*1e3*1e3;HEAP64[buf+72>>>3]=BigInt(Math.floor(ctime/1e3));HEAPU32[buf+80>>>2>>>0]=ctime%1e3*1e3*1e3;HEAP64[buf+88>>>3]=BigInt(stat.ino);return 0},writeStatFs(buf,stats){HEAP32[buf+4>>>2>>>0]=stats.bsize;HEAP32[buf+40>>>2>>>0]=stats.bsize;HEAP32[buf+8>>>2>>>0]=stats.blocks;HEAP32[buf+12>>>2>>>0]=stats.bfree;HEAP32[buf+16>>>2>>>0]=stats.bavail;HEAP32[buf+20>>>2>>>0]=stats.files;HEAP32[buf+24>>>2>>>0]=stats.ffree;HEAP32[buf+28>>>2>>>0]=stats.fsid;HEAP32[buf+44>>>2>>>0]=stats.flags;HEAP32[buf+36>>>2>>>0]=stats.namelen},doMsync(addr,stream,len,flags,offset){if(!FS.isFile(stream.node.mode)){throw new FS.ErrnoError(43)}if(flags&2){return 0}var buffer=HEAPU8.slice(addr,addr+len);FS.msync(stream,buffer,offset,len,flags)},getStreamFromFD(fd){var stream=FS.getStreamChecked(fd);return stream},varargs:undefined,getStr(ptr){var ret=UTF8ToString(ptr);return ret}};Module["SYSCALLS"]=SYSCALLS;var INT53_MAX=9007199254740992;Module["INT53_MAX"]=INT53_MAX;var INT53_MIN=-9007199254740992;Module["INT53_MIN"]=INT53_MIN;var bigintToI53Checked=num=>num<INT53_MIN||num>INT53_MAX?NaN:Number(num);Module["bigintToI53Checked"]=bigintToI53Checked;function ___syscall_fcntl64(fd,cmd,varargs){varargs>>>=0;SYSCALLS.varargs=varargs;try{var stream=SYSCALLS.getStreamFromFD(fd);switch(cmd){case 0:{var arg=syscallGetVarargI();if(arg<0){return-28}while(FS.streams[arg]){arg++}var newStream;newStream=FS.dupStream(stream,arg);return newStream.fd}case 1:case 2:return 0;case 3:return stream.flags;case 4:{var arg=syscallGetVarargI();stream.flags|=arg;return 0}case 12:{var arg=syscallGetVarargP();var offset=0;HEAP16[arg+offset>>>1>>>0]=2;return 0}case 13:case 14:return 0}return-28}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["___syscall_fcntl64"]=___syscall_fcntl64;function ___syscall_ioctl(fd,op,varargs){varargs>>>=0;SYSCALLS.varargs=varargs;try{var stream=SYSCALLS.getStreamFromFD(fd);switch(op){case 21509:{if(!stream.tty)return-59;return 0}case 21505:{if(!stream.tty)return-59;if(stream.tty.ops.ioctl_tcgets){var termios=stream.tty.ops.ioctl_tcgets(stream);var argp=syscallGetVarargP();HEAP32[argp>>>2>>>0]=termios.c_iflag||0;HEAP32[argp+4>>>2>>>0]=termios.c_oflag||0;HEAP32[argp+8>>>2>>>0]=termios.c_cflag||0;HEAP32[argp+12>>>2>>>0]=termios.c_lflag||0;for(var i=0;i<32;i++){HEAP8[argp+i+17>>>0]=termios.c_cc[i]||0}return 0}return 0}case 21510:case 21511:case 21512:{if(!stream.tty)return-59;return 0}case 21506:case 21507:case 21508:{if(!stream.tty)return-59;if(stream.tty.ops.ioctl_tcsets){var argp=syscallGetVarargP();var c_iflag=HEAP32[argp>>>2>>>0];var c_oflag=HEAP32[argp+4>>>2>>>0];var c_cflag=HEAP32[argp+8>>>2>>>0];var c_lflag=HEAP32[argp+12>>>2>>>0];var c_cc=[];for(var i=0;i<32;i++){c_cc.push(HEAP8[argp+i+17>>>0])}return stream.tty.ops.ioctl_tcsets(stream.tty,op,{c_iflag,c_oflag,c_cflag,c_lflag,c_cc})}return 0}case 21519:{if(!stream.tty)return-59;var argp=syscallGetVarargP();HEAP32[argp>>>2>>>0]=0;return 0}case 21520:{if(!stream.tty)return-59;return-28}case 21531:{var argp=syscallGetVarargP();return FS.ioctl(stream,op,argp)}case 21523:{if(!stream.tty)return-59;if(stream.tty.ops.ioctl_tiocgwinsz){var winsize=stream.tty.ops.ioctl_tiocgwinsz(stream.tty);var argp=syscallGetVarargP();HEAP16[argp>>>1>>>0]=winsize[0];HEAP16[argp+2>>>1>>>0]=winsize[1]}return 0}case 21524:{if(!stream.tty)return-59;return 0}case 21515:{if(!stream.tty)return-59;return 0}default:return-28}}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["___syscall_ioctl"]=___syscall_ioctl;function ___syscall_openat(dirfd,path,flags,varargs){path>>>=0;varargs>>>=0;SYSCALLS.varargs=varargs;try{path=SYSCALLS.getStr(path);path=SYSCALLS.calculateAt(dirfd,path);var mode=varargs?syscallGetVarargI():0;return FS.open(path,flags,mode).fd}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["___syscall_openat"]=___syscall_openat;var __abort_js=()=>abort("");Module["__abort_js"]=__abort_js;var runtimeKeepaliveCounter=0;Module["runtimeKeepaliveCounter"]=runtimeKeepaliveCounter;var __emscripten_runtime_keepalive_clear=()=>{noExitRuntime=false;runtimeKeepaliveCounter=0};Module["__emscripten_runtime_keepalive_clear"]=__emscripten_runtime_keepalive_clear;function __mmap_js(len,prot,flags,fd,offset,allocated,addr){len>>>=0;offset=bigintToI53Checked(offset);allocated>>>=0;addr>>>=0;try{if(isNaN(offset))return 61;var stream=SYSCALLS.getStreamFromFD(fd);var res=FS.mmap(stream,len,offset,prot,flags);var ptr=res.ptr;HEAP32[allocated>>>2>>>0]=res.allocated;HEAPU32[addr>>>2>>>0]=ptr;return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["__mmap_js"]=__mmap_js;function __munmap_js(addr,len,prot,flags,fd,offset){addr>>>=0;len>>>=0;offset=bigintToI53Checked(offset);try{var stream=SYSCALLS.getStreamFromFD(fd);if(prot&2){SYSCALLS.doMsync(addr,stream,len,flags,offset)}}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return-e.errno}}Module["__munmap_js"]=__munmap_js;var timers={};Module["timers"]=timers;var handleException=e=>{if(e instanceof ExitStatus||e=="unwind"){return EXITSTATUS}quit_(1,e)};Module["handleException"]=handleException;var keepRuntimeAlive=()=>noExitRuntime||runtimeKeepaliveCounter>0;Module["keepRuntimeAlive"]=keepRuntimeAlive;var _proc_exit=code=>{EXITSTATUS=code;if(!keepRuntimeAlive()){Module["onExit"]?.(code);ABORT=true}quit_(code,new ExitStatus(code))};Module["_proc_exit"]=_proc_exit;var exitJS=(status,implicit)=>{EXITSTATUS=status;_proc_exit(status)};Module["exitJS"]=exitJS;var _exit=exitJS;Module["_exit"]=_exit;var maybeExit=()=>{if(!keepRuntimeAlive()){try{_exit(EXITSTATUS)}catch(e){handleException(e)}}};Module["maybeExit"]=maybeExit;var callUserCallback=func=>{if(ABORT){return}try{func();maybeExit()}catch(e){handleException(e)}};Module["callUserCallback"]=callUserCallback;var _emscripten_get_now=()=>performance.now();Module["_emscripten_get_now"]=_emscripten_get_now;var __setitimer_js=(which,timeout_ms)=>{if(timers[which]){clearTimeout(timers[which].id);delete timers[which]}if(!timeout_ms)return 0;var id=setTimeout(()=>{delete timers[which];callUserCallback(()=>__emscripten_timeout(which,_emscripten_get_now()))},timeout_ms);timers[which]={id,timeout_ms};return 0};Module["__setitimer_js"]=__setitimer_js;var stringToUTF8=(str,outPtr,maxBytesToWrite)=>stringToUTF8Array(str,HEAPU8,outPtr,maxBytesToWrite);Module["stringToUTF8"]=stringToUTF8;var __tzset_js=function(timezone,daylight,std_name,dst_name){timezone>>>=0;daylight>>>=0;std_name>>>=0;dst_name>>>=0;var currentYear=(new Date).getFullYear();var winter=new Date(currentYear,0,1);var summer=new Date(currentYear,6,1);var winterOffset=winter.getTimezoneOffset();var summerOffset=summer.getTimezoneOffset();var stdTimezoneOffset=Math.max(winterOffset,summerOffset);HEAPU32[timezone>>>2>>>0]=stdTimezoneOffset*60;HEAP32[daylight>>>2>>>0]=Number(winterOffset!=summerOffset);var extractZone=timezoneOffset=>{var sign=timezoneOffset>=0?"-":"+";var absOffset=Math.abs(timezoneOffset);var hours=String(Math.floor(absOffset/60)).padStart(2,"0");var minutes=String(absOffset%60).padStart(2,"0");return`UTC${sign}${hours}${minutes}`};var winterName=extractZone(winterOffset);var summerName=extractZone(summerOffset);if(summerOffset<winterOffset){stringToUTF8(winterName,std_name,17);stringToUTF8(summerName,dst_name,17)}else{stringToUTF8(winterName,dst_name,17);stringToUTF8(summerName,std_name,17)}};Module["__tzset_js"]=__tzset_js;var _emscripten_date_now=()=>Date.now();Module["_emscripten_date_now"]=_emscripten_date_now;var nowIsMonotonic=1;Module["nowIsMonotonic"]=nowIsMonotonic;var checkWasiClock=clock_id=>clock_id>=0&&clock_id<=3;Module["checkWasiClock"]=checkWasiClock;function _clock_time_get(clk_id,ignored_precision,ptime){ignored_precision=bigintToI53Checked(ignored_precision);ptime>>>=0;if(!checkWasiClock(clk_id)){return 28}var now;if(clk_id===0){now=_emscripten_date_now()}else if(nowIsMonotonic){now=_emscripten_get_now()}else{return 52}var nsec=Math.round(now*1e3*1e3);HEAP64[ptime>>>3]=BigInt(nsec);return 0}Module["_clock_time_get"]=_clock_time_get;var getHeapMax=()=>4294901760;Module["getHeapMax"]=getHeapMax;function _emscripten_get_heap_max(){return getHeapMax()}Module["_emscripten_get_heap_max"]=_emscripten_get_heap_max;var growMemory=size=>{var b=wasmMemory.buffer;var pages=(size-b.byteLength+65535)/65536|0;try{wasmMemory.grow(pages);updateMemoryViews();return 1}catch(e){}};Module["growMemory"]=growMemory;function _emscripten_resize_heap(requestedSize){requestedSize>>>=0;var oldSize=HEAPU8.length;var maxHeapSize=getHeapMax();if(requestedSize>maxHeapSize){return false}for(var cutDown=1;cutDown<=4;cutDown*=2){var overGrownHeapSize=oldSize*(1+.2/cutDown);overGrownHeapSize=Math.min(overGrownHeapSize,requestedSize+100663296);var newSize=Math.min(maxHeapSize,alignMemory(Math.max(requestedSize,overGrownHeapSize),65536));var replacement=growMemory(newSize);if(replacement){return true}}return false}Module["_emscripten_resize_heap"]=_emscripten_resize_heap;var ENV={};Module["ENV"]=ENV;var getExecutableName=()=>thisProgram||"./this.program";Module["getExecutableName"]=getExecutableName;var getEnvStrings=()=>{if(!getEnvStrings.strings){var lang=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8";var env={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:lang,_:getExecutableName()};for(var x in ENV){if(ENV[x]===undefined)delete env[x];else env[x]=ENV[x]}var strings=[];for(var x in env){strings.push(`${x}=${env[x]}`)}getEnvStrings.strings=strings}return getEnvStrings.strings};Module["getEnvStrings"]=getEnvStrings;var stringToAscii=(str,buffer)=>{for(var i=0;i<str.length;++i){HEAP8[buffer++>>>0]=str.charCodeAt(i)}HEAP8[buffer>>>0]=0};Module["stringToAscii"]=stringToAscii;var _environ_get=function(__environ,environ_buf){__environ>>>=0;environ_buf>>>=0;var bufSize=0;getEnvStrings().forEach((string,i)=>{var ptr=environ_buf+bufSize;HEAPU32[__environ+i*4>>>2>>>0]=ptr;stringToAscii(string,ptr);bufSize+=string.length+1});return 0};Module["_environ_get"]=_environ_get;var _environ_sizes_get=function(penviron_count,penviron_buf_size){penviron_count>>>=0;penviron_buf_size>>>=0;var strings=getEnvStrings();HEAPU32[penviron_count>>>2>>>0]=strings.length;var bufSize=0;strings.forEach(string=>bufSize+=string.length+1);HEAPU32[penviron_buf_size>>>2>>>0]=bufSize;return 0};Module["_environ_sizes_get"]=_environ_sizes_get;function _fd_close(fd){try{var stream=SYSCALLS.getStreamFromFD(fd);FS.close(stream);return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_fd_close"]=_fd_close;var doReadv=(stream,iov,iovcnt,offset)=>{var ret=0;for(var i=0;i<iovcnt;i++){var ptr=HEAPU32[iov>>>2>>>0];var len=HEAPU32[iov+4>>>2>>>0];iov+=8;var curr=FS.read(stream,HEAP8,ptr,len,offset);if(curr<0)return-1;ret+=curr;if(curr<len)break;if(typeof offset!="undefined"){offset+=curr}}return ret};Module["doReadv"]=doReadv;function _fd_read(fd,iov,iovcnt,pnum){iov>>>=0;iovcnt>>>=0;pnum>>>=0;try{var stream=SYSCALLS.getStreamFromFD(fd);var num=doReadv(stream,iov,iovcnt);HEAPU32[pnum>>>2>>>0]=num;return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_fd_read"]=_fd_read;function _fd_seek(fd,offset,whence,newOffset){offset=bigintToI53Checked(offset);newOffset>>>=0;try{if(isNaN(offset))return 61;var stream=SYSCALLS.getStreamFromFD(fd);FS.llseek(stream,offset,whence);HEAP64[newOffset>>>3]=BigInt(stream.position);if(stream.getdents&&offset===0&&whence===0)stream.getdents=null;return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_fd_seek"]=_fd_seek;var doWritev=(stream,iov,iovcnt,offset)=>{var ret=0;for(var i=0;i<iovcnt;i++){var ptr=HEAPU32[iov>>>2>>>0];var len=HEAPU32[iov+4>>>2>>>0];iov+=8;var curr=FS.write(stream,HEAP8,ptr,len,offset);if(curr<0)return-1;ret+=curr;if(curr<len){break}if(typeof offset!="undefined"){offset+=curr}}return ret};Module["doWritev"]=doWritev;function _fd_write(fd,iov,iovcnt,pnum){iov>>>=0;iovcnt>>>=0;pnum>>>=0;try{var stream=SYSCALLS.getStreamFromFD(fd);var num=doWritev(stream,iov,iovcnt);HEAPU32[pnum>>>2>>>0]=num;return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_fd_write"]=_fd_write;function _random_get(buffer,size){buffer>>>=0;size>>>=0;try{randomFill(HEAPU8.subarray(buffer>>>0,buffer+size>>>0));return 0}catch(e){if(typeof FS=="undefined"||!(e.name==="ErrnoError"))throw e;return e.errno}}Module["_random_get"]=_random_get;var getCFunc=ident=>{var func=Module["_"+ident];return func};Module["getCFunc"]=getCFunc;var writeArrayToMemory=(array,buffer)=>{HEAP8.set(array,buffer>>>0)};Module["writeArrayToMemory"]=writeArrayToMemory;var stackAlloc=sz=>__emscripten_stack_alloc(sz);Module["stackAlloc"]=stackAlloc;var stringToUTF8OnStack=str=>{var size=lengthBytesUTF8(str)+1;var ret=stackAlloc(size);stringToUTF8(str,ret,size);return ret};Module["stringToUTF8OnStack"]=stringToUTF8OnStack;var stackSave=()=>_emscripten_stack_get_current();Module["stackSave"]=stackSave;var stackRestore=val=>__emscripten_stack_restore(val);Module["stackRestore"]=stackRestore;var ccall=(ident,returnType,argTypes,args,opts)=>{var toC={string:str=>{var ret=0;if(str!==null&&str!==undefined&&str!==0){ret=stringToUTF8OnStack(str)}return ret},array:arr=>{var ret=stackAlloc(arr.length);writeArrayToMemory(arr,ret);return ret}};function convertReturnValue(ret){if(returnType==="string"){return UTF8ToString(ret)}if(returnType==="boolean")return Boolean(ret);return ret}var func=getCFunc(ident);var cArgs=[];var stack=0;if(args){for(var i=0;i<args.length;i++){var converter=toC[argTypes[i]];if(converter){if(stack===0)stack=stackSave();cArgs[i]=converter(args[i])}else{cArgs[i]=args[i]}}}var ret=func(...cArgs);function onDone(ret){if(stack!==0)stackRestore(stack);return convertReturnValue(ret)}ret=onDone(ret);return ret};Module["ccall"]=ccall;var cwrap=(ident,returnType,argTypes,opts)=>{var numericArgs=!argTypes||argTypes.every(type=>type==="number"||type==="boolean");var numericRet=returnType!=="string";if(numericRet&&numericArgs&&!opts){return getCFunc(ident)}return(...args)=>ccall(ident,returnType,argTypes,args,opts)};Module["cwrap"]=cwrap;var FS_createPath=FS.createPath;Module["FS_createPath"]=FS_createPath;var FS_unlink=path=>FS.unlink(path);Module["FS_unlink"]=FS_unlink;var FS_createLazyFile=FS.createLazyFile;Module["FS_createLazyFile"]=FS_createLazyFile;var FS_createDevice=FS.createDevice;Module["FS_createDevice"]=FS_createDevice;FS.createPreloadedFile=FS_createPreloadedFile;FS.staticInit();Module["FS_createPath"]=FS.createPath;Module["FS_createDataFile"]=FS.createDataFile;Module["FS_createPreloadedFile"]=FS.createPreloadedFile;Module["FS_unlink"]=FS.unlink;Module["FS_createLazyFile"]=FS.createLazyFile;Module["FS_createDevice"]=FS.createDevice;MEMFS.doesNotExistError=new FS.ErrnoError(44);MEMFS.doesNotExistError.stack="<generic error, no stack>";var wasmImports={b:___syscall_fcntl64,f:___syscall_ioctl,g:___syscall_openat,u:__abort_js,j:__emscripten_runtime_keepalive_clear,o:__mmap_js,p:__munmap_js,k:__setitimer_js,q:__tzset_js,t:_clock_time_get,i:_emscripten_date_now,n:_emscripten_get_heap_max,m:_emscripten_resize_heap,s:_environ_get,c:_environ_sizes_get,a:_fd_close,e:_fd_read,r:_fd_seek,d:_fd_write,h:_proc_exit,l:_random_get};var wasmExports;createWasm();var ___wasm_call_ctors=()=>(___wasm_call_ctors=wasmExports["w"])();var _wllama_malloc=Module["_wllama_malloc"]=(a0,a1)=>(_wllama_malloc=Module["_wllama_malloc"]=wasmExports["x"])(a0,a1);var _wllama_start=Module["_wllama_start"]=()=>(_wllama_start=Module["_wllama_start"]=wasmExports["y"])();var _wllama_action=Module["_wllama_action"]=(a0,a1)=>(_wllama_action=Module["_wllama_action"]=wasmExports["z"])(a0,a1);var _wllama_exit=Module["_wllama_exit"]=()=>(_wllama_exit=Module["_wllama_exit"]=wasmExports["A"])();var _wllama_debug=Module["_wllama_debug"]=()=>(_wllama_debug=Module["_wllama_debug"]=wasmExports["B"])();var _main=Module["_main"]=(a0,a1)=>(_main=Module["_main"]=wasmExports["C"])(a0,a1);var _emscripten_builtin_memalign=(a0,a1)=>(_emscripten_builtin_memalign=wasmExports["E"])(a0,a1);var __emscripten_timeout=(a0,a1)=>(__emscripten_timeout=wasmExports["F"])(a0,a1);var ___trap=()=>(___trap=wasmExports["G"])();var __emscripten_stack_restore=a0=>(__emscripten_stack_restore=wasmExports["H"])(a0);var __emscripten_stack_alloc=a0=>(__emscripten_stack_alloc=wasmExports["I"])(a0);var _emscripten_stack_get_current=()=>(_emscripten_stack_get_current=wasmExports["J"])();function applySignatureConversions(wasmExports){wasmExports=Object.assign({},wasmExports);var makeWrapper_ppp=f=>(a0,a1)=>f(a0,a1)>>>0;var makeWrapper_pp=f=>a0=>f(a0)>>>0;var makeWrapper_p=f=>()=>f()>>>0;wasmExports["E"]=makeWrapper_ppp(wasmExports["E"]);wasmExports["I"]=makeWrapper_pp(wasmExports["I"]);wasmExports["J"]=makeWrapper_p(wasmExports["J"]);return wasmExports}Module["addRunDependency"]=addRunDependency;Module["removeRunDependency"]=removeRunDependency;Module["ccall"]=ccall;Module["cwrap"]=cwrap;Module["FS_createPreloadedFile"]=FS_createPreloadedFile;Module["FS_unlink"]=FS_unlink;Module["FS_createPath"]=FS_createPath;Module["FS_createDevice"]=FS_createDevice;Module["FS_createDataFile"]=FS_createDataFile;Module["FS_createLazyFile"]=FS_createLazyFile;function callMain(){var entryFunction=_main;var argc=0;var argv=0;try{var ret=entryFunction(argc,argv);exitJS(ret,true);return ret}catch(e){return handleException(e)}}function run(){if(runDependencies>0){dependenciesFulfilled=run;return}preRun();if(runDependencies>0){dependenciesFulfilled=run;return}function doRun(){Module["calledRun"]=true;if(ABORT)return;initRuntime();preMain();Module["onRuntimeInitialized"]?.();var noInitialRun=Module["noInitialRun"];if(!noInitialRun)callMain();postRun()}if(Module["setStatus"]){Module["setStatus"]("Running...");setTimeout(()=>{setTimeout(()=>Module["setStatus"](""),1);doRun()},1)}else{doRun()}}if(Module["preInit"]){if(typeof Module["preInit"]=="function")Module["preInit"]=[Module["preInit"]];while(Module["preInit"].length>0){Module["preInit"].pop()()}}run();\n';class Ga{constructor(r,e=1,n,a){this.taskQueue=[],this.taskId=1,this.resultQueue=[],this.busy=!1,this.pathConfig=r,this.nbThread=e,this.multiThread=e>1,this.logger=a,this.suppressNativeLog=n}async moduleInit(r){if(!this.pathConfig["wllama.wasm"])throw new Error('"single-thread/wllama.wasm" is missing from pathConfig');let e=this.multiThread?Ha:Wa,n=e.replace("var Module","var ___Module");const a={pathConfig:this.pathConfig,nbThread:this.nbThread},o=[`const RUN_OPTIONS = ${JSON.stringify(a)};`,`function wModuleInit() { ${n}; return Module; }`,Ua].join(`;

`);this.worker=Zt(o),this.worker.onmessage=this.onRecvMsg.bind(this),this.worker.onerror=this.logger.error;const s=await this.pushTask({verb:"module.init",args:[new Blob([e],{type:"text/javascript"})],callbackId:this.taskId++}),i=[];for(const c of r){const l=await this.fileAlloc(c.name,c.blob.size);i.push({id:l,...c})}return await Promise.all(i.map(c=>this.fileWrite(c.id,c.blob))),s}async wllamaStart(){const r=await this.pushTask({verb:"wllama.start",args:[],callbackId:this.taskId++});return this.parseResult(r)}async wllamaAction(r,e){const n=Ta(e),a=await this.pushTask({verb:"wllama.action",args:[r,n],callbackId:this.taskId++});return Aa(a)}async wllamaExit(){if(this.worker){const r=await this.pushTask({verb:"wllama.exit",args:[],callbackId:this.taskId++});this.parseResult(r),this.worker.terminate()}}async wllamaDebug(){const r=await this.pushTask({verb:"wllama.debug",args:[],callbackId:this.taskId++});return JSON.parse(r)}async fileAlloc(r,e){return(await this.pushTask({verb:"fs.alloc",args:[r,e],callbackId:this.taskId++})).fileId}async fileWrite(r,e){const n=e.stream().getReader();let a=0;for(;;){const{done:o,value:s}=await n.read();if(o)break;const i=s.byteLength;await this.pushTask({verb:"fs.write",args:[r,s,a],callbackId:this.taskId++},[s.buffer]),a+=i}}parseResult(r){const e=JSON.parse(r);if(e&&e.error)throw new Error("Unknown error, please see console.log");return e}pushTask(r,e){return new Promise((n,a)=>{this.taskQueue.push({resolve:n,reject:a,param:r,buffers:e}),this.runTaskLoop()})}async runTaskLoop(){if(!this.busy){for(this.busy=!0;;){const r=this.taskQueue.shift();if(!r)break;this.resultQueue.push(r),this.worker.postMessage(r.param,hn()?void 0:{transfer:r.buffers??[]})}this.busy=!1}}onRecvMsg(r){if(!r.data)return;const{verb:e,args:n}=r.data;if(e&&e.startsWith("console.")){if(this.suppressNativeLog)return;e.endsWith("debug")&&this.logger.debug(...n),e.endsWith("log")&&this.logger.log(...n),e.endsWith("warn")&&this.logger.warn(...n),e.endsWith("error")&&this.logger.error(...n);return}else e==="signal.abort"&&this.abort(n[0]);const{callbackId:a,result:o,err:s}=r.data;if(a){const i=this.resultQueue.findIndex(c=>c.param.callbackId===a);if(i!==-1){const c=this.resultQueue.splice(i,1)[0];s?c.reject(s):c.resolve(o)}else this.logger.error(`Cannot find waiting task with callbackId = ${a}`)}}abort(r){for(;this.resultQueue.length>0;){const e=this.resultQueue.pop();if(!e)break;e.reject(new Error(`Received abort signal from llama.cpp; Message: ${r||"(empty)"}`))}}}const _e="__metadata__",$a="polyfill_for_older_version";class pn{async getNameFromURL(r){return await Se(r,"")}async write(r,e,n){return this.writeMetadata(r,n),await cr(r,e)}async download(r,e={}){const n=Zt(mn);let a=!1;e.signal&&(a=e.signal.aborted,e.signal.addEventListener("abort",()=>{a=!0,n.postMessage({action:"download-abort"})}),delete e.signal);const o=await Se(r,_e),s=await Se(r,"");return await new Promise((i,c)=>{n.postMessage({action:"download",url:r,filename:s,metadataFileName:o,options:{headers:e.headers,aborted:a}}),n.onmessage=l=>{if(l.data.ok)n.terminate(),i();else if(l.data.err)n.terminate(),c(l.data.err);else if(l.data.progress){const d=l.data.progress;e.progressCallback?.(d)}else c(new Error("Unknown message from worker")),console.error("Unknown message from worker",l.data)}})}async open(r){return await ur(r)}async getSize(r){return await qa(r)}async getMetadata(r){const e=await ur(r,_e),n=await this.getSize(r);if(!e)return n>0?{etag:$a,originalSize:n,originalURL:""}:null;try{return await new Response(e).json()}catch{return null}}async list(){const r=await st(),e=[],n={};for await(let[a,o]of r.entries())if(o.kind==="file"&&a.startsWith(_e)){const s=(await o.getFile()).stream(),i=await new Response(s).json().catch(c=>null);n[a.replace(_e,"")]=i}for await(let[a,o]of r.entries())o.kind==="file"&&!a.startsWith(_e)&&e.push({name:a,size:await o.getFile().then(s=>s.size),metadata:n[a]||{originalSize:(await o.getFile()).size,originalURL:"",etag:""}});return e}async clear(){await this.deleteMany(()=>!0)}async delete(r){const e=await this.getNameFromURL(r);await this.deleteMany(n=>n.name===r||n.name===e)}async deleteMany(r){const e=await st(),n=await this.list();for(const a of n)r(a)&&e.removeEntry(a.name)}async writeMetadata(r,e){const n=new Blob([JSON.stringify(e)],{type:"text/plain"});await cr(r,n.stream(),_e)}}async function cr(t,r,e=""){try{const n=await Se(t,e),a=await Va(n);await a.truncate(0);const o=r.getReader();for(;;){const{done:s,value:i}=await o.read();if(s)break;await a.write(i)}await a.close()}catch(n){console.error("opfsWrite",n)}}async function ur(t,r=""){const e=async o=>{try{return await(await(await st()).getFileHandle(o)).getFile()}catch{return null}};let n=await e(t);if(n)return n;const a=await Se(t,r);return n=await e(a),n}async function qa(t,r=""){try{const e=await st(),n=await Se(t,r);return(await(await e.getFileHandle(n)).getFile()).size}catch{return-1}}async function Se(t,r){const e=await crypto.subtle.digest("SHA-1",new TextEncoder().encode(t)),a=Array.from(new Uint8Array(e)).map(o=>o.toString(16).padStart(2,"0")).join("");return`${r}${a}_${t.split("/").pop()}`}async function st(){return await(await navigator.storage.getDirectory()).getDirectoryHandle("cache",{create:!0})}async function Va(t){const r=Zt(mn);let e,n;r.onmessage=o=>{o.data.ok?e(null):o.data.err&&n(o.data.err)};const a=o=>new Promise((s,i)=>{e=s,n=i,r.postMessage(o,hn()?void 0:{transfer:o.value?[o.value.buffer]:[]})});return await a({open:t}),{truncate:async()=>{},write:o=>a({value:o}),close:async()=>{await a({done:!0}),r.terminate()}}}const ja=3;class Dt{constructor(r,e,n){this.modelManager=r,this.url=e,n?(this.files=this.getAllFiles(n),this.size=gt(this.files.map(a=>a.metadata.originalSize))):(this.files=[],this.size=0)}async open(){if(this.size===-1)throw new P("Model is deleted from the cache; Call ModelManager.downloadModel to re-download the model","load_error");const r=[];for(const e of this.files){const n=await this.modelManager.cacheManager.open(e.name);if(!n)throw new Error(`Failed to open file ${e.name}; Hint: the model may be invalid, please refresh it`);r.push(n)}return r}validate(){const r=be.parseModelUrl(this.url).length;if(this.size===-1)return"deleted";if(this.size<16||this.files.length!==r)return"invalid";for(const e of this.files)if(!e.metadata||e.metadata.originalSize!==e.size)return"invalid";return"valid"}async refresh(r={}){const e=be.parseModelUrl(this.url),n=e.map((l,d)=>({url:l,index:d}));this.modelManager.logger.debug("Downloading model files:",e);const a=this.modelManager.params.parallelDownloads??ja,o=await this.getTotalDownloadSize(e),s=[],i=async()=>{for(;n.length>0;){const l=n.shift();if(!l)break;await this.modelManager.cacheManager.download(l.url,{...r,progressCallback:({loaded:d})=>{s[l.index]=d,r.progressCallback?.({loaded:gt(s),total:o})}})}},c=[];for(let l=0;l<a;l++)c.push(i()),s.push(0);await Promise.all(c),this.files=this.getAllFiles(await this.modelManager.cacheManager.list()),this.size=this.files.reduce((l,d)=>l+d.metadata.originalSize,0)}async remove(){this.files=this.getAllFiles(await this.modelManager.cacheManager.list()),await this.modelManager.cacheManager.deleteMany(r=>!!this.files.find(e=>e.name===r.name)),this.size=-1}getAllFiles(r){const e=new Set(be.parseModelUrl(this.url)),n=[];for(const a of e){const o=r.find(s=>s.metadata.originalURL===a);if(!o)throw new Error(`Model file not found: ${a}`);n.push(o)}return n.sort((a,o)=>a.metadata.originalURL.localeCompare(o.metadata.originalURL)),n}async getTotalDownloadSize(r){const n=(await Promise.all(r.map(a=>fetch(a,{method:"HEAD"})))).map(a=>Number(a.headers.get("content-length")||"0"));return gt(n)}}class be{constructor(r={}){this.cacheManager=r.cacheManager||new pn,this.params=r,this.logger=r.logger||console}static parseModelUrl(r){if(Array.isArray(r))return r;const e=/-(\d{5})-of-(\d{5})\.gguf(?:\?.*)?$/,a=r.match(/\.gguf(\?.*)?$/)?.[1]??"",o=r.match(e);if(!o)return[r];const s=r.replace(e,""),i=o[2];return Array.from({length:Number(i)},(l,d)=>(d+1).toString().padStart(5,"0")).map(l=>`${s}-${l}-of-${i}.gguf${a}`)}async getModels(r={}){const e=await this.cacheManager.list();let n=[];for(const a of e){const o=be.parseModelUrl(a.metadata.originalURL);(o.length===1||o[0]===a.metadata.originalURL)&&n.push(new Dt(this,a.metadata.originalURL,e))}return r.includeInvalid||(n=n.filter(a=>a.validate()==="valid")),n}async downloadModel(r,e={}){if(!fn(r))throw new P(`Invalid model URL: ${r}; URL must ends with ".gguf"`,"download_error");const n=new Dt(this,r,void 0);return n.validate()!=="valid"&&await n.refresh(e),n}async getModelOrDownload(r,e={}){const a=(await this.getModels()).find(o=>o.url===r);return a?(e.progressCallback?.({loaded:a.size,total:a.size}),a):this.downloadModel(r,e)}async clear(){await this.cacheManager.clear()}}const Ka=/^([a-zA-Z0-9_\-\.]+)\/([a-zA-Z0-9_\-\.]+)$/,Za="Hugging Face model ID is incorrect. Only regular alphanumeric characters, '-', '.' and '_' supported";class P extends Error{constructor(r,e="unknown_error"){super(r),this.type=e}}class fr extends Error{constructor(){super("Operation aborted"),this.name="AbortError"}}class Ya{constructor(r,e={}){if(this.proxy=null,this.useMultiThread=!1,this.nbThreads=1,this.useEmbeddings=!1,this.loadedContextInfo=null,this.bosToken=-1,this.eosToken=-1,this.eotToken=-1,this.eogTokens=new Set,this.addBosToken=!1,this.addEosToken=!1,this.samplingConfig={},this.hasEncoder=!1,this.decoderStartToken=-1,this.nCachedTokens=0,La(),!r)throw new P("AssetsPathConfig is required");this.pathConfig=r,this.config=e,this.cacheManager=e.cacheManager??new pn,this.modelManager=e.modelManager??new be({cacheManager:this.cacheManager,logger:e.logger??console,parallelDownloads:e.parallelDownloads,allowOffline:e.allowOffline})}logger(){return this.config.logger??console}checkModelLoaded(){if(!this.isModelLoaded())throw new P("loadModel() is not yet called","model_not_loaded")}static getLibllamaVersion(){return Oa}isModelLoaded(){return!!this.proxy&&!!this.metadata}getBOS(){return this.bosToken}getEOS(){return this.eosToken}getEOT(){return this.eotToken}isTokenEOG(r){return r===this.eosToken||r===this.eotToken||this.eogTokens.has(r)}getDecoderStartToken(){return this.decoderStartToken}getModelMetadata(){return this.checkModelLoaded(),this.metadata}isMultithread(){return this.checkModelLoaded(),this.useMultiThread}getNumThreads(){return this.checkModelLoaded(),this.useMultiThread?this.nbThreads:1}isEncoderDecoderArchitecture(){return this.checkModelLoaded(),this.hasEncoder}mustAddBosToken(){return this.checkModelLoaded(),this.addBosToken}mustAddEosToken(){return this.checkModelLoaded(),this.addEosToken}getChatTemplate(){return this.checkModelLoaded(),this.chatTemplate??null}async loadModelFromUrl(r,e={}){const n=un(r)?r:r[0],s=await(e.useCache??!0?await this.modelManager.getModelOrDownload(n,e):await this.modelManager.downloadModel(n,e)).open();return await this.loadModel(s,e)}async loadModelFromHF(r,e,n={}){if(!r.match(Ka))throw new P(Za,"download_error");if(!fn(e))throw new P("Only GGUF file is supported","download_error");return await this.loadModelFromUrl(`https://huggingface.co/${r}/resolve/main/${e}`,n)}async loadModel(r,e={}){const n=r instanceof Dt?await r.open():[...r];if(n.some(u=>u.size===0))throw new P("Input model (or splits) must be non-empty Blob or File","load_error");if(Na(n),this.proxy)throw new P("Module is already initialized","load_error");const a=await Ia();a||this.logger().warn("Multi-threads are not supported in this environment, falling back to single-thread");const o=!!this.pathConfig["multi-thread/wllama.wasm"];o||this.logger().warn('Missing paths to "multi-thread/wllama.wasm", falling back to single-thread');const s=Math.floor((navigator.hardwareConcurrency||1)/2),i=e.n_threads??s;this.nbThreads=i,this.useMultiThread=a&&o&&i>1;const c=this.useMultiThread?{"wllama.wasm":dr(this.pathConfig["multi-thread/wllama.wasm"])}:{"wllama.wasm":dr(this.pathConfig["single-thread/wllama.wasm"])};this.proxy=new Ga(c,this.useMultiThread?i:1,this.config.suppressNativeLog??!1,this.logger());const l=n.map((u,h)=>({name:`model-${h}.gguf`,blob:u}));await this.proxy.moduleInit(l);const d=await this.proxy.wllamaStart();if(!d.success)throw new P(`Error while calling start function, result = ${d}`);const p=await this.proxy.wllamaAction("load",{_name:"load_req",use_mmap:!0,use_mlock:!0,n_gpu_layers:0,seed:e.seed||Math.floor(Math.random()*1e5),n_ctx:e.n_ctx||1024,n_threads:this.useMultiThread?i:1,n_ctx_auto:!1,model_paths:l.map(u=>`models/${u.name}`),embeddings:e.embeddings,offload_kqv:e.offload_kqv,n_batch:e.n_batch,pooling_type:e.pooling_type,rope_scaling_type:e.rope_scaling_type,rope_freq_base:e.rope_freq_base,rope_freq_scale:e.rope_freq_scale,yarn_ext_factor:e.yarn_ext_factor,yarn_attn_factor:e.yarn_attn_factor,yarn_beta_fast:e.yarn_beta_fast,yarn_beta_slow:e.yarn_beta_slow,yarn_orig_ctx:e.yarn_orig_ctx,cache_type_k:e.cache_type_k,cache_type_v:e.cache_type_v,n_seq_max:1,flash_attn:e.flash_attn,swa_full:!0}),f={...p,metadata:{}};for(let u=0;u<p.metadata_key.length;u++)f.metadata[p.metadata_key[u]]=p.metadata_val[u];this.bosToken=f.token_bos,this.eosToken=f.token_eos,this.eotToken=f.token_eot,this.useEmbeddings=!!e.embeddings,this.metadata={hparams:{nVocab:f.n_vocab,nCtxTrain:f.n_ctx_train,nEmbd:f.n_embd,nLayer:f.n_layer},meta:f.metadata},this.hasEncoder=!!f.has_encoder,this.decoderStartToken=f.token_decoder_start,this.addBosToken=f.add_bos_token,this.addEosToken=f.add_eos_token,this.chatTemplate=f.metadata["tokenizer.chat_template"],this.loadedContextInfo=f,this.eogTokens=new Set(f.list_tokens_eog),this.logger().debug({loadedCtxInfo:f})}getLoadedContextInfo(){if(this.checkModelLoaded(),!this.loadedContextInfo)throw new P("Loaded context info is not available");return{...this.loadedContextInfo}}async createEmbedding(r,e={}){this.checkModelLoaded();const n={skipBOS:!1,skipEOS:!1,...e};await this.samplingInit(this.samplingConfig),await this.kvClear();const a=await this.tokenize(r);return this.bosToken&&!n.skipBOS&&a.unshift(this.bosToken),this.eosToken&&!n.skipEOS&&a.push(this.eosToken),await this.embeddings(a)}async createChatCompletion(r,e){const n=await this.formatChat(r,!0);return e.stream?await this.createCompletionGenerator(n,e):await this.createCompletion(n,{...e,stream:!1})}async createCompletion(r,e){return e.stream?await this.createCompletionGenerator(r,e):await this.createCompletionImpl(r,{...e,stream:!1})}async createCompletionImpl(r,e){this.checkModelLoaded(),this.samplingConfig=e.sampling??{},await this.samplingInit(this.samplingConfig);const n=new Set(e.stopTokens??[]);let a=await this.tokenize(r,!0);this.addBosToken&&a[0]!==this.bosToken&&a.unshift(this.bosToken),e.useCache?a=await this.computeNonCachedTokens(a):await this.kvClear(),await this.samplingAccept(a),this.isEncoderDecoderArchitecture()?(await this.encode(a),await this.decode([this.getDecoderStartToken()],{})):await this.decode(a,{});let o=new Uint8Array,s=!1;const i=()=>{s=!0};for(let c=0;c<(e.nPredict??1/0);c++){const l=await this.samplingSample();if(this.isTokenEOG(l.token)||n.has(l.token)||(o=Pa([o,l.piece]),e.onNewToken&&e.onNewToken(l.token,l.piece,_t(o),{abortSignal:i}),s||e.abortSignal?.aborted))break;await this.samplingAccept([l.token]),await this.decode([l.token],{})}return _t(o)}createCompletionGenerator(r,e){return new Promise((n,a)=>{const o=Ba(s=>{this.createCompletionImpl(r,{...e,onNewToken:(i,c,l)=>{s({token:i,piece:c,currentText:l},!1)}}).catch(a).then(()=>{s(void 0,!0)})});n(o())})}async samplingInit(r,e=[]){this.checkModelLoaded(),this.samplingConfig=r;const n=r.logit_bias??[],a=n.map(i=>i.token),o=n.map(i=>i.bias);if(!(await this.proxy.wllamaAction("sampling_init",{_name:"sint_req",...r,logit_bias_toks:a,logit_bias_vals:o,tokens:e})).success)throw new P("Failed to initialize sampling")}async getVocab(){return this.checkModelLoaded(),(await this.proxy.wllamaAction("get_vocab",{_name:"gvoc_req"})).vocab}async lookupToken(r){this.checkModelLoaded();const e=await this.proxy.wllamaAction("lookup_token",{_name:"lkup_req",piece:r});return e.success?e.token:-1}async tokenize(r,e=!0){return this.checkModelLoaded(),(await this.proxy.wllamaAction("tokenize",{_name:"tokn_req",text:r,special:!!e})).tokens}async detokenize(r,e=!1){this.checkModelLoaded();const n=await this.proxy.wllamaAction("detokenize",{_name:"dtkn_req",tokens:r});return e?_t(n.buffer):n.buffer}async decode(r,e){if(this.checkModelLoaded(),this.useEmbeddings)throw new P("embeddings is enabled. Use wllama.setOptions({ embeddings: false }) to disable it.");if(r.length===0)return{nPast:this.nCachedTokens};if(this.nCachedTokens+r.length>this.loadedContextInfo.n_ctx)throw new P("Running out of context cache. Please increase n_ctx when loading the model","kv_cache_full");const n=this.breakTokensIntoBatches(r,this.loadedContextInfo.n_batch);let a;for(let o=0;o<n.length;o++){if(e?.abortSignal?.aborted)throw new fr;const s=n.length>1&&o<n.length-1;if(a=await this.proxy.wllamaAction("decode",{_name:"deco_req",tokens:n[o],skip_logits:e.skipLogits||s}),a.error)throw new P(a.error);if(!a.success)throw new P("Cannot encode, unknown error")}return this.nCachedTokens=a.n_past,{nPast:a.n_past}}async encode(r,e){if(this.checkModelLoaded(),!this.hasEncoder)throw new P("This model does not use encoder-decoder architecture.","inference_error");if(this.useEmbeddings)throw new P("embeddings is enabled. Use wllama.setOptions({ embeddings: false }) to disable it.","inference_error");if(r.length===0)return{nPast:this.nCachedTokens};if(this.nCachedTokens+r.length>this.loadedContextInfo.n_ctx)throw new P("Running out of context cache. Please increase n_ctx when loading the model","kv_cache_full");const n=this.breakTokensIntoBatches(r,this.loadedContextInfo.n_batch);let a;for(let o=0;o<n.length;o++){if(e?.abortSignal?.aborted)throw new fr;if(a=await this.proxy.wllamaAction("encode",{_name:"enco_req",tokens:n[o]}),a.error)throw new P(a.error);if(!a.success)throw new P("Cannot encode, unknown error")}return this.nCachedTokens=a.n_past,{nPast:a.n_past}}breakTokensIntoBatches(r,e){const n=[];for(let a=0;a<r.length;a+=e)n.push(r.slice(a,a+e));return n}async samplingSample(){this.checkModelLoaded();const r=await this.proxy.wllamaAction("sampling_sample",{_name:"ssam_req"});return{piece:r.piece,token:r.token}}async samplingAccept(r){if(this.checkModelLoaded(),!(await this.proxy.wllamaAction("sampling_accept",{_name:"sacc_req",tokens:r})).success)throw new P("samplingAccept unknown error")}async getLogits(r=40){this.checkModelLoaded();const e=await this.proxy.wllamaAction("get_logits",{_name:"glog_req",top_k:r}),n=[];for(let a=0;a<e.tokens.length;a++)n.push({token:e.tokens[a],p:e.probs[a]});return n}async embeddings(r){if(this.checkModelLoaded(),!this.useEmbeddings)throw new P("embeddings is disabled. Use wllama.setOptions({ embeddings: true }) to enable it.","inference_error");if(this.nCachedTokens>0&&this.logger().warn("Embeddings: KV cache is not empty, this may produce incorrect results"),this.nCachedTokens+r.length>this.loadedContextInfo.n_ctx)throw new P("Running out of context cache. Please increase n_ctx when loading the model","kv_cache_full");if(r.length>this.loadedContextInfo.n_batch)throw new P("Embedding tokens does not fit into batch. Please increase n_batch when loading the model","inference_error");if(r.length>this.loadedContextInfo.n_ubatch)throw new P("Embedding tokens does not fit into physical batch. Please increase n_ubatch when loading the model","inference_error");const e=await this.proxy.wllamaAction("embeddings",{_name:"gemb_req",tokens:r});if(e.success)return e.embeddings;throw new P("embeddings unknown error")}async kvRemove(r,e){if(this.checkModelLoaded(),e===0)return;if(!(await this.proxy.wllamaAction("kv_remove",{_name:"kvcr_req",n_keep:r,n_discard:e})).success)throw new P("kvRemove unknown error");e<0?this.nCachedTokens=r:this.nCachedTokens-=e}async kvClear(){if(this.checkModelLoaded(),!(await this.proxy.wllamaAction("kv_clear",{_name:"kvcc_req"})).success)throw new P("kvClear unknown error");this.nCachedTokens=0}async formatChat(r,e,n){this.checkModelLoaded();const a=r.map(i=>i.role),o=r.map(i=>i.content),s=await this.proxy.wllamaAction("chat_format",{_name:"cfmt_req",roles:a,contents:o,tmpl:n,add_ass:e});if(!s.success)throw new P("formatChat unknown error");return s.formatted_chat}async setOptions(r){this.checkModelLoaded(),await this.proxy.wllamaAction("set_options",{_name:"opti_req",...r}),this.useEmbeddings=r.embeddings}async exit(){await this.proxy?.wllamaExit(),this.proxy=null}async _getDebugInfo(){return this.checkModelLoaded(),await this.proxy.wllamaDebug()}async _testBenchmark(r,e){return this.checkModelLoaded(),await this.proxy.wllamaAction("test_benchmark",{_name:"tben_req",type:r,n_samples:e})}async _testPerplexity(r){return this.checkModelLoaded(),await this.proxy.wllamaAction("test_perplexity",{_name:"tper_req",tokens:r})}async getCachedTokens(){return this.checkModelLoaded(),(await this.proxy.wllamaAction("current_status",{_name:"stat_req"})).tokens}async computeNonCachedTokens(r){const e=await this.getCachedTokens();let n=0;for(;n<Math.min(e.length,r.length)&&e[n]===r[n];n++);this.logger().debug(`Cache nKeep=${n}`);try{return await this.kvRemove(n,-1),r.slice(n,r.length)}catch{return this.logger().warn("Failed to rollback KV cache, clearing it instead"),await this.kvClear(),r}}}const it=[{id:"smollm2-135m",name:"SmolLM2-135M",size:"~150MB",repo:"unsloth/SmolLM2-135M-Instruct-GGUF",file:"SmolLM2-135M-Instruct-Q8_0.gguf",description:"Fastest, most sloppy output"},{id:"smollm2-360m",name:"SmolLM2-360M",size:"~380MB",repo:"unsloth/SmolLM2-360M-Instruct-GGUF",file:"SmolLM2-360M-Instruct-Q8_0.gguf",description:"Better quality, still fast"},{id:"qwen2.5-0.5b",name:"Qwen2.5-0.5B",size:"~530MB",repo:"Qwen/Qwen2.5-0.5B-Instruct-GGUF",file:"qwen2.5-0.5b-instruct-q8_0.gguf",description:"Good quality/speed balance"},{id:"smollm2-1.7b",name:"SmolLM2-1.7B",size:"~1.8GB",repo:"unsloth/SmolLM2-1.7B-Instruct-GGUF",file:"SmolLM2-1.7B-Instruct-Q8_0.gguf",description:"Best quality, slower"}];class Xa{wllama=null;topK;tokenCache=new Map;isLoaded=!1;modelConfig;lastContext="";lastTokens=[];constructor(r=64,e){this.topK=r,this.modelConfig=e||it[0]}get currentModel(){return this.modelConfig}createWllamaInstance(){return new Ya({"single-thread/wllama.wasm":"https://cdn.jsdelivr.net/npm/@wllama/wllama@2.3.7/esm/single-thread/wllama.wasm","multi-thread/wllama.wasm":"https://cdn.jsdelivr.net/npm/@wllama/wllama@2.3.7/esm/multi-thread/wllama.wasm"})}async loadModel(r){if(!(this.isLoaded&&this.wllama)){try{this.wllama=this.createWllamaInstance(),await this.loadModelWithOptions(r,!0),this.isLoaded=!0;return}catch(e){if(console.warn("Cached model load failed, retrying without cache:",e),this.wllama){try{await this.wllama.exit()}catch{}this.wllama=null}}this.wllama=this.createWllamaInstance(),await this.loadModelWithOptions(r,!1),this.isLoaded=!0}}async loadModelWithOptions(r,e=!0){if(!this.wllama)throw new Error("Wllama not initialized");const n=Math.min(navigator.hardwareConcurrency||4,4);await this.wllama.loadModelFromHF(this.modelConfig.repo,this.modelConfig.file,{n_threads:n,useCache:e,progressCallback:a=>{r&&a.total>0&&r(a.loaded/a.total)}})}get loaded(){return this.isLoaded}async getTokenDistribution(r){if(!this.wllama||!this.isLoaded)throw new Error("Model not loaded. Call loadModel() first.");const e=await this.wllama.tokenize(r);if(e.length===0)return[];let n=!1;if(r.startsWith(this.lastContext)&&this.lastContext.length>0&&this.lastTokens.length>0&&e.length>=this.lastTokens.length){n=!0;for(let s=0;s<this.lastTokens.length;s++)if(e[s]!==this.lastTokens[s]){n=!1;break}}if(n){const s=e.slice(this.lastTokens.length);s.length>0&&await this.wllama.decode(s,{})}else await this.wllama.samplingInit({}),await this.wllama.kvClear(),await this.wllama.decode(e,{});this.lastContext=r,this.lastTokens=e;const a=await this.wllama.getLogits(this.topK),o=[];for(const s of a){const i=s.token,c=s.p;let l=this.tokenCache.get(i);l===void 0&&(l=await this.wllama.detokenize([i],!0),this.tokenCache.set(i,l)),l&&o.push({token:l,prob:c})}return o.sort((s,i)=>i.prob!==s.prob?i.prob-s.prob:s.token.localeCompare(i.token)),o}resetContext(){this.lastContext="",this.lastTokens=[]}async close(){this.wllama&&(await this.wllama.exit(),this.wllama=null,this.isLoaded=!1,this.tokenCache.clear(),this.resetContext())}}function Ja(t){const r=t.length;let e=0,n=0;for(;n<r;){let a=t.charCodeAt(n++);if((a&4294967168)===0){e++;continue}else if((a&4294965248)===0)e+=2;else{if(a>=55296&&a<=56319&&n<r){const o=t.charCodeAt(n);(o&64512)===56320&&(++n,a=((a&1023)<<10)+(o&1023)+65536)}(a&4294901760)===0?e+=3:e+=4}}return e}function Qa(t,r,e){const n=t.length;let a=e,o=0;for(;o<n;){let s=t.charCodeAt(o++);if((s&4294967168)===0){r[a++]=s;continue}else if((s&4294965248)===0)r[a++]=s>>6&31|192;else{if(s>=55296&&s<=56319&&o<n){const i=t.charCodeAt(o);(i&64512)===56320&&(++o,s=((s&1023)<<10)+(i&1023)+65536)}(s&4294901760)===0?(r[a++]=s>>12&15|224,r[a++]=s>>6&63|128):(r[a++]=s>>18&7|240,r[a++]=s>>12&63|128,r[a++]=s>>6&63|128)}r[a++]=s&63|128}}const eo=new TextEncoder,to=50;function ro(t,r,e){eo.encodeInto(t,r.subarray(e))}function no(t,r,e){t.length>to?ro(t,r,e):Qa(t,r,e)}const ao=4096;function _n(t,r,e){let n=r;const a=n+e,o=[];let s="";for(;n<a;){const i=t[n++];if((i&128)===0)o.push(i);else if((i&224)===192){const c=t[n++]&63;o.push((i&31)<<6|c)}else if((i&240)===224){const c=t[n++]&63,l=t[n++]&63;o.push((i&31)<<12|c<<6|l)}else if((i&248)===240){const c=t[n++]&63,l=t[n++]&63,d=t[n++]&63;let p=(i&7)<<18|c<<12|l<<6|d;p>65535&&(p-=65536,o.push(p>>>10&1023|55296),p=56320|p&1023),o.push(p)}else o.push(i);o.length>=ao&&(s+=String.fromCharCode(...o),o.length=0)}return o.length>0&&(s+=String.fromCharCode(...o)),s}const oo=new TextDecoder,so=200;function io(t,r,e){const n=t.subarray(r,r+e);return oo.decode(n)}function lo(t,r,e){return e>so?io(t,r,e):_n(t,r,e)}class Je{type;data;constructor(r,e){this.type=r,this.data=e}}class U extends Error{constructor(r){super(r);const e=Object.create(U.prototype);Object.setPrototypeOf(this,e),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:U.name})}}const Te=4294967295;function co(t,r,e){const n=e/4294967296,a=e;t.setUint32(r,n),t.setUint32(r+4,a)}function gn(t,r,e){const n=Math.floor(e/4294967296),a=e;t.setUint32(r,n),t.setUint32(r+4,a)}function wn(t,r){const e=t.getInt32(r),n=t.getUint32(r+4);return e*4294967296+n}function uo(t,r){const e=t.getUint32(r),n=t.getUint32(r+4);return e*4294967296+n}const fo=-1,ho=4294967296-1,mo=17179869184-1;function po({sec:t,nsec:r}){if(t>=0&&r>=0&&t<=mo)if(r===0&&t<=ho){const e=new Uint8Array(4);return new DataView(e.buffer).setUint32(0,t),e}else{const e=t/4294967296,n=t&4294967295,a=new Uint8Array(8),o=new DataView(a.buffer);return o.setUint32(0,r<<2|e&3),o.setUint32(4,n),a}else{const e=new Uint8Array(12),n=new DataView(e.buffer);return n.setUint32(0,r),gn(n,4,t),e}}function _o(t){const r=t.getTime(),e=Math.floor(r/1e3),n=(r-e*1e3)*1e6,a=Math.floor(n/1e9);return{sec:e+a,nsec:n-a*1e9}}function go(t){if(t instanceof Date){const r=_o(t);return po(r)}else return null}function wo(t){const r=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:r.getUint32(0),nsec:0};case 8:{const e=r.getUint32(0),n=r.getUint32(4),a=(e&3)*4294967296+n,o=e>>>2;return{sec:a,nsec:o}}case 12:{const e=wn(r,4),n=r.getUint32(0);return{sec:e,nsec:n}}default:throw new U(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${t.length}`)}}function yo(t){const r=wo(t);return new Date(r.sec*1e3+r.nsec/1e6)}const vo={type:fo,encode:go,decode:yo};class ut{static defaultCodec=new ut;__brand;builtInEncoders=[];builtInDecoders=[];encoders=[];decoders=[];constructor(){this.register(vo)}register({type:r,encode:e,decode:n}){if(r>=0)this.encoders[r]=e,this.decoders[r]=n;else{const a=-1-r;this.builtInEncoders[a]=e,this.builtInDecoders[a]=n}}tryToEncode(r,e){for(let n=0;n<this.builtInEncoders.length;n++){const a=this.builtInEncoders[n];if(a!=null){const o=a(r,e);if(o!=null){const s=-1-n;return new Je(s,o)}}}for(let n=0;n<this.encoders.length;n++){const a=this.encoders[n];if(a!=null){const o=a(r,e);if(o!=null){const s=n;return new Je(s,o)}}}return r instanceof Je?r:null}decode(r,e,n){const a=e<0?this.builtInDecoders[-1-e]:this.decoders[e];return a?a(r,e,n):new Je(e,r)}}function So(t){return t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}function Lt(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):So(t)?new Uint8Array(t):Uint8Array.from(t)}const bo=100,Eo=2048;class Yt{extensionCodec;context;useBigInt64;maxDepth;initialBufferSize;sortKeys;forceFloat32;ignoreUndefined;forceIntegerToFloat;pos;view;bytes;entered=!1;constructor(r){this.extensionCodec=r?.extensionCodec??ut.defaultCodec,this.context=r?.context,this.useBigInt64=r?.useBigInt64??!1,this.maxDepth=r?.maxDepth??bo,this.initialBufferSize=r?.initialBufferSize??Eo,this.sortKeys=r?.sortKeys??!1,this.forceFloat32=r?.forceFloat32??!1,this.ignoreUndefined=r?.ignoreUndefined??!1,this.forceIntegerToFloat=r?.forceIntegerToFloat??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new Yt({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(r){if(this.entered)return this.clone().encodeSharedRef(r);try{return this.entered=!0,this.reinitializeState(),this.doEncode(r,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(r){if(this.entered)return this.clone().encode(r);try{return this.entered=!0,this.reinitializeState(),this.doEncode(r,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(r,e){if(e>this.maxDepth)throw new Error(`Too deep objects in depth ${e}`);r==null?this.encodeNil():typeof r=="boolean"?this.encodeBoolean(r):typeof r=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(r):this.encodeNumber(r):typeof r=="string"?this.encodeString(r):this.useBigInt64&&typeof r=="bigint"?this.encodeBigInt64(r):this.encodeObject(r,e)}ensureBufferSizeToWrite(r){const e=this.pos+r;this.view.byteLength<e&&this.resizeBuffer(e*2)}resizeBuffer(r){const e=new ArrayBuffer(r),n=new Uint8Array(e),a=new DataView(e);n.set(this.bytes),this.view=a,this.bytes=n}encodeNil(){this.writeU8(192)}encodeBoolean(r){r===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(r){!this.forceIntegerToFloat&&Number.isSafeInteger(r)?r>=0?r<128?this.writeU8(r):r<256?(this.writeU8(204),this.writeU8(r)):r<65536?(this.writeU8(205),this.writeU16(r)):r<4294967296?(this.writeU8(206),this.writeU32(r)):this.useBigInt64?this.encodeNumberAsFloat(r):(this.writeU8(207),this.writeU64(r)):r>=-32?this.writeU8(224|r+32):r>=-128?(this.writeU8(208),this.writeI8(r)):r>=-32768?(this.writeU8(209),this.writeI16(r)):r>=-2147483648?(this.writeU8(210),this.writeI32(r)):this.useBigInt64?this.encodeNumberAsFloat(r):(this.writeU8(211),this.writeI64(r)):this.encodeNumberAsFloat(r)}encodeNumberAsFloat(r){this.forceFloat32?(this.writeU8(202),this.writeF32(r)):(this.writeU8(203),this.writeF64(r))}encodeBigInt64(r){r>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(r)):(this.writeU8(211),this.writeBigInt64(r))}writeStringHeader(r){if(r<32)this.writeU8(160+r);else if(r<256)this.writeU8(217),this.writeU8(r);else if(r<65536)this.writeU8(218),this.writeU16(r);else if(r<4294967296)this.writeU8(219),this.writeU32(r);else throw new Error(`Too long string: ${r} bytes in UTF-8`)}encodeString(r){const n=Ja(r);this.ensureBufferSizeToWrite(5+n),this.writeStringHeader(n),no(r,this.bytes,this.pos),this.pos+=n}encodeObject(r,e){const n=this.extensionCodec.tryToEncode(r,this.context);if(n!=null)this.encodeExtension(n);else if(Array.isArray(r))this.encodeArray(r,e);else if(ArrayBuffer.isView(r))this.encodeBinary(r);else if(typeof r=="object")this.encodeMap(r,e);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(r)}`)}encodeBinary(r){const e=r.byteLength;if(e<256)this.writeU8(196),this.writeU8(e);else if(e<65536)this.writeU8(197),this.writeU16(e);else if(e<4294967296)this.writeU8(198),this.writeU32(e);else throw new Error(`Too large binary: ${e}`);const n=Lt(r);this.writeU8a(n)}encodeArray(r,e){const n=r.length;if(n<16)this.writeU8(144+n);else if(n<65536)this.writeU8(220),this.writeU16(n);else if(n<4294967296)this.writeU8(221),this.writeU32(n);else throw new Error(`Too large array: ${n}`);for(const a of r)this.doEncode(a,e+1)}countWithoutUndefined(r,e){let n=0;for(const a of e)r[a]!==void 0&&n++;return n}encodeMap(r,e){const n=Object.keys(r);this.sortKeys&&n.sort();const a=this.ignoreUndefined?this.countWithoutUndefined(r,n):n.length;if(a<16)this.writeU8(128+a);else if(a<65536)this.writeU8(222),this.writeU16(a);else if(a<4294967296)this.writeU8(223),this.writeU32(a);else throw new Error(`Too large map object: ${a}`);for(const o of n){const s=r[o];this.ignoreUndefined&&s===void 0||(this.encodeString(o),this.doEncode(s,e+1))}}encodeExtension(r){if(typeof r.data=="function"){const n=r.data(this.pos+6),a=n.length;if(a>=4294967296)throw new Error(`Too large extension object: ${a}`);this.writeU8(201),this.writeU32(a),this.writeI8(r.type),this.writeU8a(n);return}const e=r.data.length;if(e===1)this.writeU8(212);else if(e===2)this.writeU8(213);else if(e===4)this.writeU8(214);else if(e===8)this.writeU8(215);else if(e===16)this.writeU8(216);else if(e<256)this.writeU8(199),this.writeU8(e);else if(e<65536)this.writeU8(200),this.writeU16(e);else if(e<4294967296)this.writeU8(201),this.writeU32(e);else throw new Error(`Too large extension object: ${e}`);this.writeI8(r.type),this.writeU8a(r.data)}writeU8(r){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,r),this.pos++}writeU8a(r){const e=r.length;this.ensureBufferSizeToWrite(e),this.bytes.set(r,this.pos),this.pos+=e}writeI8(r){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,r),this.pos++}writeU16(r){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,r),this.pos+=2}writeI16(r){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,r),this.pos+=2}writeU32(r){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,r),this.pos+=4}writeI32(r){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,r),this.pos+=4}writeF32(r){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,r),this.pos+=4}writeF64(r){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,r),this.pos+=8}writeU64(r){this.ensureBufferSizeToWrite(8),co(this.view,this.pos,r),this.pos+=8}writeI64(r){this.ensureBufferSizeToWrite(8),gn(this.view,this.pos,r),this.pos+=8}writeBigUint64(r){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,r),this.pos+=8}writeBigInt64(r){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,r),this.pos+=8}}function ko(t,r){return new Yt(r).encodeSharedRef(t)}function wt(t){return`${t<0?"-":""}0x${Math.abs(t).toString(16).padStart(2,"0")}`}const Fo=16,Mo=16;class xo{hit=0;miss=0;caches;maxKeyLength;maxLengthPerKey;constructor(r=Fo,e=Mo){this.maxKeyLength=r,this.maxLengthPerKey=e,this.caches=[];for(let n=0;n<this.maxKeyLength;n++)this.caches.push([])}canBeCached(r){return r>0&&r<=this.maxKeyLength}find(r,e,n){const a=this.caches[n-1];e:for(const o of a){const s=o.bytes;for(let i=0;i<n;i++)if(s[i]!==r[e+i])continue e;return o.str}return null}store(r,e){const n=this.caches[r.length-1],a={bytes:r,str:e};n.length>=this.maxLengthPerKey?n[Math.random()*n.length|0]=a:n.push(a)}decode(r,e,n){const a=this.find(r,e,n);if(a!=null)return this.hit++,a;this.miss++;const o=_n(r,e,n),s=Uint8Array.prototype.slice.call(r,e,e+n);return this.store(s,o),o}}const zt="array",De="map_key",yn="map_value",Ao=t=>{if(typeof t=="string"||typeof t=="number")return t;throw new U("The type of key must be string or number but "+typeof t)};class To{stack=[];stackHeadPosition=-1;get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(r){const e=this.getUninitializedStateFromPool();e.type=zt,e.position=0,e.size=r,e.array=new Array(r)}pushMapState(r){const e=this.getUninitializedStateFromPool();e.type=De,e.readCount=0,e.size=r,e.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){const r={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(r)}return this.stack[this.stackHeadPosition]}release(r){if(this.stack[this.stackHeadPosition]!==r)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(r.type===zt){const n=r;n.size=0,n.array=void 0,n.position=0,n.type=void 0}if(r.type===De||r.type===yn){const n=r;n.size=0,n.map=void 0,n.readCount=0,n.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}const Pe=-1,Xt=new DataView(new ArrayBuffer(0)),Po=new Uint8Array(Xt.buffer);try{Xt.getInt8(0)}catch(t){if(!(t instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}const hr=new RangeError("Insufficient data"),Ro=new xo;class Jt{extensionCodec;context;useBigInt64;rawStrings;maxStrLength;maxBinLength;maxArrayLength;maxMapLength;maxExtLength;keyDecoder;mapKeyConverter;totalPos=0;pos=0;view=Xt;bytes=Po;headByte=Pe;stack=new To;entered=!1;constructor(r){this.extensionCodec=r?.extensionCodec??ut.defaultCodec,this.context=r?.context,this.useBigInt64=r?.useBigInt64??!1,this.rawStrings=r?.rawStrings??!1,this.maxStrLength=r?.maxStrLength??Te,this.maxBinLength=r?.maxBinLength??Te,this.maxArrayLength=r?.maxArrayLength??Te,this.maxMapLength=r?.maxMapLength??Te,this.maxExtLength=r?.maxExtLength??Te,this.keyDecoder=r?.keyDecoder!==void 0?r.keyDecoder:Ro,this.mapKeyConverter=r?.mapKeyConverter??Ao}clone(){return new Jt({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=Pe,this.stack.reset()}setBuffer(r){const e=Lt(r);this.bytes=e,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.pos=0}appendBuffer(r){if(this.headByte===Pe&&!this.hasRemaining(1))this.setBuffer(r);else{const e=this.bytes.subarray(this.pos),n=Lt(r),a=new Uint8Array(e.length+n.length);a.set(e),a.set(n,e.length),this.setBuffer(a)}}hasRemaining(r){return this.view.byteLength-this.pos>=r}createExtraByteError(r){const{view:e,pos:n}=this;return new RangeError(`Extra ${e.byteLength-n} of ${e.byteLength} byte(s) found at buffer[${r}]`)}decode(r){if(this.entered)return this.clone().decode(r);try{this.entered=!0,this.reinitializeState(),this.setBuffer(r);const e=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return e}finally{this.entered=!1}}*decodeMulti(r){if(this.entered){yield*this.clone().decodeMulti(r);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(r);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(r){if(this.entered)return this.clone().decodeAsync(r);try{this.entered=!0;let e=!1,n;for await(const i of r){if(e)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(i);try{n=this.doDecodeSync(),e=!0}catch(c){if(!(c instanceof RangeError))throw c}this.totalPos+=this.pos}if(e){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return n}const{headByte:a,pos:o,totalPos:s}=this;throw new RangeError(`Insufficient data in parsing ${wt(a)} at ${s} (${o} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(r){return this.decodeMultiAsync(r,!0)}decodeStream(r){return this.decodeMultiAsync(r,!1)}async*decodeMultiAsync(r,e){if(this.entered){yield*this.clone().decodeMultiAsync(r,e);return}try{this.entered=!0;let n=e,a=-1;for await(const o of r){if(e&&a===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(o),n&&(a=this.readArraySize(),n=!1,this.complete());try{for(;yield this.doDecodeSync(),--a!==0;);}catch(s){if(!(s instanceof RangeError))throw s}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){e:for(;;){const r=this.readHeadByte();let e;if(r>=224)e=r-256;else if(r<192)if(r<128)e=r;else if(r<144){const a=r-128;if(a!==0){this.pushMapState(a),this.complete();continue e}else e={}}else if(r<160){const a=r-144;if(a!==0){this.pushArrayState(a),this.complete();continue e}else e=[]}else{const a=r-160;e=this.decodeString(a,0)}else if(r===192)e=null;else if(r===194)e=!1;else if(r===195)e=!0;else if(r===202)e=this.readF32();else if(r===203)e=this.readF64();else if(r===204)e=this.readU8();else if(r===205)e=this.readU16();else if(r===206)e=this.readU32();else if(r===207)this.useBigInt64?e=this.readU64AsBigInt():e=this.readU64();else if(r===208)e=this.readI8();else if(r===209)e=this.readI16();else if(r===210)e=this.readI32();else if(r===211)this.useBigInt64?e=this.readI64AsBigInt():e=this.readI64();else if(r===217){const a=this.lookU8();e=this.decodeString(a,1)}else if(r===218){const a=this.lookU16();e=this.decodeString(a,2)}else if(r===219){const a=this.lookU32();e=this.decodeString(a,4)}else if(r===220){const a=this.readU16();if(a!==0){this.pushArrayState(a),this.complete();continue e}else e=[]}else if(r===221){const a=this.readU32();if(a!==0){this.pushArrayState(a),this.complete();continue e}else e=[]}else if(r===222){const a=this.readU16();if(a!==0){this.pushMapState(a),this.complete();continue e}else e={}}else if(r===223){const a=this.readU32();if(a!==0){this.pushMapState(a),this.complete();continue e}else e={}}else if(r===196){const a=this.lookU8();e=this.decodeBinary(a,1)}else if(r===197){const a=this.lookU16();e=this.decodeBinary(a,2)}else if(r===198){const a=this.lookU32();e=this.decodeBinary(a,4)}else if(r===212)e=this.decodeExtension(1,0);else if(r===213)e=this.decodeExtension(2,0);else if(r===214)e=this.decodeExtension(4,0);else if(r===215)e=this.decodeExtension(8,0);else if(r===216)e=this.decodeExtension(16,0);else if(r===199){const a=this.lookU8();e=this.decodeExtension(a,1)}else if(r===200){const a=this.lookU16();e=this.decodeExtension(a,2)}else if(r===201){const a=this.lookU32();e=this.decodeExtension(a,4)}else throw new U(`Unrecognized type byte: ${wt(r)}`);this.complete();const n=this.stack;for(;n.length>0;){const a=n.top();if(a.type===zt)if(a.array[a.position]=e,a.position++,a.position===a.size)e=a.array,n.release(a);else continue e;else if(a.type===De){if(e==="__proto__")throw new U("The key __proto__ is not allowed");a.key=this.mapKeyConverter(e),a.type=yn;continue e}else if(a.map[a.key]=e,a.readCount++,a.readCount===a.size)e=a.map,n.release(a);else{a.key=null,a.type=De;continue e}}return e}}readHeadByte(){return this.headByte===Pe&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=Pe}readArraySize(){const r=this.readHeadByte();switch(r){case 220:return this.readU16();case 221:return this.readU32();default:{if(r<160)return r-144;throw new U(`Unrecognized array type byte: ${wt(r)}`)}}}pushMapState(r){if(r>this.maxMapLength)throw new U(`Max length exceeded: map length (${r}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(r)}pushArrayState(r){if(r>this.maxArrayLength)throw new U(`Max length exceeded: array length (${r}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(r)}decodeString(r,e){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(r,e):this.decodeBinary(r,e)}decodeUtf8String(r,e){if(r>this.maxStrLength)throw new U(`Max length exceeded: UTF-8 byte length (${r}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+e+r)throw hr;const n=this.pos+e;let a;return this.stateIsMapKey()&&this.keyDecoder?.canBeCached(r)?a=this.keyDecoder.decode(this.bytes,n,r):a=lo(this.bytes,n,r),this.pos+=e+r,a}stateIsMapKey(){return this.stack.length>0?this.stack.top().type===De:!1}decodeBinary(r,e){if(r>this.maxBinLength)throw new U(`Max length exceeded: bin length (${r}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(r+e))throw hr;const n=this.pos+e,a=this.bytes.subarray(n,n+r);return this.pos+=e+r,a}decodeExtension(r,e){if(r>this.maxExtLength)throw new U(`Max length exceeded: ext length (${r}) > maxExtLength (${this.maxExtLength})`);const n=this.view.getInt8(this.pos+e),a=this.decodeBinary(r,e+1);return this.extensionCodec.decode(a,n,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const r=this.view.getUint8(this.pos);return this.pos++,r}readI8(){const r=this.view.getInt8(this.pos);return this.pos++,r}readU16(){const r=this.view.getUint16(this.pos);return this.pos+=2,r}readI16(){const r=this.view.getInt16(this.pos);return this.pos+=2,r}readU32(){const r=this.view.getUint32(this.pos);return this.pos+=4,r}readI32(){const r=this.view.getInt32(this.pos);return this.pos+=4,r}readU64(){const r=uo(this.view,this.pos);return this.pos+=8,r}readI64(){const r=wn(this.view,this.pos);return this.pos+=8,r}readU64AsBigInt(){const r=this.view.getBigUint64(this.pos);return this.pos+=8,r}readI64AsBigInt(){const r=this.view.getBigInt64(this.pos);return this.pos+=8,r}readF32(){const r=this.view.getFloat32(this.pos);return this.pos+=4,r}readF64(){const r=this.view.getFloat64(this.pos);return this.pos+=8,r}}function No(t,r){return new Jt(r).decode(t)}/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const Io=4,mr=0,pr=1,Co=2;function Me(t){let r=t.length;for(;--r>=0;)t[r]=0}const Do=0,vn=1,Lo=2,zo=3,Bo=258,Qt=29,je=256,Oe=je+1+Qt,Ee=30,er=19,Sn=2*Oe+1,ie=15,yt=16,Oo=7,tr=256,bn=16,En=17,kn=18,Bt=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),ot=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Uo=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Fn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ho=512,Q=new Array((Oe+2)*2);Me(Q);const Le=new Array(Ee*2);Me(Le);const Ue=new Array(Ho);Me(Ue);const He=new Array(Bo-zo+1);Me(He);const rr=new Array(Qt);Me(rr);const lt=new Array(Ee);Me(lt);function vt(t,r,e,n,a){this.static_tree=t,this.extra_bits=r,this.extra_base=e,this.elems=n,this.max_length=a,this.has_stree=t&&t.length}let Mn,xn,An;function St(t,r){this.dyn_tree=t,this.max_code=0,this.stat_desc=r}const Tn=t=>t<256?Ue[t]:Ue[256+(t>>>7)],We=(t,r)=>{t.pending_buf[t.pending++]=r&255,t.pending_buf[t.pending++]=r>>>8&255},B=(t,r,e)=>{t.bi_valid>yt-e?(t.bi_buf|=r<<t.bi_valid&65535,We(t,t.bi_buf),t.bi_buf=r>>yt-t.bi_valid,t.bi_valid+=e-yt):(t.bi_buf|=r<<t.bi_valid&65535,t.bi_valid+=e)},K=(t,r,e)=>{B(t,e[r*2],e[r*2+1])},Pn=(t,r)=>{let e=0;do e|=t&1,t>>>=1,e<<=1;while(--r>0);return e>>>1},Wo=t=>{t.bi_valid===16?(We(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=t.bi_buf&255,t.bi_buf>>=8,t.bi_valid-=8)},Go=(t,r)=>{const e=r.dyn_tree,n=r.max_code,a=r.stat_desc.static_tree,o=r.stat_desc.has_stree,s=r.stat_desc.extra_bits,i=r.stat_desc.extra_base,c=r.stat_desc.max_length;let l,d,p,f,u,h,M=0;for(f=0;f<=ie;f++)t.bl_count[f]=0;for(e[t.heap[t.heap_max]*2+1]=0,l=t.heap_max+1;l<Sn;l++)d=t.heap[l],f=e[e[d*2+1]*2+1]+1,f>c&&(f=c,M++),e[d*2+1]=f,!(d>n)&&(t.bl_count[f]++,u=0,d>=i&&(u=s[d-i]),h=e[d*2],t.opt_len+=h*(f+u),o&&(t.static_len+=h*(a[d*2+1]+u)));if(M!==0){do{for(f=c-1;t.bl_count[f]===0;)f--;t.bl_count[f]--,t.bl_count[f+1]+=2,t.bl_count[c]--,M-=2}while(M>0);for(f=c;f!==0;f--)for(d=t.bl_count[f];d!==0;)p=t.heap[--l],!(p>n)&&(e[p*2+1]!==f&&(t.opt_len+=(f-e[p*2+1])*e[p*2],e[p*2+1]=f),d--)}},Rn=(t,r,e)=>{const n=new Array(ie+1);let a=0,o,s;for(o=1;o<=ie;o++)a=a+e[o-1]<<1,n[o]=a;for(s=0;s<=r;s++){let i=t[s*2+1];i!==0&&(t[s*2]=Pn(n[i]++,i))}},$o=()=>{let t,r,e,n,a;const o=new Array(ie+1);for(e=0,n=0;n<Qt-1;n++)for(rr[n]=e,t=0;t<1<<Bt[n];t++)He[e++]=n;for(He[e-1]=n,a=0,n=0;n<16;n++)for(lt[n]=a,t=0;t<1<<ot[n];t++)Ue[a++]=n;for(a>>=7;n<Ee;n++)for(lt[n]=a<<7,t=0;t<1<<ot[n]-7;t++)Ue[256+a++]=n;for(r=0;r<=ie;r++)o[r]=0;for(t=0;t<=143;)Q[t*2+1]=8,t++,o[8]++;for(;t<=255;)Q[t*2+1]=9,t++,o[9]++;for(;t<=279;)Q[t*2+1]=7,t++,o[7]++;for(;t<=287;)Q[t*2+1]=8,t++,o[8]++;for(Rn(Q,Oe+1,o),t=0;t<Ee;t++)Le[t*2+1]=5,Le[t*2]=Pn(t,5);Mn=new vt(Q,Bt,je+1,Oe,ie),xn=new vt(Le,ot,0,Ee,ie),An=new vt(new Array(0),Uo,0,er,Oo)},Nn=t=>{let r;for(r=0;r<Oe;r++)t.dyn_ltree[r*2]=0;for(r=0;r<Ee;r++)t.dyn_dtree[r*2]=0;for(r=0;r<er;r++)t.bl_tree[r*2]=0;t.dyn_ltree[tr*2]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},In=t=>{t.bi_valid>8?We(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},_r=(t,r,e,n)=>{const a=r*2,o=e*2;return t[a]<t[o]||t[a]===t[o]&&n[r]<=n[e]},bt=(t,r,e)=>{const n=t.heap[e];let a=e<<1;for(;a<=t.heap_len&&(a<t.heap_len&&_r(r,t.heap[a+1],t.heap[a],t.depth)&&a++,!_r(r,n,t.heap[a],t.depth));)t.heap[e]=t.heap[a],e=a,a<<=1;t.heap[e]=n},gr=(t,r,e)=>{let n,a,o=0,s,i;if(t.sym_next!==0)do n=t.pending_buf[t.sym_buf+o++]&255,n+=(t.pending_buf[t.sym_buf+o++]&255)<<8,a=t.pending_buf[t.sym_buf+o++],n===0?K(t,a,r):(s=He[a],K(t,s+je+1,r),i=Bt[s],i!==0&&(a-=rr[s],B(t,a,i)),n--,s=Tn(n),K(t,s,e),i=ot[s],i!==0&&(n-=lt[s],B(t,n,i)));while(o<t.sym_next);K(t,tr,r)},Ot=(t,r)=>{const e=r.dyn_tree,n=r.stat_desc.static_tree,a=r.stat_desc.has_stree,o=r.stat_desc.elems;let s,i,c=-1,l;for(t.heap_len=0,t.heap_max=Sn,s=0;s<o;s++)e[s*2]!==0?(t.heap[++t.heap_len]=c=s,t.depth[s]=0):e[s*2+1]=0;for(;t.heap_len<2;)l=t.heap[++t.heap_len]=c<2?++c:0,e[l*2]=1,t.depth[l]=0,t.opt_len--,a&&(t.static_len-=n[l*2+1]);for(r.max_code=c,s=t.heap_len>>1;s>=1;s--)bt(t,e,s);l=o;do s=t.heap[1],t.heap[1]=t.heap[t.heap_len--],bt(t,e,1),i=t.heap[1],t.heap[--t.heap_max]=s,t.heap[--t.heap_max]=i,e[l*2]=e[s*2]+e[i*2],t.depth[l]=(t.depth[s]>=t.depth[i]?t.depth[s]:t.depth[i])+1,e[s*2+1]=e[i*2+1]=l,t.heap[1]=l++,bt(t,e,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],Go(t,r),Rn(e,c,t.bl_count)},wr=(t,r,e)=>{let n,a=-1,o,s=r[1],i=0,c=7,l=4;for(s===0&&(c=138,l=3),r[(e+1)*2+1]=65535,n=0;n<=e;n++)o=s,s=r[(n+1)*2+1],!(++i<c&&o===s)&&(i<l?t.bl_tree[o*2]+=i:o!==0?(o!==a&&t.bl_tree[o*2]++,t.bl_tree[bn*2]++):i<=10?t.bl_tree[En*2]++:t.bl_tree[kn*2]++,i=0,a=o,s===0?(c=138,l=3):o===s?(c=6,l=3):(c=7,l=4))},yr=(t,r,e)=>{let n,a=-1,o,s=r[1],i=0,c=7,l=4;for(s===0&&(c=138,l=3),n=0;n<=e;n++)if(o=s,s=r[(n+1)*2+1],!(++i<c&&o===s)){if(i<l)do K(t,o,t.bl_tree);while(--i!==0);else o!==0?(o!==a&&(K(t,o,t.bl_tree),i--),K(t,bn,t.bl_tree),B(t,i-3,2)):i<=10?(K(t,En,t.bl_tree),B(t,i-3,3)):(K(t,kn,t.bl_tree),B(t,i-11,7));i=0,a=o,s===0?(c=138,l=3):o===s?(c=6,l=3):(c=7,l=4)}},qo=t=>{let r;for(wr(t,t.dyn_ltree,t.l_desc.max_code),wr(t,t.dyn_dtree,t.d_desc.max_code),Ot(t,t.bl_desc),r=er-1;r>=3&&t.bl_tree[Fn[r]*2+1]===0;r--);return t.opt_len+=3*(r+1)+5+5+4,r},Vo=(t,r,e,n)=>{let a;for(B(t,r-257,5),B(t,e-1,5),B(t,n-4,4),a=0;a<n;a++)B(t,t.bl_tree[Fn[a]*2+1],3);yr(t,t.dyn_ltree,r-1),yr(t,t.dyn_dtree,e-1)},jo=t=>{let r=4093624447,e;for(e=0;e<=31;e++,r>>>=1)if(r&1&&t.dyn_ltree[e*2]!==0)return mr;if(t.dyn_ltree[18]!==0||t.dyn_ltree[20]!==0||t.dyn_ltree[26]!==0)return pr;for(e=32;e<je;e++)if(t.dyn_ltree[e*2]!==0)return pr;return mr};let vr=!1;const Ko=t=>{vr||($o(),vr=!0),t.l_desc=new St(t.dyn_ltree,Mn),t.d_desc=new St(t.dyn_dtree,xn),t.bl_desc=new St(t.bl_tree,An),t.bi_buf=0,t.bi_valid=0,Nn(t)},Cn=(t,r,e,n)=>{B(t,(Do<<1)+(n?1:0),3),In(t),We(t,e),We(t,~e),e&&t.pending_buf.set(t.window.subarray(r,r+e),t.pending),t.pending+=e},Zo=t=>{B(t,vn<<1,3),K(t,tr,Q),Wo(t)},Yo=(t,r,e,n)=>{let a,o,s=0;t.level>0?(t.strm.data_type===Co&&(t.strm.data_type=jo(t)),Ot(t,t.l_desc),Ot(t,t.d_desc),s=qo(t),a=t.opt_len+3+7>>>3,o=t.static_len+3+7>>>3,o<=a&&(a=o)):a=o=e+5,e+4<=a&&r!==-1?Cn(t,r,e,n):t.strategy===Io||o===a?(B(t,(vn<<1)+(n?1:0),3),gr(t,Q,Le)):(B(t,(Lo<<1)+(n?1:0),3),Vo(t,t.l_desc.max_code+1,t.d_desc.max_code+1,s+1),gr(t,t.dyn_ltree,t.dyn_dtree)),Nn(t),n&&In(t)},Xo=(t,r,e)=>(t.pending_buf[t.sym_buf+t.sym_next++]=r,t.pending_buf[t.sym_buf+t.sym_next++]=r>>8,t.pending_buf[t.sym_buf+t.sym_next++]=e,r===0?t.dyn_ltree[e*2]++:(t.matches++,r--,t.dyn_ltree[(He[e]+je+1)*2]++,t.dyn_dtree[Tn(r)*2]++),t.sym_next===t.sym_end);var Jo=Ko,Qo=Cn,es=Yo,ts=Xo,rs=Zo,ns={_tr_init:Jo,_tr_stored_block:Qo,_tr_flush_block:es,_tr_tally:ts,_tr_align:rs};const as=(t,r,e,n)=>{let a=t&65535|0,o=t>>>16&65535|0,s=0;for(;e!==0;){s=e>2e3?2e3:e,e-=s;do a=a+r[n++]|0,o=o+a|0;while(--s);a%=65521,o%=65521}return a|o<<16|0};var Ge=as;const os=()=>{let t,r=[];for(var e=0;e<256;e++){t=e;for(var n=0;n<8;n++)t=t&1?3988292384^t>>>1:t>>>1;r[e]=t}return r},ss=new Uint32Array(os()),is=(t,r,e,n)=>{const a=ss,o=n+e;t^=-1;for(let s=n;s<o;s++)t=t>>>8^a[(t^r[s])&255];return t^-1};var D=is,ue={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Ke={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:ls,_tr_stored_block:Ut,_tr_flush_block:ds,_tr_tally:ae,_tr_align:cs}=ns,{Z_NO_FLUSH:oe,Z_PARTIAL_FLUSH:us,Z_FULL_FLUSH:fs,Z_FINISH:W,Z_BLOCK:Sr,Z_OK:L,Z_STREAM_END:br,Z_STREAM_ERROR:Y,Z_DATA_ERROR:hs,Z_BUF_ERROR:Et,Z_DEFAULT_COMPRESSION:ms,Z_FILTERED:ps,Z_HUFFMAN_ONLY:Qe,Z_RLE:_s,Z_FIXED:gs,Z_DEFAULT_STRATEGY:ws,Z_UNKNOWN:ys,Z_DEFLATED:ft}=Ke,vs=9,Ss=15,bs=8,Es=29,ks=256,Ht=ks+1+Es,Fs=30,Ms=19,xs=2*Ht+1,As=15,A=3,ne=258,X=ne+A+1,Ts=32,ke=42,nr=57,Wt=69,Gt=73,$t=91,qt=103,le=113,Ie=666,z=1,xe=2,fe=3,Ae=4,Ps=3,de=(t,r)=>(t.msg=ue[r],r),Er=t=>t*2-(t>4?9:0),re=t=>{let r=t.length;for(;--r>=0;)t[r]=0},Rs=t=>{let r,e,n,a=t.w_size;r=t.hash_size,n=r;do e=t.head[--n],t.head[n]=e>=a?e-a:0;while(--r);r=a,n=r;do e=t.prev[--n],t.prev[n]=e>=a?e-a:0;while(--r)};let Ns=(t,r,e)=>(r<<t.hash_shift^e)&t.hash_mask,se=Ns;const O=t=>{const r=t.state;let e=r.pending;e>t.avail_out&&(e=t.avail_out),e!==0&&(t.output.set(r.pending_buf.subarray(r.pending_out,r.pending_out+e),t.next_out),t.next_out+=e,r.pending_out+=e,t.total_out+=e,t.avail_out-=e,r.pending-=e,r.pending===0&&(r.pending_out=0))},H=(t,r)=>{ds(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,r),t.block_start=t.strstart,O(t.strm)},T=(t,r)=>{t.pending_buf[t.pending++]=r},Re=(t,r)=>{t.pending_buf[t.pending++]=r>>>8&255,t.pending_buf[t.pending++]=r&255},Vt=(t,r,e,n)=>{let a=t.avail_in;return a>n&&(a=n),a===0?0:(t.avail_in-=a,r.set(t.input.subarray(t.next_in,t.next_in+a),e),t.state.wrap===1?t.adler=Ge(t.adler,r,a,e):t.state.wrap===2&&(t.adler=D(t.adler,r,a,e)),t.next_in+=a,t.total_in+=a,a)},Dn=(t,r)=>{let e=t.max_chain_length,n=t.strstart,a,o,s=t.prev_length,i=t.nice_match;const c=t.strstart>t.w_size-X?t.strstart-(t.w_size-X):0,l=t.window,d=t.w_mask,p=t.prev,f=t.strstart+ne;let u=l[n+s-1],h=l[n+s];t.prev_length>=t.good_match&&(e>>=2),i>t.lookahead&&(i=t.lookahead);do if(a=r,!(l[a+s]!==h||l[a+s-1]!==u||l[a]!==l[n]||l[++a]!==l[n+1])){n+=2,a++;do;while(l[++n]===l[++a]&&l[++n]===l[++a]&&l[++n]===l[++a]&&l[++n]===l[++a]&&l[++n]===l[++a]&&l[++n]===l[++a]&&l[++n]===l[++a]&&l[++n]===l[++a]&&n<f);if(o=ne-(f-n),n=f-ne,o>s){if(t.match_start=r,s=o,o>=i)break;u=l[n+s-1],h=l[n+s]}}while((r=p[r&d])>c&&--e!==0);return s<=t.lookahead?s:t.lookahead},Fe=t=>{const r=t.w_size;let e,n,a;do{if(n=t.window_size-t.lookahead-t.strstart,t.strstart>=r+(r-X)&&(t.window.set(t.window.subarray(r,r+r-n),0),t.match_start-=r,t.strstart-=r,t.block_start-=r,t.insert>t.strstart&&(t.insert=t.strstart),Rs(t),n+=r),t.strm.avail_in===0)break;if(e=Vt(t.strm,t.window,t.strstart+t.lookahead,n),t.lookahead+=e,t.lookahead+t.insert>=A)for(a=t.strstart-t.insert,t.ins_h=t.window[a],t.ins_h=se(t,t.ins_h,t.window[a+1]);t.insert&&(t.ins_h=se(t,t.ins_h,t.window[a+A-1]),t.prev[a&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=a,a++,t.insert--,!(t.lookahead+t.insert<A)););}while(t.lookahead<X&&t.strm.avail_in!==0)},Ln=(t,r)=>{let e=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,n,a,o,s=0,i=t.strm.avail_in;do{if(n=65535,o=t.bi_valid+42>>3,t.strm.avail_out<o||(o=t.strm.avail_out-o,a=t.strstart-t.block_start,n>a+t.strm.avail_in&&(n=a+t.strm.avail_in),n>o&&(n=o),n<e&&(n===0&&r!==W||r===oe||n!==a+t.strm.avail_in)))break;s=r===W&&n===a+t.strm.avail_in?1:0,Ut(t,0,0,s),t.pending_buf[t.pending-4]=n,t.pending_buf[t.pending-3]=n>>8,t.pending_buf[t.pending-2]=~n,t.pending_buf[t.pending-1]=~n>>8,O(t.strm),a&&(a>n&&(a=n),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+a),t.strm.next_out),t.strm.next_out+=a,t.strm.avail_out-=a,t.strm.total_out+=a,t.block_start+=a,n-=a),n&&(Vt(t.strm,t.strm.output,t.strm.next_out,n),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n)}while(s===0);return i-=t.strm.avail_in,i&&(i>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=i&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-i,t.strm.next_in),t.strstart),t.strstart+=i,t.insert+=i>t.w_size-t.insert?t.w_size-t.insert:i),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),s?Ae:r!==oe&&r!==W&&t.strm.avail_in===0&&t.strstart===t.block_start?xe:(o=t.window_size-t.strstart,t.strm.avail_in>o&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,o+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),o>t.strm.avail_in&&(o=t.strm.avail_in),o&&(Vt(t.strm,t.window,t.strstart,o),t.strstart+=o,t.insert+=o>t.w_size-t.insert?t.w_size-t.insert:o),t.high_water<t.strstart&&(t.high_water=t.strstart),o=t.bi_valid+42>>3,o=t.pending_buf_size-o>65535?65535:t.pending_buf_size-o,e=o>t.w_size?t.w_size:o,a=t.strstart-t.block_start,(a>=e||(a||r===W)&&r!==oe&&t.strm.avail_in===0&&a<=o)&&(n=a>o?o:a,s=r===W&&t.strm.avail_in===0&&n===a?1:0,Ut(t,t.block_start,n,s),t.block_start+=n,O(t.strm)),s?fe:z)},kt=(t,r)=>{let e,n;for(;;){if(t.lookahead<X){if(Fe(t),t.lookahead<X&&r===oe)return z;if(t.lookahead===0)break}if(e=0,t.lookahead>=A&&(t.ins_h=se(t,t.ins_h,t.window[t.strstart+A-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),e!==0&&t.strstart-e<=t.w_size-X&&(t.match_length=Dn(t,e)),t.match_length>=A)if(n=ae(t,t.strstart-t.match_start,t.match_length-A),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=A){t.match_length--;do t.strstart++,t.ins_h=se(t,t.ins_h,t.window[t.strstart+A-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!==0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=se(t,t.ins_h,t.window[t.strstart+1]);else n=ae(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(H(t,!1),t.strm.avail_out===0))return z}return t.insert=t.strstart<A-1?t.strstart:A-1,r===W?(H(t,!0),t.strm.avail_out===0?fe:Ae):t.sym_next&&(H(t,!1),t.strm.avail_out===0)?z:xe},ge=(t,r)=>{let e,n,a;for(;;){if(t.lookahead<X){if(Fe(t),t.lookahead<X&&r===oe)return z;if(t.lookahead===0)break}if(e=0,t.lookahead>=A&&(t.ins_h=se(t,t.ins_h,t.window[t.strstart+A-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=A-1,e!==0&&t.prev_length<t.max_lazy_match&&t.strstart-e<=t.w_size-X&&(t.match_length=Dn(t,e),t.match_length<=5&&(t.strategy===ps||t.match_length===A&&t.strstart-t.match_start>4096)&&(t.match_length=A-1)),t.prev_length>=A&&t.match_length<=t.prev_length){a=t.strstart+t.lookahead-A,n=ae(t,t.strstart-1-t.prev_match,t.prev_length-A),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=a&&(t.ins_h=se(t,t.ins_h,t.window[t.strstart+A-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!==0);if(t.match_available=0,t.match_length=A-1,t.strstart++,n&&(H(t,!1),t.strm.avail_out===0))return z}else if(t.match_available){if(n=ae(t,0,t.window[t.strstart-1]),n&&H(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return z}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=ae(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<A-1?t.strstart:A-1,r===W?(H(t,!0),t.strm.avail_out===0?fe:Ae):t.sym_next&&(H(t,!1),t.strm.avail_out===0)?z:xe},Is=(t,r)=>{let e,n,a,o;const s=t.window;for(;;){if(t.lookahead<=ne){if(Fe(t),t.lookahead<=ne&&r===oe)return z;if(t.lookahead===0)break}if(t.match_length=0,t.lookahead>=A&&t.strstart>0&&(a=t.strstart-1,n=s[a],n===s[++a]&&n===s[++a]&&n===s[++a])){o=t.strstart+ne;do;while(n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&a<o);t.match_length=ne-(o-a),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=A?(e=ae(t,1,t.match_length-A),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(e=ae(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),e&&(H(t,!1),t.strm.avail_out===0))return z}return t.insert=0,r===W?(H(t,!0),t.strm.avail_out===0?fe:Ae):t.sym_next&&(H(t,!1),t.strm.avail_out===0)?z:xe},Cs=(t,r)=>{let e;for(;;){if(t.lookahead===0&&(Fe(t),t.lookahead===0)){if(r===oe)return z;break}if(t.match_length=0,e=ae(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,e&&(H(t,!1),t.strm.avail_out===0))return z}return t.insert=0,r===W?(H(t,!0),t.strm.avail_out===0?fe:Ae):t.sym_next&&(H(t,!1),t.strm.avail_out===0)?z:xe};function j(t,r,e,n,a){this.good_length=t,this.max_lazy=r,this.nice_length=e,this.max_chain=n,this.func=a}const Ce=[new j(0,0,0,0,Ln),new j(4,4,8,4,kt),new j(4,5,16,8,kt),new j(4,6,32,32,kt),new j(4,4,16,16,ge),new j(8,16,32,32,ge),new j(8,16,128,128,ge),new j(8,32,128,256,ge),new j(32,128,258,1024,ge),new j(32,258,258,4096,ge)],Ds=t=>{t.window_size=2*t.w_size,re(t.head),t.max_lazy_match=Ce[t.level].max_lazy,t.good_match=Ce[t.level].good_length,t.nice_match=Ce[t.level].nice_length,t.max_chain_length=Ce[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=A-1,t.match_available=0,t.ins_h=0};function Ls(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ft,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(xs*2),this.dyn_dtree=new Uint16Array((2*Fs+1)*2),this.bl_tree=new Uint16Array((2*Ms+1)*2),re(this.dyn_ltree),re(this.dyn_dtree),re(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(As+1),this.heap=new Uint16Array(2*Ht+1),re(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Ht+1),re(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Ze=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.status!==ke&&r.status!==nr&&r.status!==Wt&&r.status!==Gt&&r.status!==$t&&r.status!==qt&&r.status!==le&&r.status!==Ie?1:0},zn=t=>{if(Ze(t))return de(t,Y);t.total_in=t.total_out=0,t.data_type=ys;const r=t.state;return r.pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap===2?nr:r.wrap?ke:le,t.adler=r.wrap===2?0:1,r.last_flush=-2,ls(r),L},Bn=t=>{const r=zn(t);return r===L&&Ds(t.state),r},zs=(t,r)=>Ze(t)||t.state.wrap!==2?Y:(t.state.gzhead=r,L),On=(t,r,e,n,a,o)=>{if(!t)return Y;let s=1;if(r===ms&&(r=6),n<0?(s=0,n=-n):n>15&&(s=2,n-=16),a<1||a>vs||e!==ft||n<8||n>15||r<0||r>9||o<0||o>gs||n===8&&s!==1)return de(t,Y);n===8&&(n=9);const i=new Ls;return t.state=i,i.strm=t,i.status=ke,i.wrap=s,i.gzhead=null,i.w_bits=n,i.w_size=1<<i.w_bits,i.w_mask=i.w_size-1,i.hash_bits=a+7,i.hash_size=1<<i.hash_bits,i.hash_mask=i.hash_size-1,i.hash_shift=~~((i.hash_bits+A-1)/A),i.window=new Uint8Array(i.w_size*2),i.head=new Uint16Array(i.hash_size),i.prev=new Uint16Array(i.w_size),i.lit_bufsize=1<<a+6,i.pending_buf_size=i.lit_bufsize*4,i.pending_buf=new Uint8Array(i.pending_buf_size),i.sym_buf=i.lit_bufsize,i.sym_end=(i.lit_bufsize-1)*3,i.level=r,i.strategy=o,i.method=e,Bn(t)},Bs=(t,r)=>On(t,r,ft,Ss,bs,ws),Os=(t,r)=>{if(Ze(t)||r>Sr||r<0)return t?de(t,Y):Y;const e=t.state;if(!t.output||t.avail_in!==0&&!t.input||e.status===Ie&&r!==W)return de(t,t.avail_out===0?Et:Y);const n=e.last_flush;if(e.last_flush=r,e.pending!==0){if(O(t),t.avail_out===0)return e.last_flush=-1,L}else if(t.avail_in===0&&Er(r)<=Er(n)&&r!==W)return de(t,Et);if(e.status===Ie&&t.avail_in!==0)return de(t,Et);if(e.status===ke&&e.wrap===0&&(e.status=le),e.status===ke){let a=ft+(e.w_bits-8<<4)<<8,o=-1;if(e.strategy>=Qe||e.level<2?o=0:e.level<6?o=1:e.level===6?o=2:o=3,a|=o<<6,e.strstart!==0&&(a|=Ts),a+=31-a%31,Re(e,a),e.strstart!==0&&(Re(e,t.adler>>>16),Re(e,t.adler&65535)),t.adler=1,e.status=le,O(t),e.pending!==0)return e.last_flush=-1,L}if(e.status===nr){if(t.adler=0,T(e,31),T(e,139),T(e,8),e.gzhead)T(e,(e.gzhead.text?1:0)+(e.gzhead.hcrc?2:0)+(e.gzhead.extra?4:0)+(e.gzhead.name?8:0)+(e.gzhead.comment?16:0)),T(e,e.gzhead.time&255),T(e,e.gzhead.time>>8&255),T(e,e.gzhead.time>>16&255),T(e,e.gzhead.time>>24&255),T(e,e.level===9?2:e.strategy>=Qe||e.level<2?4:0),T(e,e.gzhead.os&255),e.gzhead.extra&&e.gzhead.extra.length&&(T(e,e.gzhead.extra.length&255),T(e,e.gzhead.extra.length>>8&255)),e.gzhead.hcrc&&(t.adler=D(t.adler,e.pending_buf,e.pending,0)),e.gzindex=0,e.status=Wt;else if(T(e,0),T(e,0),T(e,0),T(e,0),T(e,0),T(e,e.level===9?2:e.strategy>=Qe||e.level<2?4:0),T(e,Ps),e.status=le,O(t),e.pending!==0)return e.last_flush=-1,L}if(e.status===Wt){if(e.gzhead.extra){let a=e.pending,o=(e.gzhead.extra.length&65535)-e.gzindex;for(;e.pending+o>e.pending_buf_size;){let i=e.pending_buf_size-e.pending;if(e.pending_buf.set(e.gzhead.extra.subarray(e.gzindex,e.gzindex+i),e.pending),e.pending=e.pending_buf_size,e.gzhead.hcrc&&e.pending>a&&(t.adler=D(t.adler,e.pending_buf,e.pending-a,a)),e.gzindex+=i,O(t),e.pending!==0)return e.last_flush=-1,L;a=0,o-=i}let s=new Uint8Array(e.gzhead.extra);e.pending_buf.set(s.subarray(e.gzindex,e.gzindex+o),e.pending),e.pending+=o,e.gzhead.hcrc&&e.pending>a&&(t.adler=D(t.adler,e.pending_buf,e.pending-a,a)),e.gzindex=0}e.status=Gt}if(e.status===Gt){if(e.gzhead.name){let a=e.pending,o;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>a&&(t.adler=D(t.adler,e.pending_buf,e.pending-a,a)),O(t),e.pending!==0)return e.last_flush=-1,L;a=0}e.gzindex<e.gzhead.name.length?o=e.gzhead.name.charCodeAt(e.gzindex++)&255:o=0,T(e,o)}while(o!==0);e.gzhead.hcrc&&e.pending>a&&(t.adler=D(t.adler,e.pending_buf,e.pending-a,a)),e.gzindex=0}e.status=$t}if(e.status===$t){if(e.gzhead.comment){let a=e.pending,o;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>a&&(t.adler=D(t.adler,e.pending_buf,e.pending-a,a)),O(t),e.pending!==0)return e.last_flush=-1,L;a=0}e.gzindex<e.gzhead.comment.length?o=e.gzhead.comment.charCodeAt(e.gzindex++)&255:o=0,T(e,o)}while(o!==0);e.gzhead.hcrc&&e.pending>a&&(t.adler=D(t.adler,e.pending_buf,e.pending-a,a))}e.status=qt}if(e.status===qt){if(e.gzhead.hcrc){if(e.pending+2>e.pending_buf_size&&(O(t),e.pending!==0))return e.last_flush=-1,L;T(e,t.adler&255),T(e,t.adler>>8&255),t.adler=0}if(e.status=le,O(t),e.pending!==0)return e.last_flush=-1,L}if(t.avail_in!==0||e.lookahead!==0||r!==oe&&e.status!==Ie){let a=e.level===0?Ln(e,r):e.strategy===Qe?Cs(e,r):e.strategy===_s?Is(e,r):Ce[e.level].func(e,r);if((a===fe||a===Ae)&&(e.status=Ie),a===z||a===fe)return t.avail_out===0&&(e.last_flush=-1),L;if(a===xe&&(r===us?cs(e):r!==Sr&&(Ut(e,0,0,!1),r===fs&&(re(e.head),e.lookahead===0&&(e.strstart=0,e.block_start=0,e.insert=0))),O(t),t.avail_out===0))return e.last_flush=-1,L}return r!==W?L:e.wrap<=0?br:(e.wrap===2?(T(e,t.adler&255),T(e,t.adler>>8&255),T(e,t.adler>>16&255),T(e,t.adler>>24&255),T(e,t.total_in&255),T(e,t.total_in>>8&255),T(e,t.total_in>>16&255),T(e,t.total_in>>24&255)):(Re(e,t.adler>>>16),Re(e,t.adler&65535)),O(t),e.wrap>0&&(e.wrap=-e.wrap),e.pending!==0?L:br)},Us=t=>{if(Ze(t))return Y;const r=t.state.status;return t.state=null,r===le?de(t,hs):L},Hs=(t,r)=>{let e=r.length;if(Ze(t))return Y;const n=t.state,a=n.wrap;if(a===2||a===1&&n.status!==ke||n.lookahead)return Y;if(a===1&&(t.adler=Ge(t.adler,r,e,0)),n.wrap=0,e>=n.w_size){a===0&&(re(n.head),n.strstart=0,n.block_start=0,n.insert=0);let c=new Uint8Array(n.w_size);c.set(r.subarray(e-n.w_size,e),0),r=c,e=n.w_size}const o=t.avail_in,s=t.next_in,i=t.input;for(t.avail_in=e,t.next_in=0,t.input=r,Fe(n);n.lookahead>=A;){let c=n.strstart,l=n.lookahead-(A-1);do n.ins_h=se(n,n.ins_h,n.window[c+A-1]),n.prev[c&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=c,c++;while(--l);n.strstart=c,n.lookahead=A-1,Fe(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=A-1,n.match_available=0,t.next_in=s,t.input=i,t.avail_in=o,n.wrap=a,L};var Ws=Bs,Gs=On,$s=Bn,qs=zn,Vs=zs,js=Os,Ks=Us,Zs=Hs,Ys="pako deflate (from Nodeca project)",ze={deflateInit:Ws,deflateInit2:Gs,deflateReset:$s,deflateResetKeep:qs,deflateSetHeader:Vs,deflate:js,deflateEnd:Ks,deflateSetDictionary:Zs,deflateInfo:Ys};const Xs=(t,r)=>Object.prototype.hasOwnProperty.call(t,r);var Js=function(t){const r=Array.prototype.slice.call(arguments,1);for(;r.length;){const e=r.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(const n in e)Xs(e,n)&&(t[n]=e[n])}}return t},Qs=t=>{let r=0;for(let n=0,a=t.length;n<a;n++)r+=t[n].length;const e=new Uint8Array(r);for(let n=0,a=0,o=t.length;n<o;n++){let s=t[n];e.set(s,a),a+=s.length}return e},ht={assign:Js,flattenChunks:Qs};let Un=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Un=!1}const $e=new Uint8Array(256);for(let t=0;t<256;t++)$e[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;$e[254]=$e[254]=1;var ei=t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let r,e,n,a,o,s=t.length,i=0;for(a=0;a<s;a++)e=t.charCodeAt(a),(e&64512)===55296&&a+1<s&&(n=t.charCodeAt(a+1),(n&64512)===56320&&(e=65536+(e-55296<<10)+(n-56320),a++)),i+=e<128?1:e<2048?2:e<65536?3:4;for(r=new Uint8Array(i),o=0,a=0;o<i;a++)e=t.charCodeAt(a),(e&64512)===55296&&a+1<s&&(n=t.charCodeAt(a+1),(n&64512)===56320&&(e=65536+(e-55296<<10)+(n-56320),a++)),e<128?r[o++]=e:e<2048?(r[o++]=192|e>>>6,r[o++]=128|e&63):e<65536?(r[o++]=224|e>>>12,r[o++]=128|e>>>6&63,r[o++]=128|e&63):(r[o++]=240|e>>>18,r[o++]=128|e>>>12&63,r[o++]=128|e>>>6&63,r[o++]=128|e&63);return r};const ti=(t,r)=>{if(r<65534&&t.subarray&&Un)return String.fromCharCode.apply(null,t.length===r?t:t.subarray(0,r));let e="";for(let n=0;n<r;n++)e+=String.fromCharCode(t[n]);return e};var ri=(t,r)=>{const e=r||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,r));let n,a;const o=new Array(e*2);for(a=0,n=0;n<e;){let s=t[n++];if(s<128){o[a++]=s;continue}let i=$e[s];if(i>4){o[a++]=65533,n+=i-1;continue}for(s&=i===2?31:i===3?15:7;i>1&&n<e;)s=s<<6|t[n++]&63,i--;if(i>1){o[a++]=65533;continue}s<65536?o[a++]=s:(s-=65536,o[a++]=55296|s>>10&1023,o[a++]=56320|s&1023)}return ti(o,a)},ni=(t,r)=>{r=r||t.length,r>t.length&&(r=t.length);let e=r-1;for(;e>=0&&(t[e]&192)===128;)e--;return e<0||e===0?r:e+$e[t[e]]>r?e:r},qe={string2buf:ei,buf2string:ri,utf8border:ni};function ai(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Hn=ai;const Wn=Object.prototype.toString,{Z_NO_FLUSH:oi,Z_SYNC_FLUSH:si,Z_FULL_FLUSH:ii,Z_FINISH:li,Z_OK:dt,Z_STREAM_END:di,Z_DEFAULT_COMPRESSION:ci,Z_DEFAULT_STRATEGY:ui,Z_DEFLATED:fi}=Ke;function Ye(t){this.options=ht.assign({level:ci,method:fi,chunkSize:16384,windowBits:15,memLevel:8,strategy:ui},t||{});let r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Hn,this.strm.avail_out=0;let e=ze.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(e!==dt)throw new Error(ue[e]);if(r.header&&ze.deflateSetHeader(this.strm,r.header),r.dictionary){let n;if(typeof r.dictionary=="string"?n=qe.string2buf(r.dictionary):Wn.call(r.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(r.dictionary):n=r.dictionary,e=ze.deflateSetDictionary(this.strm,n),e!==dt)throw new Error(ue[e]);this._dict_set=!0}}Ye.prototype.push=function(t,r){const e=this.strm,n=this.options.chunkSize;let a,o;if(this.ended)return!1;for(r===~~r?o=r:o=r===!0?li:oi,typeof t=="string"?e.input=qe.string2buf(t):Wn.call(t)==="[object ArrayBuffer]"?e.input=new Uint8Array(t):e.input=t,e.next_in=0,e.avail_in=e.input.length;;){if(e.avail_out===0&&(e.output=new Uint8Array(n),e.next_out=0,e.avail_out=n),(o===si||o===ii)&&e.avail_out<=6){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(a=ze.deflate(e,o),a===di)return e.next_out>0&&this.onData(e.output.subarray(0,e.next_out)),a=ze.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===dt;if(e.avail_out===0){this.onData(e.output);continue}if(o>0&&e.next_out>0){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(e.avail_in===0)break}return!0};Ye.prototype.onData=function(t){this.chunks.push(t)};Ye.prototype.onEnd=function(t){t===dt&&(this.result=ht.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function ar(t,r){const e=new Ye(r);if(e.push(t,!0),e.err)throw e.msg||ue[e.err];return e.result}function hi(t,r){return r=r||{},r.raw=!0,ar(t,r)}function mi(t,r){return r=r||{},r.gzip=!0,ar(t,r)}var pi=Ye,_i=ar,gi=hi,wi=mi,yi={Deflate:pi,deflate:_i,deflateRaw:gi,gzip:wi};const et=16209,vi=16191;var Si=function(r,e){let n,a,o,s,i,c,l,d,p,f,u,h,M,E,g,k,S,m,x,R,_,F,b,y;const v=r.state;n=r.next_in,b=r.input,a=n+(r.avail_in-5),o=r.next_out,y=r.output,s=o-(e-r.avail_out),i=o+(r.avail_out-257),c=v.dmax,l=v.wsize,d=v.whave,p=v.wnext,f=v.window,u=v.hold,h=v.bits,M=v.lencode,E=v.distcode,g=(1<<v.lenbits)-1,k=(1<<v.distbits)-1;e:do{h<15&&(u+=b[n++]<<h,h+=8,u+=b[n++]<<h,h+=8),S=M[u&g];t:for(;;){if(m=S>>>24,u>>>=m,h-=m,m=S>>>16&255,m===0)y[o++]=S&65535;else if(m&16){x=S&65535,m&=15,m&&(h<m&&(u+=b[n++]<<h,h+=8),x+=u&(1<<m)-1,u>>>=m,h-=m),h<15&&(u+=b[n++]<<h,h+=8,u+=b[n++]<<h,h+=8),S=E[u&k];r:for(;;){if(m=S>>>24,u>>>=m,h-=m,m=S>>>16&255,m&16){if(R=S&65535,m&=15,h<m&&(u+=b[n++]<<h,h+=8,h<m&&(u+=b[n++]<<h,h+=8)),R+=u&(1<<m)-1,R>c){r.msg="invalid distance too far back",v.mode=et;break e}if(u>>>=m,h-=m,m=o-s,R>m){if(m=R-m,m>d&&v.sane){r.msg="invalid distance too far back",v.mode=et;break e}if(_=0,F=f,p===0){if(_+=l-m,m<x){x-=m;do y[o++]=f[_++];while(--m);_=o-R,F=y}}else if(p<m){if(_+=l+p-m,m-=p,m<x){x-=m;do y[o++]=f[_++];while(--m);if(_=0,p<x){m=p,x-=m;do y[o++]=f[_++];while(--m);_=o-R,F=y}}}else if(_+=p-m,m<x){x-=m;do y[o++]=f[_++];while(--m);_=o-R,F=y}for(;x>2;)y[o++]=F[_++],y[o++]=F[_++],y[o++]=F[_++],x-=3;x&&(y[o++]=F[_++],x>1&&(y[o++]=F[_++]))}else{_=o-R;do y[o++]=y[_++],y[o++]=y[_++],y[o++]=y[_++],x-=3;while(x>2);x&&(y[o++]=y[_++],x>1&&(y[o++]=y[_++]))}}else if((m&64)===0){S=E[(S&65535)+(u&(1<<m)-1)];continue r}else{r.msg="invalid distance code",v.mode=et;break e}break}}else if((m&64)===0){S=M[(S&65535)+(u&(1<<m)-1)];continue t}else if(m&32){v.mode=vi;break e}else{r.msg="invalid literal/length code",v.mode=et;break e}break}}while(n<a&&o<i);x=h>>3,n-=x,h-=x<<3,u&=(1<<h)-1,r.next_in=n,r.next_out=o,r.avail_in=n<a?5+(a-n):5-(n-a),r.avail_out=o<i?257+(i-o):257-(o-i),v.hold=u,v.bits=h};const we=15,kr=852,Fr=592,Mr=0,Ft=1,xr=2,bi=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Ei=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),ki=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Fi=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),Mi=(t,r,e,n,a,o,s,i)=>{const c=i.bits;let l=0,d=0,p=0,f=0,u=0,h=0,M=0,E=0,g=0,k=0,S,m,x,R,_,F=null,b;const y=new Uint16Array(we+1),v=new Uint16Array(we+1);let C=null,$,V,pe;for(l=0;l<=we;l++)y[l]=0;for(d=0;d<n;d++)y[r[e+d]]++;for(u=c,f=we;f>=1&&y[f]===0;f--);if(u>f&&(u=f),f===0)return a[o++]=1<<24|64<<16|0,a[o++]=1<<24|64<<16|0,i.bits=1,0;for(p=1;p<f&&y[p]===0;p++);for(u<p&&(u=p),E=1,l=1;l<=we;l++)if(E<<=1,E-=y[l],E<0)return-1;if(E>0&&(t===Mr||f!==1))return-1;for(v[1]=0,l=1;l<we;l++)v[l+1]=v[l]+y[l];for(d=0;d<n;d++)r[e+d]!==0&&(s[v[r[e+d]]++]=d);if(t===Mr?(F=C=s,b=20):t===Ft?(F=bi,C=Ei,b=257):(F=ki,C=Fi,b=0),k=0,d=0,l=p,_=o,h=u,M=0,x=-1,g=1<<u,R=g-1,t===Ft&&g>kr||t===xr&&g>Fr)return 1;for(;;){$=l-M,s[d]+1<b?(V=0,pe=s[d]):s[d]>=b?(V=C[s[d]-b],pe=F[s[d]-b]):(V=96,pe=0),S=1<<l-M,m=1<<h,p=m;do m-=S,a[_+(k>>M)+m]=$<<24|V<<16|pe|0;while(m!==0);for(S=1<<l-1;k&S;)S>>=1;if(S!==0?(k&=S-1,k+=S):k=0,d++,--y[l]===0){if(l===f)break;l=r[e+s[d]]}if(l>u&&(k&R)!==x){for(M===0&&(M=u),_+=p,h=l-M,E=1<<h;h+M<f&&(E-=y[h+M],!(E<=0));)h++,E<<=1;if(g+=1<<h,t===Ft&&g>kr||t===xr&&g>Fr)return 1;x=k&R,a[x]=u<<24|h<<16|_-o|0}}return k!==0&&(a[_+k]=l-M<<24|64<<16|0),i.bits=u,0};var Be=Mi;const xi=0,Gn=1,$n=2,{Z_FINISH:Ar,Z_BLOCK:Ai,Z_TREES:tt,Z_OK:he,Z_STREAM_END:Ti,Z_NEED_DICT:Pi,Z_STREAM_ERROR:G,Z_DATA_ERROR:qn,Z_MEM_ERROR:Vn,Z_BUF_ERROR:Ri,Z_DEFLATED:Tr}=Ke,mt=16180,Pr=16181,Rr=16182,Nr=16183,Ir=16184,Cr=16185,Dr=16186,Lr=16187,zr=16188,Br=16189,ct=16190,J=16191,Mt=16192,Or=16193,xt=16194,Ur=16195,Hr=16196,Wr=16197,Gr=16198,rt=16199,nt=16200,$r=16201,qr=16202,Vr=16203,jr=16204,Kr=16205,At=16206,Zr=16207,Yr=16208,I=16209,jn=16210,Kn=16211,Ni=852,Ii=592,Ci=15,Di=Ci,Xr=t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24);function Li(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const me=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.mode<mt||r.mode>Kn?1:0},Zn=t=>{if(me(t))return G;const r=t.state;return t.total_in=t.total_out=r.total=0,t.msg="",r.wrap&&(t.adler=r.wrap&1),r.mode=mt,r.last=0,r.havedict=0,r.flags=-1,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new Int32Array(Ni),r.distcode=r.distdyn=new Int32Array(Ii),r.sane=1,r.back=-1,he},Yn=t=>{if(me(t))return G;const r=t.state;return r.wsize=0,r.whave=0,r.wnext=0,Zn(t)},Xn=(t,r)=>{let e;if(me(t))return G;const n=t.state;return r<0?(e=0,r=-r):(e=(r>>4)+5,r<48&&(r&=15)),r&&(r<8||r>15)?G:(n.window!==null&&n.wbits!==r&&(n.window=null),n.wrap=e,n.wbits=r,Yn(t))},Jn=(t,r)=>{if(!t)return G;const e=new Li;t.state=e,e.strm=t,e.window=null,e.mode=mt;const n=Xn(t,r);return n!==he&&(t.state=null),n},zi=t=>Jn(t,Di);let Jr=!0,Tt,Pt;const Bi=t=>{if(Jr){Tt=new Int32Array(512),Pt=new Int32Array(32);let r=0;for(;r<144;)t.lens[r++]=8;for(;r<256;)t.lens[r++]=9;for(;r<280;)t.lens[r++]=7;for(;r<288;)t.lens[r++]=8;for(Be(Gn,t.lens,0,288,Tt,0,t.work,{bits:9}),r=0;r<32;)t.lens[r++]=5;Be($n,t.lens,0,32,Pt,0,t.work,{bits:5}),Jr=!1}t.lencode=Tt,t.lenbits=9,t.distcode=Pt,t.distbits=5},Qn=(t,r,e,n)=>{let a;const o=t.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),n>=o.wsize?(o.window.set(r.subarray(e-o.wsize,e),0),o.wnext=0,o.whave=o.wsize):(a=o.wsize-o.wnext,a>n&&(a=n),o.window.set(r.subarray(e-n,e-n+a),o.wnext),n-=a,n?(o.window.set(r.subarray(e-n,e),0),o.wnext=n,o.whave=o.wsize):(o.wnext+=a,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=a))),0},Oi=(t,r)=>{let e,n,a,o,s,i,c,l,d,p,f,u,h,M,E=0,g,k,S,m,x,R,_,F;const b=new Uint8Array(4);let y,v;const C=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(me(t)||!t.output||!t.input&&t.avail_in!==0)return G;e=t.state,e.mode===J&&(e.mode=Mt),s=t.next_out,a=t.output,c=t.avail_out,o=t.next_in,n=t.input,i=t.avail_in,l=e.hold,d=e.bits,p=i,f=c,F=he;e:for(;;)switch(e.mode){case mt:if(e.wrap===0){e.mode=Mt;break}for(;d<16;){if(i===0)break e;i--,l+=n[o++]<<d,d+=8}if(e.wrap&2&&l===35615){e.wbits===0&&(e.wbits=15),e.check=0,b[0]=l&255,b[1]=l>>>8&255,e.check=D(e.check,b,2,0),l=0,d=0,e.mode=Pr;break}if(e.head&&(e.head.done=!1),!(e.wrap&1)||(((l&255)<<8)+(l>>8))%31){t.msg="incorrect header check",e.mode=I;break}if((l&15)!==Tr){t.msg="unknown compression method",e.mode=I;break}if(l>>>=4,d-=4,_=(l&15)+8,e.wbits===0&&(e.wbits=_),_>15||_>e.wbits){t.msg="invalid window size",e.mode=I;break}e.dmax=1<<e.wbits,e.flags=0,t.adler=e.check=1,e.mode=l&512?Br:J,l=0,d=0;break;case Pr:for(;d<16;){if(i===0)break e;i--,l+=n[o++]<<d,d+=8}if(e.flags=l,(e.flags&255)!==Tr){t.msg="unknown compression method",e.mode=I;break}if(e.flags&57344){t.msg="unknown header flags set",e.mode=I;break}e.head&&(e.head.text=l>>8&1),e.flags&512&&e.wrap&4&&(b[0]=l&255,b[1]=l>>>8&255,e.check=D(e.check,b,2,0)),l=0,d=0,e.mode=Rr;case Rr:for(;d<32;){if(i===0)break e;i--,l+=n[o++]<<d,d+=8}e.head&&(e.head.time=l),e.flags&512&&e.wrap&4&&(b[0]=l&255,b[1]=l>>>8&255,b[2]=l>>>16&255,b[3]=l>>>24&255,e.check=D(e.check,b,4,0)),l=0,d=0,e.mode=Nr;case Nr:for(;d<16;){if(i===0)break e;i--,l+=n[o++]<<d,d+=8}e.head&&(e.head.xflags=l&255,e.head.os=l>>8),e.flags&512&&e.wrap&4&&(b[0]=l&255,b[1]=l>>>8&255,e.check=D(e.check,b,2,0)),l=0,d=0,e.mode=Ir;case Ir:if(e.flags&1024){for(;d<16;){if(i===0)break e;i--,l+=n[o++]<<d,d+=8}e.length=l,e.head&&(e.head.extra_len=l),e.flags&512&&e.wrap&4&&(b[0]=l&255,b[1]=l>>>8&255,e.check=D(e.check,b,2,0)),l=0,d=0}else e.head&&(e.head.extra=null);e.mode=Cr;case Cr:if(e.flags&1024&&(u=e.length,u>i&&(u=i),u&&(e.head&&(_=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(n.subarray(o,o+u),_)),e.flags&512&&e.wrap&4&&(e.check=D(e.check,n,u,o)),i-=u,o+=u,e.length-=u),e.length))break e;e.length=0,e.mode=Dr;case Dr:if(e.flags&2048){if(i===0)break e;u=0;do _=n[o+u++],e.head&&_&&e.length<65536&&(e.head.name+=String.fromCharCode(_));while(_&&u<i);if(e.flags&512&&e.wrap&4&&(e.check=D(e.check,n,u,o)),i-=u,o+=u,_)break e}else e.head&&(e.head.name=null);e.length=0,e.mode=Lr;case Lr:if(e.flags&4096){if(i===0)break e;u=0;do _=n[o+u++],e.head&&_&&e.length<65536&&(e.head.comment+=String.fromCharCode(_));while(_&&u<i);if(e.flags&512&&e.wrap&4&&(e.check=D(e.check,n,u,o)),i-=u,o+=u,_)break e}else e.head&&(e.head.comment=null);e.mode=zr;case zr:if(e.flags&512){for(;d<16;){if(i===0)break e;i--,l+=n[o++]<<d,d+=8}if(e.wrap&4&&l!==(e.check&65535)){t.msg="header crc mismatch",e.mode=I;break}l=0,d=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),t.adler=e.check=0,e.mode=J;break;case Br:for(;d<32;){if(i===0)break e;i--,l+=n[o++]<<d,d+=8}t.adler=e.check=Xr(l),l=0,d=0,e.mode=ct;case ct:if(e.havedict===0)return t.next_out=s,t.avail_out=c,t.next_in=o,t.avail_in=i,e.hold=l,e.bits=d,Pi;t.adler=e.check=1,e.mode=J;case J:if(r===Ai||r===tt)break e;case Mt:if(e.last){l>>>=d&7,d-=d&7,e.mode=At;break}for(;d<3;){if(i===0)break e;i--,l+=n[o++]<<d,d+=8}switch(e.last=l&1,l>>>=1,d-=1,l&3){case 0:e.mode=Or;break;case 1:if(Bi(e),e.mode=rt,r===tt){l>>>=2,d-=2;break e}break;case 2:e.mode=Hr;break;case 3:t.msg="invalid block type",e.mode=I}l>>>=2,d-=2;break;case Or:for(l>>>=d&7,d-=d&7;d<32;){if(i===0)break e;i--,l+=n[o++]<<d,d+=8}if((l&65535)!==(l>>>16^65535)){t.msg="invalid stored block lengths",e.mode=I;break}if(e.length=l&65535,l=0,d=0,e.mode=xt,r===tt)break e;case xt:e.mode=Ur;case Ur:if(u=e.length,u){if(u>i&&(u=i),u>c&&(u=c),u===0)break e;a.set(n.subarray(o,o+u),s),i-=u,o+=u,c-=u,s+=u,e.length-=u;break}e.mode=J;break;case Hr:for(;d<14;){if(i===0)break e;i--,l+=n[o++]<<d,d+=8}if(e.nlen=(l&31)+257,l>>>=5,d-=5,e.ndist=(l&31)+1,l>>>=5,d-=5,e.ncode=(l&15)+4,l>>>=4,d-=4,e.nlen>286||e.ndist>30){t.msg="too many length or distance symbols",e.mode=I;break}e.have=0,e.mode=Wr;case Wr:for(;e.have<e.ncode;){for(;d<3;){if(i===0)break e;i--,l+=n[o++]<<d,d+=8}e.lens[C[e.have++]]=l&7,l>>>=3,d-=3}for(;e.have<19;)e.lens[C[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,y={bits:e.lenbits},F=Be(xi,e.lens,0,19,e.lencode,0,e.work,y),e.lenbits=y.bits,F){t.msg="invalid code lengths set",e.mode=I;break}e.have=0,e.mode=Gr;case Gr:for(;e.have<e.nlen+e.ndist;){for(;E=e.lencode[l&(1<<e.lenbits)-1],g=E>>>24,k=E>>>16&255,S=E&65535,!(g<=d);){if(i===0)break e;i--,l+=n[o++]<<d,d+=8}if(S<16)l>>>=g,d-=g,e.lens[e.have++]=S;else{if(S===16){for(v=g+2;d<v;){if(i===0)break e;i--,l+=n[o++]<<d,d+=8}if(l>>>=g,d-=g,e.have===0){t.msg="invalid bit length repeat",e.mode=I;break}_=e.lens[e.have-1],u=3+(l&3),l>>>=2,d-=2}else if(S===17){for(v=g+3;d<v;){if(i===0)break e;i--,l+=n[o++]<<d,d+=8}l>>>=g,d-=g,_=0,u=3+(l&7),l>>>=3,d-=3}else{for(v=g+7;d<v;){if(i===0)break e;i--,l+=n[o++]<<d,d+=8}l>>>=g,d-=g,_=0,u=11+(l&127),l>>>=7,d-=7}if(e.have+u>e.nlen+e.ndist){t.msg="invalid bit length repeat",e.mode=I;break}for(;u--;)e.lens[e.have++]=_}}if(e.mode===I)break;if(e.lens[256]===0){t.msg="invalid code -- missing end-of-block",e.mode=I;break}if(e.lenbits=9,y={bits:e.lenbits},F=Be(Gn,e.lens,0,e.nlen,e.lencode,0,e.work,y),e.lenbits=y.bits,F){t.msg="invalid literal/lengths set",e.mode=I;break}if(e.distbits=6,e.distcode=e.distdyn,y={bits:e.distbits},F=Be($n,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,y),e.distbits=y.bits,F){t.msg="invalid distances set",e.mode=I;break}if(e.mode=rt,r===tt)break e;case rt:e.mode=nt;case nt:if(i>=6&&c>=258){t.next_out=s,t.avail_out=c,t.next_in=o,t.avail_in=i,e.hold=l,e.bits=d,Si(t,f),s=t.next_out,a=t.output,c=t.avail_out,o=t.next_in,n=t.input,i=t.avail_in,l=e.hold,d=e.bits,e.mode===J&&(e.back=-1);break}for(e.back=0;E=e.lencode[l&(1<<e.lenbits)-1],g=E>>>24,k=E>>>16&255,S=E&65535,!(g<=d);){if(i===0)break e;i--,l+=n[o++]<<d,d+=8}if(k&&(k&240)===0){for(m=g,x=k,R=S;E=e.lencode[R+((l&(1<<m+x)-1)>>m)],g=E>>>24,k=E>>>16&255,S=E&65535,!(m+g<=d);){if(i===0)break e;i--,l+=n[o++]<<d,d+=8}l>>>=m,d-=m,e.back+=m}if(l>>>=g,d-=g,e.back+=g,e.length=S,k===0){e.mode=Kr;break}if(k&32){e.back=-1,e.mode=J;break}if(k&64){t.msg="invalid literal/length code",e.mode=I;break}e.extra=k&15,e.mode=$r;case $r:if(e.extra){for(v=e.extra;d<v;){if(i===0)break e;i--,l+=n[o++]<<d,d+=8}e.length+=l&(1<<e.extra)-1,l>>>=e.extra,d-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=qr;case qr:for(;E=e.distcode[l&(1<<e.distbits)-1],g=E>>>24,k=E>>>16&255,S=E&65535,!(g<=d);){if(i===0)break e;i--,l+=n[o++]<<d,d+=8}if((k&240)===0){for(m=g,x=k,R=S;E=e.distcode[R+((l&(1<<m+x)-1)>>m)],g=E>>>24,k=E>>>16&255,S=E&65535,!(m+g<=d);){if(i===0)break e;i--,l+=n[o++]<<d,d+=8}l>>>=m,d-=m,e.back+=m}if(l>>>=g,d-=g,e.back+=g,k&64){t.msg="invalid distance code",e.mode=I;break}e.offset=S,e.extra=k&15,e.mode=Vr;case Vr:if(e.extra){for(v=e.extra;d<v;){if(i===0)break e;i--,l+=n[o++]<<d,d+=8}e.offset+=l&(1<<e.extra)-1,l>>>=e.extra,d-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){t.msg="invalid distance too far back",e.mode=I;break}e.mode=jr;case jr:if(c===0)break e;if(u=f-c,e.offset>u){if(u=e.offset-u,u>e.whave&&e.sane){t.msg="invalid distance too far back",e.mode=I;break}u>e.wnext?(u-=e.wnext,h=e.wsize-u):h=e.wnext-u,u>e.length&&(u=e.length),M=e.window}else M=a,h=s-e.offset,u=e.length;u>c&&(u=c),c-=u,e.length-=u;do a[s++]=M[h++];while(--u);e.length===0&&(e.mode=nt);break;case Kr:if(c===0)break e;a[s++]=e.length,c--,e.mode=nt;break;case At:if(e.wrap){for(;d<32;){if(i===0)break e;i--,l|=n[o++]<<d,d+=8}if(f-=c,t.total_out+=f,e.total+=f,e.wrap&4&&f&&(t.adler=e.check=e.flags?D(e.check,a,f,s-f):Ge(e.check,a,f,s-f)),f=c,e.wrap&4&&(e.flags?l:Xr(l))!==e.check){t.msg="incorrect data check",e.mode=I;break}l=0,d=0}e.mode=Zr;case Zr:if(e.wrap&&e.flags){for(;d<32;){if(i===0)break e;i--,l+=n[o++]<<d,d+=8}if(e.wrap&4&&l!==(e.total&4294967295)){t.msg="incorrect length check",e.mode=I;break}l=0,d=0}e.mode=Yr;case Yr:F=Ti;break e;case I:F=qn;break e;case jn:return Vn;case Kn:default:return G}return t.next_out=s,t.avail_out=c,t.next_in=o,t.avail_in=i,e.hold=l,e.bits=d,(e.wsize||f!==t.avail_out&&e.mode<I&&(e.mode<At||r!==Ar))&&Qn(t,t.output,t.next_out,f-t.avail_out),p-=t.avail_in,f-=t.avail_out,t.total_in+=p,t.total_out+=f,e.total+=f,e.wrap&4&&f&&(t.adler=e.check=e.flags?D(e.check,a,f,t.next_out-f):Ge(e.check,a,f,t.next_out-f)),t.data_type=e.bits+(e.last?64:0)+(e.mode===J?128:0)+(e.mode===rt||e.mode===xt?256:0),(p===0&&f===0||r===Ar)&&F===he&&(F=Ri),F},Ui=t=>{if(me(t))return G;let r=t.state;return r.window&&(r.window=null),t.state=null,he},Hi=(t,r)=>{if(me(t))return G;const e=t.state;return(e.wrap&2)===0?G:(e.head=r,r.done=!1,he)},Wi=(t,r)=>{const e=r.length;let n,a,o;return me(t)||(n=t.state,n.wrap!==0&&n.mode!==ct)?G:n.mode===ct&&(a=1,a=Ge(a,r,e,0),a!==n.check)?qn:(o=Qn(t,r,e,e),o?(n.mode=jn,Vn):(n.havedict=1,he))};var Gi=Yn,$i=Xn,qi=Zn,Vi=zi,ji=Jn,Ki=Oi,Zi=Ui,Yi=Hi,Xi=Wi,Ji="pako inflate (from Nodeca project)",ee={inflateReset:Gi,inflateReset2:$i,inflateResetKeep:qi,inflateInit:Vi,inflateInit2:ji,inflate:Ki,inflateEnd:Zi,inflateGetHeader:Yi,inflateSetDictionary:Xi,inflateInfo:Ji};function Qi(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var el=Qi;const ea=Object.prototype.toString,{Z_NO_FLUSH:tl,Z_FINISH:rl,Z_OK:Ve,Z_STREAM_END:Rt,Z_NEED_DICT:Nt,Z_STREAM_ERROR:nl,Z_DATA_ERROR:Qr,Z_MEM_ERROR:al}=Ke;function Xe(t){this.options=ht.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});const r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),r.windowBits>=0&&r.windowBits<16&&!(t&&t.windowBits)&&(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&(r.windowBits&15)===0&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Hn,this.strm.avail_out=0;let e=ee.inflateInit2(this.strm,r.windowBits);if(e!==Ve)throw new Error(ue[e]);if(this.header=new el,ee.inflateGetHeader(this.strm,this.header),r.dictionary&&(typeof r.dictionary=="string"?r.dictionary=qe.string2buf(r.dictionary):ea.call(r.dictionary)==="[object ArrayBuffer]"&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(e=ee.inflateSetDictionary(this.strm,r.dictionary),e!==Ve)))throw new Error(ue[e])}Xe.prototype.push=function(t,r){const e=this.strm,n=this.options.chunkSize,a=this.options.dictionary;let o,s,i;if(this.ended)return!1;for(r===~~r?s=r:s=r===!0?rl:tl,ea.call(t)==="[object ArrayBuffer]"?e.input=new Uint8Array(t):e.input=t,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(n),e.next_out=0,e.avail_out=n),o=ee.inflate(e,s),o===Nt&&a&&(o=ee.inflateSetDictionary(e,a),o===Ve?o=ee.inflate(e,s):o===Qr&&(o=Nt));e.avail_in>0&&o===Rt&&e.state.wrap>0&&t[e.next_in]!==0;)ee.inflateReset(e),o=ee.inflate(e,s);switch(o){case nl:case Qr:case Nt:case al:return this.onEnd(o),this.ended=!0,!1}if(i=e.avail_out,e.next_out&&(e.avail_out===0||o===Rt))if(this.options.to==="string"){let c=qe.utf8border(e.output,e.next_out),l=e.next_out-c,d=qe.buf2string(e.output,c);e.next_out=l,e.avail_out=n-l,l&&e.output.set(e.output.subarray(c,c+l),0),this.onData(d)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(!(o===Ve&&i===0)){if(o===Rt)return o=ee.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(e.avail_in===0)break}}return!0};Xe.prototype.onData=function(t){this.chunks.push(t)};Xe.prototype.onEnd=function(t){t===Ve&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=ht.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function or(t,r){const e=new Xe(r);if(e.push(t),e.err)throw e.msg||ue[e.err];return e.result}function ol(t,r){return r=r||{},r.raw=!0,or(t,r)}var sl=Xe,il=or,ll=ol,dl=or,cl={Inflate:sl,inflate:il,inflateRaw:ll,ungzip:dl};const{Deflate:ul,deflate:fl,deflateRaw:hl,gzip:ml}=yi,{Inflate:pl,inflate:_l,inflateRaw:gl,ungzip:wl}=cl;var yl=ul,vl=fl,Sl=hl,bl=ml,El=pl,kl=_l,Fl=gl,Ml=wl,xl=Ke,ta={Deflate:yl,deflate:vl,deflateRaw:Sl,gzip:bl,Inflate:El,inflate:kl,inflateRaw:Fl,ungzip:Ml,constants:xl};async function ra(t,r){const e=new TextEncoder,n=await crypto.subtle.importKey("raw",e.encode(t),"PBKDF2",!1,["deriveBits","deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:r,iterations:_a,hash:"SHA-256"},n,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async function na(t,r){const e=crypto.getRandomValues(new Uint8Array(ve)),n=await crypto.subtle.encrypt({name:"AES-GCM",iv:e},r,t),a=new Uint8Array(e.length+n.byteLength);return a.set(e),a.set(new Uint8Array(n),e.length),a}async function aa(t,r){if(t.length<ve+16)throw new Error("Encrypted data too short");const e=t.slice(0,ve),n=t.slice(ve);try{const a=await crypto.subtle.decrypt({name:"AES-GCM",iv:e},r,n);return new Uint8Array(a)}catch{throw new Error("Decryption failed - wrong password or corrupted data")}}async function Al(t,r){if(r.length!==ce)throw new Error(`Key must be ${ce} bytes`);const e=await crypto.subtle.importKey("raw",r,"AES-GCM",!1,["encrypt"]);return na(t,e)}async function Tl(t,r){if(r.length!==ce)throw new Error(`Key must be ${ce} bytes`);const e=await crypto.subtle.importKey("raw",r,"AES-GCM",!1,["decrypt"]);try{return await aa(t,e)}catch{throw new Error("Payload decryption failed - corrupted data or wrong key")}}function sr(t){return crypto.getRandomValues(new Uint8Array(t))}function Pl(t,r=6){const e=[],n=sr(r*2);let a=0;for(;e.length<r&&a<n.length;){const o=n[a]%t;e.push(o),a++}for(;e.length<r;)e.push(Math.floor(Math.random()*t));return e}function Rl(t){let r="";for(const e of t)r+=String.fromCharCode(e);return btoa(r)}function Nl(t){const r=atob(t),e=new Uint8Array(r.length);for(let n=0;n<r.length;n++)e[n]=r.charCodeAt(n);return e}function oa(t){const r=["version","knock","k","payload_key"];for(const o of r)if(!(o in t))throw new Error(`Missing required field: ${o}`);if(t.version!==1&&t.version!==on)throw new Error(`Unsupported secret version: ${t.version}`);const e=t.k;if(typeof e!="number"||e<2||(e&e-1)!==0)throw new Error(`K must be a power of 2 >= 2, got ${e}`);const n=t.knock;if(!Array.isArray(n)||n.length<1)throw new Error("Knock sequence must be a non-empty list");for(const o of n)if(typeof o!="number"||o<0||o>=e)throw new Error(`Knock index ${o} must be in [0, ${e})`);const a=t.payload_key;if(!(a instanceof Uint8Array)||a.length!==ce)throw new Error(`payload_key must be ${ce} bytes`)}async function sa(t,r){const e=sr(at),n=await ra(r,e);let a=new Uint8Array(ko(t));const o=ta.deflate(a,{level:9});o.length<a.length&&(a=o);const s=await na(a,n),i=new Uint8Array(e.length+s.length);return i.set(e),i.set(s,e.length),Rl(i)}async function ia(t,r){let e;try{e=Nl(t)}catch{throw new Error("Invalid base64 encoding")}if(e.length<at+ve+16)throw new Error("Secret blob too short");const n=e.slice(0,at),a=e.slice(at),o=await ra(r,n);let s=await aa(a,o);if(s.length>0&&s[0]===120)try{s=ta.inflate(s)}catch{}const i=No(s);return i.payload_key&&!(i.payload_key instanceof Uint8Array)&&(i.payload_key=new Uint8Array(i.payload_key)),oa(i),i}function la(t){const{k:r,knock:e=Pl(r,6),preambleTokens:n=4,suffixTokens:a=2,temperature:o=.8,entropyThreshold:s=0,systemPrompt:i="",notes:c=""}=t;if(r<2||(r&r-1)!==0)throw new Error(`K must be a power of 2 >= 2, got ${r}`);let l;t.huffmanSample?l=Il(t.huffmanSample):l=null;const d=sr(ce),p={version:on,knock:e,k:r,payload_key:d,preamble_tokens:n,suffix_tokens:a,temperature:o,entropy_threshold:s,huffman_freq:l,system_prompt:i,notes:c};return oa(p),p}function Il(t){const r={};for(const e of t)r[e]=(r[e]||0)+1;for(let e=32;e<127;e++)e in r||(r[e]=1);for(const e of[9,10,13])e in r||(r[e]=1);return r}function en(t){const r=[];for(const e of t)for(let n=7;n>=0;n--)r.push(e>>n&1);return r}function tn(t){const r=[...t];for(;r.length%8!==0;)r.push(0);const e=new Uint8Array(r.length/8);for(let n=0;n<r.length;n+=8){let a=0;for(let o=0;o<8;o++)a=a<<1|r[n+o];e[n/8]=a}return e}function Cl(t){let r=0;for(const e of t)r=r<<1|e;return r}function Dl(t,r){const e=[];for(let n=r-1;n>=0;n--)e.push(t>>n&1);return e}function ye(t,r){const e=[...t].sort((o,s)=>s.prob!==o.prob?s.prob-o.prob:o.token.localeCompare(s.token)),n=new Set(e.filter(o=>o.token).map(o=>o.token)),a=[];for(const o of e){if(!o.token)continue;let s=!1;for(const i of n)if(i!==o.token&&i.startsWith(o.token)){s=!0;break}if(s||a.push(o),a.length>=r)break}return a}function Ll(t,r){let e=null,n=-1,a=0;for(let o=0;o<r.length;o++){const s=r[o];t.startsWith(s.token)&&s.token.length>a&&(e=s,n=o,a=s.token.length)}return[e,n]}function da(t,r){if(!r.length||!t.length)return-1;const e=r.length;for(let n=0;n<=t.length-e;n++){let a=!0;for(let o=0;o<e;o++)if(t[n+o]!==r[o]){a=!1;break}if(a)return n}return-1}function rn(t,r=1){if(!t.length)return[0,""];if(r<=0||t.length===1)return[0,t[0].token];const n=t.map(c=>c.prob).map(c=>Math.pow(c,1/r)),a=n.reduce((c,l)=>c+l,0);if(a<=0)return[0,t[0].token];const o=n.map(c=>c/a),s=Math.random();let i=0;for(let c=0;c<o.length;c++)if(i+=o[c],s<i)return[c,t[c].token];return[t.length-1,t[t.length-1].token]}const ca={32:18e3,101:12e3,116:9e3,97:8e3,111:7500,105:7e3,110:6700,115:6300,104:6e3,114:5900,100:4200,108:4e3,99:2700,117:2700,109:2400,119:2300,102:2200,103:2e3,121:1900,112:1900,98:1500,118:1e3,107:800,106:150,120:150,113:100,122:70,84:800,73:700,65:600,83:500,72:400,87:350,67:300,66:250,80:200,77:200,70:180,68:170,82:160,76:150,78:140,69:130,71:120,79:110,85:100,86:90,89:80,75:70,74:60,88:50,81:40,90:30,46:600,44:500,39:200,34:150,33:100,63:100,45:80,58:60,59:50,40:40,41:40,48:50,49:50,50:40,51:35,52:30,53:30,54:25,55:25,56:20,57:20,10:300};class zl{items=[];seqCounter=0;push(r){r.seq=this.seqCounter++,this.items.push(r),this.items.sort((e,n)=>e.freq!==n.freq?e.freq-n.freq:(e.seq??0)-(n.seq??0))}pop(){return this.items.shift()}get length(){return this.items.length}}function ua(t){const r=Object.entries(t);if(r.length===0)return null;const e=new zl,n=r.map(([a,o])=>({byte:parseInt(a),freq:o})).sort((a,o)=>a.byte-o.byte);for(const{byte:a,freq:o}of n)e.push({freq:o,byte:a,left:null,right:null});for(;e.length>1;){const a=e.pop(),o=e.pop(),s={freq:a.freq+o.freq,byte:null,left:a,right:o};e.push(s)}return e.pop()??null}function jt(t,r,e){t!==null&&(t.byte!==null?e.set(t.byte,r||"0"):(jt(t.left,r+"0",e),jt(t.right,r+"1",e)))}function Bl(t){const r=ua(t),e=new Map;return jt(r,"",e),e}function Ol(t,r){const e=Bl(r),n=[];for(const s of t){const i=e.get(s);if(i!==void 0)for(const c of i)n.push(parseInt(c));else{const c=e.get(255);if(c!==void 0)for(const l of c)n.push(parseInt(l));for(let l=7;l>=0;l--)n.push(s>>l&1)}}const a=n.length;for(;n.length%8!==0;)n.push(0);const o=new Uint8Array(4+n.length/8);o[0]=a>>24&255,o[1]=a>>16&255,o[2]=a>>8&255,o[3]=a&255;for(let s=0;s<n.length;s+=8){let i=0;for(let c=0;c<8;c++)i=i<<1|n[s+c];o[4+s/8]=i}return o}function Ul(t,r){if(t.length<4)throw new Error("Encoded data too short");const e=t[0]<<24|t[1]<<16|t[2]<<8|t[3],n=t.slice(4),a=[];for(const l of n)for(let d=7;d>=0;d--)a.push(l>>d&1);a.length=Math.min(a.length,e);const o=ua(r);if(o===null)return new Uint8Array(0);const s=[];let i=o,c=0;for(;c<a.length;){const l=a[c];if(c++,l===0?i=i.left:i=i.right,i===null)throw new Error("Invalid Huffman data");i.byte!==null&&(s.push(i.byte),i=o)}return new Uint8Array(s)}const Hl=32,te=2147483648,Z=1073741824,fa=4294967295;function ha(t){const r=Object.entries(t).map(([o,s])=>({byte:parseInt(o),freq:s})).sort((o,s)=>o.byte-s.byte),e=r.map(o=>o.byte),n=r.map(o=>o.freq),a=[0];for(const o of n)a.push(a[a.length-1]+o);return{symbols:e,cumulative:a,total:a[a.length-1]}}class Wl{symbols;cumulative;total;symbolToIdx;low=0;high=fa;pendingBits=0;outputBits=[];constructor(r){const e=ha(r);this.symbols=e.symbols,this.cumulative=e.cumulative,this.total=e.total,this.symbolToIdx=new Map;for(let n=0;n<this.symbols.length;n++)this.symbolToIdx.set(this.symbols[n],n)}emitBit(r){this.outputBits.push(r);const e=1-r;for(let n=0;n<this.pendingBits;n++)this.outputBits.push(e);this.pendingBits=0}renormalize(){for(;;)if(this.high<te)this.emitBit(0),this.low=this.low<<1>>>0,this.high=(this.high<<1|1)>>>0;else if(this.low>=te)this.emitBit(1),this.low=this.low-te<<1>>>0,this.high=(this.high-te<<1|1)>>>0;else if(this.low>=Z&&this.high<3*Z)this.pendingBits++,this.low=this.low-Z<<1>>>0,this.high=(this.high-Z<<1|1)>>>0;else break}encodeSymbol(r){const e=this.symbolToIdx.get(r);if(e===void 0)throw new Error(`Symbol ${r} not in frequency table`);const n=this.high-this.low+1,a=this.cumulative[e],o=this.cumulative[e+1];this.high=this.low+Math.floor(n*o/this.total)-1>>>0,this.low=this.low+Math.floor(n*a/this.total)>>>0,this.renormalize()}finish(){for(this.pendingBits++,this.low<Z?this.emitBit(0):this.emitBit(1);this.outputBits.length%8!==0;)this.outputBits.push(0);const r=new Uint8Array(this.outputBits.length/8);for(let e=0;e<this.outputBits.length;e+=8){let n=0;for(let a=0;a<8;a++)n=n<<1|this.outputBits[e+a];r[e/8]=n}return r}}class Gl{symbols;cumulative;total;bits;bitIndex=0;low=0;high=fa;value=0;constructor(r,e){const n=ha(r);this.symbols=n.symbols,this.cumulative=n.cumulative,this.total=n.total,this.bits=e;for(let a=0;a<Hl;a++)this.value=(this.value<<1|this.readBit())>>>0}readBit(){return this.bitIndex<this.bits.length?this.bits[this.bitIndex++]:0}renormalize(){for(;;)if(this.high<te)this.low=this.low<<1>>>0,this.high=(this.high<<1|1)>>>0,this.value=(this.value<<1|this.readBit())>>>0;else if(this.low>=te)this.low=this.low-te<<1>>>0,this.high=(this.high-te<<1|1)>>>0,this.value=(this.value-te<<1|this.readBit())>>>0;else if(this.low>=Z&&this.high<3*Z)this.low=this.low-Z<<1>>>0,this.high=(this.high-Z<<1|1)>>>0,this.value=(this.value-Z<<1|this.readBit())>>>0;else break}decodeSymbol(){const r=this.high-this.low+1,e=Math.floor(((this.value-this.low+1)*this.total-1)/r);let n=0,a=this.symbols.length;for(;n<a;){const c=Math.floor((n+a+1)/2);this.cumulative[c]<=e?n=c:a=c-1}const o=n,s=this.cumulative[o],i=this.cumulative[o+1];return this.high=this.low+Math.floor(r*i/this.total)-1>>>0,this.low=this.low+Math.floor(r*s/this.total)>>>0,this.renormalize(),this.symbols[o]}}function $l(t,r){if(t.length===0)return new Uint8Array([0,0,0,0]);const e=new Wl(r);for(const o of t)e.encodeSymbol(o);const n=e.finish(),a=new Uint8Array(4+n.length);return a[0]=t.length>>24&255,a[1]=t.length>>16&255,a[2]=t.length>>8&255,a[3]=t.length&255,a.set(n,4),a}function ql(t,r){if(t.length<4)throw new Error("Encoded data too short");const e=t[0]<<24|t[1]<<16|t[2]<<8|t[3];if(e===0)return new Uint8Array(0);const n=t.slice(4),a=[];for(const i of n)for(let c=7;c>=0;c--)a.push(i>>c&1);const o=new Gl(r,a),s=new Uint8Array(e);for(let i=0;i<e;i++)s[i]=o.decodeSymbol();return s}function Vl(t,r){if(t.length===0)return[t,Ct];const e=[[t,Ct]],n=Ol(t,r);if(e.push([n,nn]),Array.from(t).every(s=>s in r)){const s=$l(t,r);e.push([s,an])}let o=e[0];for(const s of e)s[0].length<o[0].length&&(o=s);return o}function jl(t,r,e){if(r===Ct)return t;if(r===nn)return Ul(t,e);if(r===an)return ql(t,e);throw new Error(`Unknown compression type: ${r}`)}const Kl=32,Zl=1<<Kl,Yl=Zl-1>>>0;function ma(){return{low:0,high:Yl}}function Xl(t,r,e,n,a=0){if(n.length===0)throw new Error("Empty token distribution");if(a>0){let p=0;for(const f of n)p+=f.prob;if(p>0&&n[0].prob/p>=a)return[n[0],r,e]}const o=n.length,s=o>1?Math.floor(Math.log2(o)):1,i=t.length-r,c=Math.min(s,i);let l=0;for(let p=0;p<c;p++)r+p<t.length?l=l<<1|t[r+p]:l=l<<1;return c<s&&(l=l<<s-c),l>=o&&(l=l%o),[n[l],r+c,e]}function Jl(t,r,e,n=0){if(e.length===0)throw new Error("Empty token distribution");if(n>0){let c=0;for(const l of e)c+=l.prob;if(c>0&&e[0].prob/c>=n)return[[],r]}const a=e.length,o=a>1?Math.floor(Math.log2(a)):1;let s=null;for(let c=0;c<e.length;c++)if(e[c].token===t.token){s=c;break}if(s===null)throw new Error(`Token '${t.token}' not found in distribution`);const i=[];for(let c=o-1;c>=0;c--){const l=s>>c&1;i.push(l)}return[i,r]}async function Ql(t,r,e,n,a,o=4,s=2,i=.8,c=0,l="",d){const p=Math.log2(n),f=new Uint8Array(4);f[0]=t.length>>24&255,f[1]=t.length>>16&255,f[2]=t.length>>8&255,f[3]=t.length&255;const u=en(f),h=en(t);let M=l+e;const E=[];d?.("Generating preamble",0,o);const g=[];for(let _=0;_<o;_++){const F=await r.getTokenDistribution(M);if(!F.length)break;const b=ye(F,n);if(!b.length)break;const[y,v]=rn(b,i);E.push(v),g.push(y),M+=v,d?.("Generating preamble",_+1,o)}if(da(g,a)!==-1)throw new Error("Knock sequence found in preamble, use different knock sequence or prompt");d?.("Encoding knock",0,a.length);for(let _=0;_<a.length;_++){const F=a[_],b=await r.getTokenDistribution(M);if(!b.length)throw new Error("Empty distribution while encoding knock sequence");const y=ye(b,n);if(!y.length)throw new Error("No valid tokens while encoding knock sequence");const v=F>=y.length?F%y.length:F,C=y[v].token;E.push(C),M+=C,d?.("Encoding knock",_+1,a.length)}const k=Math.ceil(u.length/p);d?.("Encoding length",0,k);let S=0;for(;S<u.length;){const _=u.slice(S,S+p);for(;_.length<p;)_.push(0);const F=Cl(_),b=await r.getTokenDistribution(M);if(!b.length)break;const y=ye(b,n);if(!y.length)break;const v=F>=y.length?F%y.length:F,C=y[v].token;E.push(C),M+=C,S+=p}const m=Math.ceil(h.length/p);d?.("Encoding payload",0,m);let x=ma();S=0;let R=0;for(;S<h.length;){const _=await r.getTokenDistribution(M);if(!_.length)break;const F=ye(_,n);if(!F.length)break;const[b,y,v]=Xl(h,S,x,F,c);E.push(b.token),M+=b.token,S=y,x=v,R++,R%10===0&&d?.("Encoding payload",R,m)}d?.("Generating suffix",0,s);for(let _=0;_<s;_++){const F=await r.getTokenDistribution(M);if(!F.length)break;const b=ye(F,n);if(!b.length)break;const[,y]=rn(b,i);E.push(y),M+=y,d?.("Generating suffix",_+1,s)}return d?.("Complete",1,1),e+E.join("")}async function ed(t,r,e,n,a="",o=0,s="",i){const c=Math.log2(e);let l,d;a&&t.startsWith(a)?(l=s+a,d=t.slice(a.length)):(l=s,d=t);const p=[],f=[],u=[];let h=0;for(i?.("Scanning tokens",0,d.length);d.length>0;){const v=await r.getTokenDistribution(l);if(!v.length){l+=d[0],d=d.slice(1);continue}const C=ye(v,e);if(!C.length){l+=d[0],d=d.slice(1);continue}const[$,V]=Ll(d,C);if($===null){l+=d[0],d=d.slice(1);continue}p.push(V),f.push($),u.push(C),l+=$.token,d=d.slice($.token.length),h++,h%20===0&&i?.("Scanning tokens",t.length-d.length,t.length)}const M=da(p,n);if(M===-1)throw new Error("Knock sequence not found in cover text");const E=M+n.length,g=Math.ceil(32/c),k=[];for(let v=0;v<g;v++){const C=E+v;if(C>=p.length)break;const $=p[C],V=Dl($,c);k.push(...V)}if(k.length<32)throw new Error("Not enough tokens for length header");const S=tn(k.slice(0,32)),m=S[0]<<24|S[1]<<16|S[2]<<8|S[3],x=E+g,R=f.slice(x),_=u.slice(x);i?.("Decoding payload",0,R.length);let F=ma();const b=[];for(let v=0;v<R.length&&!(v>=_.length);v++){const C=_[v];if(!C.length)continue;const $=R[v],[V,pe]=Jl($,F,C,o);if(b.push(...V),F=pe,b.length>=m*8)break;v%20===0&&i?.("Decoding payload",v,R.length)}return i?.("Complete",1,1),tn(b).slice(0,m)}async function td(t,r,e,n=sn,a=!0,o){const s=r.huffman_freq||ca;let i,c;a?[i,c]=Vl(t,s):(i=t,c=0);const l=new Uint8Array(1+i.length);l[0]=c,l.set(i,1);const d=await Al(l,r.payload_key);return await Ql(d,e,n,r.k,r.knock,r.preamble_tokens,r.suffix_tokens,r.temperature,r.entropy_threshold||0,r.system_prompt||"",o)}async function rd(t,r,e,n="",a){const o=await ed(t,e,r.k,r.knock,n,r.entropy_threshold||0,r.system_prompt||"",a);if(o.length<ve+16+1)throw new Error("Decoded payload too short");const s=await Tl(o,r.payload_key);if(s.length<1)throw new Error("Decrypted payload too short");const i=s[0],c=s.slice(1),l=r.huffman_freq||ca;return jl(c,i,l)}let N=null,q=null,It=!1;const w=t=>document.getElementById(t);document.querySelectorAll(".tab").forEach(t=>{t.addEventListener("click",()=>{const r=t.dataset.tab;document.querySelectorAll(".tab").forEach(e=>e.classList.remove("active")),document.querySelectorAll(".panel").forEach(e=>e.classList.remove("active")),t.classList.add("active"),w(`${r}Panel`).classList.add("active")})});function nd(){const t=w("modelSelect");t.innerHTML=it.map(r=>`<option value="${r.id}">${r.name} (${r.size})</option>`).join("")}nd();function ad(){const r=w("modelSelect").value;return it.find(e=>e.id===r)||it[0]}w("loadModelBtn").addEventListener("click",async()=>{if(It)return;const t=w("loadModelBtn"),r=w("modelStatus"),e=w("modelStatusText"),n=w("modelSelect"),a=ad();It=!0,t.disabled=!0,n.disabled=!0,r.className="model-status loading",e.textContent=`Loading ${a.name} (0%)...`;try{q&&q.loaded&&await q.close(),q=new Xa(64,a),await q.loadModel(o=>{e.textContent=`Loading ${a.name} (${Math.round(o*100)}%)...`}),r.className="model-status loaded",e.textContent=`Model loaded (${a.name})`,t.textContent="Change Model",t.disabled=!1}catch(o){r.className="model-status",e.textContent=`Failed to load model: ${o}`,t.disabled=!1,q=null}finally{It=!1,n.disabled=!1}});function pa(t){if(t)return new ga(32,42);if(!q||!q.loaded)throw new Error("Model not loaded. Load the model first or use mock client.");return q}w("encodeBtn").addEventListener("click",async()=>{const t=w("encodeMessage").value,r=w("encodePrompt").value||sn,e=w("encodeMock").checked,n=w("encodeProgress"),a=w("encodeProgressBar"),o=w("encodeStatus"),s=w("encodeOutput"),i=w("copyEncoded"),c=w("encodeBtn");if(!t.trim()){o.textContent="Please enter a message to encode",o.className="status error";return}if(!N){o.textContent="Please generate or load a secret first",o.className="status error";return}let l;try{l=pa(e)}catch(d){o.textContent=String(d),o.className="status error";return}c.disabled=!0,n.style.display="block",a.style.width="0%",o.textContent="Encoding...",o.className="status",s.textContent="",i.disabled=!0;try{const p=new TextEncoder().encode(t),f=await td(p,N,l,r,!0,(u,h,M)=>{const E=M>0?Math.round(h/M*100):0;a.style.width=`${E}%`,o.textContent=`${u}: ${h}/${M}`});s.textContent=f,o.textContent=`Encoded successfully! ${f.length} characters`,o.className="status success",i.disabled=!1}catch(d){o.textContent=`Encoding failed: ${d}`,o.className="status error"}finally{c.disabled=!1,n.style.display="none"}});w("copyEncoded").addEventListener("click",async()=>{const t=w("encodeOutput").textContent||"";await navigator.clipboard.writeText(t);const r=w("copyEncoded"),e=r.textContent;r.textContent="Copied!",setTimeout(()=>{r.textContent=e},1500)});w("decodeBtn").addEventListener("click",async()=>{const t=w("decodeCover").value,r=w("decodeMock").checked,e=w("decodeProgress"),n=w("decodeProgressBar"),a=w("decodeStatus"),o=w("decodeOutput"),s=w("decodeBtn");if(!t.trim()){a.textContent="Please enter cover text to decode",a.className="status error";return}if(!N){a.textContent="Please generate or load a secret first",a.className="status error";return}let i;try{i=pa(r),!r&&q&&q.resetContext()}catch(c){a.textContent=String(c),a.className="status error";return}s.disabled=!0,e.style.display="block",n.style.width="0%",a.textContent="Decoding...",a.className="status",o.textContent="";try{const c=await rd(t,N,i,"",(p,f,u)=>{const h=u>0?Math.round(f/u*100):0;n.style.width=`${h}%`,a.textContent=`${p}: ${f}/${u}`}),d=new TextDecoder().decode(c);o.textContent=d,a.textContent=`Decoded successfully! ${c.length} bytes`,a.className="status success"}catch(c){a.textContent=`Decoding failed: ${c}`,a.className="status error"}finally{s.disabled=!1,e.style.display="none"}});w("generateSecretBtn").addEventListener("click",async()=>{const t=parseInt(w("secretK").value),r=parseInt(w("secretPreamble").value)||4,e=parseInt(w("secretSuffix").value)||2,n=parseFloat(w("secretEntropyThreshold").value)||0,a=w("secretPassword").value,o=w("secretNotes").value,s=w("secretStatus");if(!a){s.textContent="Please enter a password",s.className="status error";return}try{N=la({k:t,preambleTokens:r,suffixTokens:e,entropyThreshold:n,notes:o});const i=await sa(N,a);w("secretBlob").value=i,pt(),s.textContent="Secret generated! Copy the blob to save it.",s.className="status success",w("exportSecretBtn").disabled=!1}catch(i){s.textContent=`Failed to generate secret: ${i}`,s.className="status error"}});w("loadSecretBtn").addEventListener("click",async()=>{const t=w("secretBlob").value.trim(),r=w("loadPassword").value,e=w("loadStatus");if(!t){e.textContent="Please enter a secret blob",e.className="status error";return}if(!r){e.textContent="Please enter the password",e.className="status error";return}try{N=await ia(t,r),pt(),e.textContent="Secret loaded successfully!",e.className="status success",w("exportSecretBtn").disabled=!1}catch(n){e.textContent=`Failed to load secret: ${n}`,e.className="status error"}});w("exportSecretBtn").addEventListener("click",async()=>{const t=w("secretBlob").value;if(t){await navigator.clipboard.writeText(t);const r=w("exportSecretBtn"),e=r.textContent;r.textContent="Copied!",setTimeout(()=>{r.textContent=e},1500)}});function pt(){const t=w("secretInfoCard"),r=w("secretInfo");if(!N){t.style.display="none";return}t.style.display="block";const e=Math.log2(N.k);r.innerHTML=`
    <div><dt>Version:</dt><dd>${N.version}</dd></div>
    <div><dt>K:</dt><dd>${N.k} (${e} bits/token)</dd></div>
    <div><dt>Knock:</dt><dd>[${N.knock.join(", ")}]</dd></div>
    <div><dt>Preamble tokens:</dt><dd>${N.preamble_tokens}</dd></div>
    <div><dt>Suffix tokens:</dt><dd>${N.suffix_tokens}</dd></div>
    <div><dt>Temperature:</dt><dd>${N.temperature}</dd></div>
    <div><dt>Entropy threshold:</dt><dd>${N.entropy_threshold??0}</dd></div>
    <div><dt>Huffman entries:</dt><dd>${N.huffman_freq?Object.keys(N.huffman_freq).length:"default"}</dd></div>
    ${N.system_prompt?`<div><dt>System prompt:</dt><dd>${N.system_prompt.slice(0,50)}${N.system_prompt.length>50?"...":""}</dd></div>`:""}
    ${N.notes?`<div><dt>Notes:</dt><dd>${N.notes}</dd></div>`:""}
  `}w("encodeMock").addEventListener("change",t=>{w("decodeMock").checked=t.target.checked});w("decodeMock").addEventListener("change",t=>{w("encodeMock").checked=t.target.checked});w("quickGenerateBtn").addEventListener("click",async()=>{const t=w("quickPassword").value,r=w("quickSecretSuccess"),e=w("quickSecretBlob");if(!t){alert("Please enter a password");return}try{N=la({k:8,preambleTokens:4,suffixTokens:2,entropyThreshold:.9});const n=await sa(N,t);e.textContent=n,r.classList.remove("hidden"),w("secretBlob").value=n,pt(),w("exportSecretBtn").disabled=!1}catch(n){alert(`Failed to generate secret: ${n}`)}});w("quickCopyBlob").addEventListener("click",async()=>{const t=w("quickSecretBlob").textContent||"";await navigator.clipboard.writeText(t);const r=w("quickCopyBlob"),e=r.textContent;r.textContent="Copied!",setTimeout(()=>{r.textContent=e},1500)});w("quickLoadBtn").addEventListener("click",async()=>{const t=w("quickLoadBlob").value.trim(),r=w("quickLoadPassword").value,e=w("quickLoadStatus");if(!t){e.textContent="Please enter a secret blob",e.className="status error";return}if(!r){e.textContent="Please enter the password",e.className="status error";return}try{N=await ia(t,r),pt(),e.textContent="Secret loaded! You can now decode messages.",e.className="status success",w("secretBlob").value=t,w("exportSecretBtn").disabled=!1}catch(n){e.textContent=`Failed to load secret: ${n}`,e.className="status error"}});
